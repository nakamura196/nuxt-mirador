/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{1202:function(e,t,n){var o=n(458),r=n(1203),l=n(472),h=n(1208),c=l((function(e,t){if(null==e)return[];var n=t.length;return n>1&&h(e,t[0],t[1])?t=[]:n>2&&h(t[0],t[1],t[2])&&(t=[t[0]]),r(e,o(t,1),[])}));e.exports=c},1203:function(e,t,n){var o=n(450),r=n(468),l=n(490),h=n(1204),c=n(1205),d=n(489),m=n(1206),v=n(460),f=n(403);e.exports=function(e,t,n){t=t.length?o(t,(function(e){return f(e)?function(t){return r(t,1===e.length?e[0]:e)}:e})):[v];var w=-1;t=o(t,d(l));var y=h(e,(function(e,n,r){return{criteria:o(t,(function(t){return t(e)})),index:++w,value:e}}));return c(y,(function(object,e){return m(object,e,n)}))}},1204:function(e,t,n){var o=n(571),r=n(449);e.exports=function(e,t){var n=-1,l=r(e)?Array(e.length):[];return o(e,(function(e,o,r){l[++n]=t(e,o,r)})),l}},1205:function(e,t){e.exports=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}},1206:function(e,t,n){var o=n(1207);e.exports=function(object,e,t){for(var n=-1,r=object.criteria,l=e.criteria,h=r.length,c=t.length;++n<h;){var d=o(r[n],l[n]);if(d)return n>=c?d:d*("desc"==t[n]?-1:1)}return object.index-e.index}},1207:function(e,t,n){var o=n(470);e.exports=function(e,t){if(e!==t){var n=void 0!==e,r=null===e,l=e==e,h=o(e),c=void 0!==t,d=null===t,m=t==t,v=o(t);if(!d&&!v&&!h&&e>t||h&&c&&m&&!d&&!v||r&&c&&m||!n&&m||!l)return 1;if(!r&&!h&&!v&&e<t||v&&n&&l&&!r&&!h||d&&n&&l||!c&&l||!m)return-1}return 0}},1208:function(e,t,n){var o=n(531),r=n(449),l=n(488),h=n(411);e.exports=function(e,t,object){if(!h(object))return!1;var n=typeof t;return!!("number"==n?r(object)&&l(t,object.length):"string"==n&&t in object)&&o(object[t],e)}},1209:function(e,t,n){var o=n(584),r=n(472),l=n(1210),h=n(536),c=r((function(e){return l(o(e,h))}));e.exports=c},1210:function(e,t,n){var o=n(604),r=n(458),l=n(726);e.exports=function(e,t,n){var h=e.length;if(h<2)return h?l(e[0]):[];for(var c=-1,d=Array(h);++c<h;)for(var m=e[c],v=-1;++v<h;)v!=c&&(d[c]=o(d[c]||m,e[v],t,n));return l(r(d,1),t,n)}},1285:function(e,t,n){"use strict";n.r(t);var o=n(380),r=n(382),l=n(1299),h=n(389),c=n(404),d=n.n(c),m=n(381),v=n(376),f=n.n(v),w=n(542),y=n.n(w),T=n(496),x=n.n(T),S=n(786),E=n.n(S),P=n(379),_=n.n(P),R=n(396),C=n(397),O=n.n(C),I=n(1202),k=n.n(I),A=n(1209),D=n.n(A);function B(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var M=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.ref=n,this.containerWidth=0,this.containerHeight=0,this.imgAspectRatio=1}var t,n,o;return t=e,(n=[{key:"canvas",get:function(){return this.canvasDiv.firstElementChild}},{key:"canvasDiv",get:function(){return this.ref.current}},{key:"context2d",get:function(){return this.canvas.getContext("2d")}},{key:"clear",value:function(){this.context2d.clearRect(0,0,this.containerWidth,this.containerHeight)}},{key:"resize",value:function(){this.containerWidth!==this.viewer.container.clientWidth&&(this.containerWidth=this.viewer.container.clientWidth,this.canvasDiv.setAttribute("width",this.containerWidth),this.canvas.setAttribute("width",this.containerWidth)),this.containerHeight!==this.viewer.container.clientHeight&&(this.containerHeight=this.viewer.container.clientHeight,this.canvasDiv.setAttribute("height",this.containerHeight),this.canvas.setAttribute("height",this.containerHeight)),this.viewportOrigin=new E.a.Point(0,0);var e=this.viewer.viewport.getBoundsNoRotate(!0);this.viewportOrigin.x=e.x,this.viewportOrigin.y=e.y*this.imgAspectRatio,this.viewportWidth=e.width,this.viewportHeight=e.height*this.imgAspectRatio;var t=this.viewer.world.getItemAt(0);t&&(this.imgWidth=t.source.dimensions.x,this.imgHeight=t.source.dimensions.y,this.imgAspectRatio=this.imgWidth/this.imgHeight)}},{key:"canvasUpdate",value:function(e){var t=this.viewer.viewport.getZoom(!0),n=this.viewer.world.getItemAt(0);if(n){var o=n.viewportToImageZoom(t),r=(this.viewportOrigin.x/this.imgWidth-this.viewportOrigin.x)/this.viewportWidth*this.containerWidth,l=(this.viewportOrigin.y/this.imgHeight-this.viewportOrigin.y)/this.viewportHeight*this.containerHeight;this.clearBeforeRedraw&&this.clear(),this.context2d.translate(r,l),this.context2d.scale(o,o);var h=this.viewer.viewport.getCenter();this.viewer.viewport.getFlip()&&(this.context2d.translate(2*h.x,0),this.context2d.scale(-1,1));var c=this.viewer.viewport.getRotation();0!==c&&(this.context2d.translate(h.x,h.y),this.context2d.rotate(c*Math.PI/180),this.context2d.translate(-1*h.x,-1*h.y)),e(),this.context2d.setTransform(1,0,0,1,0,0)}}}])&&B(t.prototype,n),o&&B(t,o),e}();function z(e){return function(e){if(Array.isArray(e))return H(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return H(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return H(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function F(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var L=function(){function e(t){var n=t.resource,o=t.palette,r=t.zoomRatio,l=t.offset,h=t.selected,c=t.hovered;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.resource=n,this.palette=o,this.zoomRatio=r,this.offset=l,this.selected=h,this.hovered=c}var t,n,o;return t=e,(n=[{key:"toContext",value:function(e){this.context=e,this.resource.svgSelector?this.svgContext():this.resource.fragmentSelector&&this.fragmentContext()}},{key:"svgString",get:function(){return this.resource.svgSelector.value}},{key:"svgContext",value:function(){var e,t=this;0!==(e=this.hovered?this.palette.hovered:this.selected?this.palette.selected:this.palette.default).globalAlpha&&z(this.svgPaths).forEach((function(element){t.context.save(),t.context.translate(t.offset.x,t.offset.y);var p=new Path2D(element.attributes.d.nodeValue);t.context.strokeStyle=t.color,element.attributes["stroke-dasharray"]&&t.context.setLineDash(element.attributes["stroke-dasharray"].nodeValue.split(","));var n={fill:"fillStyle",stroke:"strokeStyle","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterlimit","stroke-width":"lineWidth"};Object.keys(n).forEach((function(e){element.attributes[e]&&(t.context[n[e]]=element.attributes[e].nodeValue)})),t.context.lineWidth/=t.zoomRatio,(t.selected||t.hovered)&&(t.context.strokeStyle=e.strokeStyle||e.fillStyle),element.attributes["stroke-opacity"]?t.context.globalAlpha=e.globalAlpha*element.attributes["stroke-opacity"].nodeValue:t.context.globalAlpha=e.globalAlpha,t.context.stroke(p),element.attributes.fill&&"none"!==element.attributes.fill.nodeValue&&(element.attributes["fill-opacity"]?t.context.globalAlpha=e.globalAlpha*element.attributes["fill-opacity"].nodeValue:t.context.globalAlpha=e.globalAlpha,t.context.fill(p)),t.context.restore()}))}},{key:"fragmentContext",value:function(){var e,t,n,o=this,r=this.resource.fragmentSelector;(r[0]+=this.offset.x,r[1]+=this.offset.y,e=this.selected?this.palette.selected:this.hovered?this.palette.hovered:this.palette.default,this.context.save(),Object.keys(e).forEach((function(t){o.context[t]=e[t]})),0!==e.globalAlpha)&&(e.fillStyle?(t=this.context).fillRect.apply(t,z(r)):(this.context.lineWidth=1/this.zoomRatio,(n=this.context).strokeRect.apply(n,z(r))),this.context.restore())}},{key:"svgPaths",get:function(){return(new DOMParser).parseFromString(this.svgString,"text/xml").getElementsByTagName("path")}}])&&F(t.prototype,n),o&&F(t,o),e}();function N(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function j(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?N(Object(source),!0).forEach((function(t){W(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):N(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function V(e){return function(e){if(Array.isArray(e))return $(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||G(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(e,i){return function(e){if(Array.isArray(e))return e}(e)||function(e,i){var t=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==t)return;var n,o,r=[],l=!0,h=!1;try{for(t=t.call(e);!(l=(n=t.next()).done)&&(r.push(n.value),!i||r.length!==i);l=!0);}catch(e){h=!0,o=e}finally{try{l||null==t.return||t.return()}finally{if(h)throw o}}return r}(e,i)||G(e,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function G(e,t){if(e){if("string"==typeof e)return $(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$(e,t):void 0}}function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function Z(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function X(e,p){return(X=Object.setPrototypeOf||function(e,p){return e.__proto__=p,e})(e,p)}function K(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=J(e);if(t){var r=J(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Y(this,n)}}function Y(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?Q(e):t}function Q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ee=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&X(e,t)}(l,e);var t,n,o,r=K(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=r.call(this,e)).ref=f.a.createRef(),t.osdCanvasOverlay=null,t.updateCanvas=function(){},t.onUpdateViewport=t.onUpdateViewport.bind(Q(t)),t.onCanvasClick=t.onCanvasClick.bind(Q(t)),t.onCanvasMouseMove=y()(t.onCanvasMouseMove.bind(Q(t)),10),t.onCanvasExit=t.onCanvasExit.bind(Q(t)),t}return t=l,o=[{key:"annotationsMatch",value:function(e,t){return!e&&!t||!(e&&!t||!e&&t)&&(0===e.length&&0===t.length||e.length===t.length&&e.every((function(e,n){var o=e.resources.map((function(e){return e.id})),r=t[n].resources.map((function(e){return e.id}));return 0===o.length&&0===r.length||o.length===r.length&&!(e.id!==t[n].id||!x()(o,r))})))}}],(n=[{key:"componentDidMount",value:function(){this.initializeViewer()}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.drawAnnotations,o=t.drawSearchAnnotations,r=t.annotations,h=t.searchAnnotations,c=t.hoveredAnnotationIds,d=t.selectedAnnotationId,m=t.highlightAllAnnotations,v=t.viewer;this.initializeViewer();var f=!l.annotationsMatch(r,e.annotations),w=!l.annotationsMatch(h,e.searchAnnotations),y=D()(c,e.hoveredAnnotationIds).length>0;this.osdCanvasOverlay&&y&&(c.length>0?this.osdCanvasOverlay.canvasDiv.style.cursor="pointer":this.osdCanvasOverlay.canvasDiv.style.cursor="");var T=d!==e.selectedAnnotationId,x=n!==e.drawAnnotations||o!==e.drawSearchAnnotations||m!==e.highlightAllAnnotations;(w||f||T||y||x)&&(this.updateCanvas=this.canvasUpdateCallback(),v.forceRedraw())}},{key:"componentWillUnmount",value:function(){var e=this.props.viewer;e.removeHandler("canvas-click",this.onCanvasClick),e.removeHandler("canvas-exit",this.onCanvasExit),e.removeHandler("update-viewport",this.onUpdateViewport),e.removeHandler("mouse-move",this.onCanvasMouseMove)}},{key:"onCanvasClick",value:function(e){var t=this,n=this.props.canvasWorld,o=e.position,r=e.eventSource.viewport.pointFromPixel(o),canvas=n.canvasAtPoint(r);if(canvas){var l=U(n.canvasToWorldCoordinates(canvas.id),4),h=(l[0],l[1],l[2]),c=l[3],d=this.annotationsAtPoint(canvas,r);if(d.length>0&&(e.preventDefaultAction=!0),1===d.length)this.toggleAnnotation(d[0].id);else if(d.length>0){var m=function(e){var n=Math.PI/180;return function(o){for(var l=0,h=0;h<360;h+=1){var c=Math.cos(h*n)*e+r.x,d=Math.sin(h*n)*e+r.y;t.isAnnotationAtPoint(o,canvas,{x:c,y:d})&&(l+=1)}return{anno:o,score:l}}},v=[],f=1;for(v=k()(d.map(m(f)),"score");f<Math.max(h,c)&&v[0].score===v[1].score;)f*=2,v=k()(d.map(m(f)),"score");this.toggleAnnotation(v[0].anno.id)}}}},{key:"onCanvasMouseMove",value:function(e){var t=this.props,n=t.annotations,o=t.canvasWorld,r=t.hoverAnnotation,l=t.hoveredAnnotationIds,h=t.searchAnnotations,c=t.viewer,d=t.windowId;if(0!==n.length||0!==h.length){var m=e.position,v=c.viewport.pointFromPixel(m),canvas=o.canvasAtPoint(v);if(canvas){var f=this.annotationsAtPoint(canvas,v);D()(l,f.map((function(a){return a.id}))).length>0&&r(d,f.map((function(a){return a.id})))}else r(d,[])}}},{key:"onCanvasExit",value:function(e){var t=this.props,n=t.hoverAnnotation,o=t.windowId;this.onCanvasMouseMove.cancel(),n(o,[])}},{key:"onUpdateViewport",value:function(e){this.updateCanvas()}},{key:"initializeViewer",value:function(){var e=this.props.viewer;e&&(this.osdCanvasOverlay||(this.osdCanvasOverlay=new M(e,this.ref),e.addHandler("canvas-click",this.onCanvasClick),e.addHandler("canvas-exit",this.onCanvasExit),e.addHandler("update-viewport",this.onUpdateViewport),e.addHandler("mouse-move",this.onCanvasMouseMove),this.updateCanvas=this.canvasUpdateCallback()))}},{key:"canvasUpdateCallback",value:function(){var e=this;return function(){e.osdCanvasOverlay.clear(),e.osdCanvasOverlay.resize(),e.osdCanvasOverlay.canvasUpdate(e.renderAnnotations.bind(e))}}},{key:"isAnnotationAtPoint",value:function(e,canvas,t){var n=U(this.props.canvasWorld.canvasToWorldCoordinates(canvas.id),2),o=n[0],r=n[1],l=t.x-o,h=t.y-r;if(e.svgSelector){var c=this.osdCanvasOverlay.context2d;return V(new L({resource:e}).svgPaths).some((function(path){return c.isPointInPath(new Path2D(path.attributes.d.nodeValue),l,h)}))}if(e.fragmentSelector){var d=U(e.fragmentSelector,4),m=d[0],v=d[1],f=d[2],w=d[3];return m<=l&&l<=m+f&&v<=h&&h<=v+w}return!1}},{key:"annotationsAtPoint",value:function(canvas,e){var t=this,n=this.props,o=n.annotations,r=n.searchAnnotations,l=[].concat(V(o),V(r));return d()(l.map((function(e){return e.resources}))).filter((function(n){return canvas.id===n.targetId&&t.isAnnotationAtPoint(n,canvas,e)}))}},{key:"toggleAnnotation",value:function(e){var t=this.props,n=t.selectedAnnotationId,o=t.selectAnnotation,r=t.deselectAnnotation,l=t.windowId;n===e?r(l,e):o(l,e)}},{key:"annotationsToContext",value:function(e,t){var n=this.props,o=n.highlightAllAnnotations,r=n.hoveredAnnotationIds,l=n.selectedAnnotationId,h=n.canvasWorld,c=n.viewer,d=this.osdCanvasOverlay.context2d,m=c.viewport.getZoom(!0)/c.viewport.getMaxZoom();e.forEach((function(e){e.resources.forEach((function(e){if(h.canvasIds.includes(e.targetId)){var n=h.offsetByCanvas(e.targetId);new L({hovered:r.includes(e.id),offset:n,palette:j(j({},t),{},{default:j(j({},t.default),!o&&t.hidden)}),resource:e,selected:l===e.id,zoomRatio:m}).toContext(d)}}))}))}},{key:"renderAnnotations",value:function(){var e=this.props,t=e.annotations,n=e.drawAnnotations,o=e.drawSearchAnnotations,r=e.searchAnnotations,l=e.palette;o&&this.annotationsToContext(r,l.search),n&&this.annotationsToContext(t,l.annotations)}},{key:"render",value:function(){var e=this.props.viewer;return e?O.a.createPortal(f.a.createElement("div",{ref:this.ref,style:{height:"100%",left:0,position:"absolute",top:0,width:"100%"}},f.a.createElement("canvas",null)),e.canvas):f.a.createElement(f.a.Fragment,null)}}])&&Z(t.prototype,n),o&&Z(t,o),l}(v.Component);ee.defaultProps={annotations:[],deselectAnnotation:function(){},drawAnnotations:!0,drawSearchAnnotations:!0,highlightAllAnnotations:!1,hoverAnnotation:function(){},hoveredAnnotationIds:[],palette:{},searchAnnotations:[],selectAnnotation:function(){},selectedAnnotationId:void 0,viewer:null};var te=n(709),ie=n(795),ne=n(747),oe=n(471),re=n(525),se=n(422),ae=n(715),le={deselectAnnotation:te.a,hoverAnnotation:te.b,selectAnnotation:te.g},he=Object(o.compose)(Object(l.a)(),Object(r.b)((function(e,t){var n=t.windowId;return{annotations:Object(ie.d)(e,{windowId:n}),canvasWorld:Object(ne.a)(e,{windowId:n}),drawAnnotations:Object(oe.a)(e).window.forceDrawAnnotations||Object(re.e)(e,{content:"annotations",windowId:n}).length>0,drawSearchAnnotations:Object(oe.a)(e).window.forceDrawAnnotations||Object(re.e)(e,{content:"search",windowId:n}).length>0,highlightAllAnnotations:Object(se.e)(e,{windowId:n}).highlightAllAnnotations,hoveredAnnotationIds:Object(se.e)(e,{windowId:n}).hoveredAnnotationIds,palette:Object(oe.g)(e).palette,searchAnnotations:Object(ae.f)(e,{windowId:n}),selectedAnnotationId:Object(ie.e)(e,{windowId:n})}}),le),Object(m.a)("AnnotationsOverlay"))(ee),ce=n(406),ue={get:function(e){return this.refs[e]},refs:{},set:function(e,t){this.refs[e]=t}};function de(e,t,n){return(de=Se()?Reflect.construct:function(e,t,n){var a=[null];a.push.apply(a,t);var o=new(Function.bind.apply(e,a));return n&&ye(o,n.prototype),o}).apply(null,arguments)}function pe(e){return function(e){if(Array.isArray(e))return ge(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return ge(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ge(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function me(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function ve(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?me(Object(source),!0).forEach((function(t){fe(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):me(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}function fe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function we(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ye(e,p){return(ye=Object.setPrototypeOf||function(e,p){return e.__proto__=p,e})(e,p)}function Te(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?xe(e):t}function xe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Se(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Ee(e){return(Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ye(e,t)}(c,e);var t,n,o,r,l,h=(t=c,n=Se(),function(){var e,o=Ee(t);if(n){var r=Ee(this).constructor;e=Reflect.construct(o,arguments,r)}else e=o.apply(this,arguments);return Te(this,e)});function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=h.call(this,e)).state={viewer:void 0},t.ref=f.a.createRef(),t.apiRef=f.a.createRef(),ue.set(e.windowId,t.apiRef),t.onCanvasMouseMove=y()(t.onCanvasMouseMove.bind(xe(t)),10),t.onViewportChange=t.onViewportChange.bind(xe(t)),t.zoomToWorld=t.zoomToWorld.bind(xe(t)),t.osdUpdating=!1,t}return o=c,(r=[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.osdConfig,o=t.t,r=t.windowId;if(this.ref.current){var l=new E.a(ve({id:this.ref.current.id},n)),canvas=l.canvas&&l.canvas.firstElementChild;canvas&&(canvas.setAttribute("role","img"),canvas.setAttribute("aria-label",o("digitizedView")),canvas.setAttribute("aria-describedby","".concat(r,"-osd"))),this.apiRef.current=l,this.setState({viewer:l}),l.addHandler("animation-start",(function(){e.osdUpdating=!0})),l.addHandler("animation-finish",this.onViewportChange),l.addHandler("animation-finish",(function(){e.osdUpdating=!1})),l.innerTracker&&(l.innerTracker.moveHandler=this.onCanvasMouseMove)}}},{key:"componentDidUpdate",value:function(e,t){var n=this.props,o=n.viewerConfig,r=n.canvasWorld,l=this.state.viewer;if(this.apiRef.current=l,void 0===t.viewer)return o&&(l.viewport.panTo(o,!0),l.viewport.zoomTo(o.zoom,o,!0),void 0!==o.degrees&&l.viewport.setRotation(o.degrees),void 0!==o.flip&&l.viewport.setFlip(o.flip)),void this.addAllImageSources(!o);if(this.infoResponsesMatch(e.infoResponses)&&this.nonTiledImagedMatch(e.nonTiledImages))if(x()(r.layers,e.canvasWorld.layers)){if(o&&!this.osdUpdating){var h=l.viewport;o.x===h.centerSpringX.target.value&&o.y===h.centerSpringY.target.value||h.panTo(o,!1),o.zoom!==h.zoomSpring.target.value&&h.zoomTo(o.zoom,o,!1),o.rotation!==h.getRotation()&&h.setRotation(o.rotation),o.flip!==h.getFlip()&&h.setFlip(o.flip)}}else this.refreshTileProperties();else{l.close();var c=!x()(r.canvasIds,e.canvasWorld.canvasIds);this.addAllImageSources(c||!o)}}},{key:"componentWillUnmount",value:function(){var e=this.state.viewer;e.innerTracker&&e.innerTracker.moveHandler===this.onCanvasMouseMove&&(e.innerTracker.moveHandler=null),e.removeAllHandlers(),this.apiRef.current=void 0}},{key:"onCanvasMouseMove",value:function(e){this.state.viewer.raiseEvent("mouse-move",e)}},{key:"onViewportChange",value:function(e){var t=this.props,n=t.updateViewport,o=t.windowId,r=e.eventSource.viewport;n(o,{flip:r.getFlip(),rotation:r.getRotation(),x:Math.round(r.centerSpringX.target.value),y:Math.round(r.centerSpringY.target.value),zoom:r.zoomSpring.target.value})}},{key:"addAllImageSources",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=this.props,o=n.nonTiledImages,r=n.infoResponses;Promise.all(r.map((function(t){return e.addTileSource(t)})),o.map((function(image){return e.addNonTiledImage(image)}))).then((function(){(r[0]||o[0])&&(t&&e.zoomToWorld(),e.refreshTileProperties())}))}},{key:"addNonTiledImage",value:function(e){var t=this.props.canvasWorld,n=this.state.viewer,o=e.getProperty("type"),r=e.getProperty("format")||"";return"Image"===o||"dctypes:Image"===o||r.startsWith("image/")?new Promise((function(o,r){n||r(),n.addSimpleImage({error:function(e){return r(e)},fitBounds:de(E.a.Rect,pe(t.contentResourceToWorldCoordinates(e))),index:t.layerIndexOfImageResource(e),opacity:t.layerOpacityOfImageResource(e),success:function(e){return o(e)},url:e.id})})):Promise.resolve()}},{key:"addTileSource",value:function(e){var t=this.props.canvasWorld,n=this.state.viewer;return new Promise((function(o,r){n||r();var l=ve({},e.json),h=t.contentResource(e.id);h&&n.addTiledImage({error:function(e){return r(e)},fitBounds:de(E.a.Rect,pe(t.contentResourceToWorldCoordinates(h))),index:t.layerIndexOfImageResource(h),opacity:t.layerOpacityOfImageResource(h),success:function(e){return o(e)},tileSource:l})}))}},{key:"refreshTileProperties",value:function(){for(var e=this.props.canvasWorld,t=this.state.viewer.world,n=[],i=0;i<t.getItemCount();i+=1)n.push(t.getItemAt(i));n.forEach((function(n,i){var o=e.contentResource(n.source["@id"]||n.source.id);if(o){var r=e.layerIndexOfImageResource(o);i!==r&&t.setItemIndex(n,r),n.setOpacity(e.layerOpacityOfImageResource(o))}}))}},{key:"fitBounds",value:function(e,t,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],l=this.state.viewer;l.viewport.fitBounds(new E.a.Rect(e,t,n,o),r)}},{key:"infoResponsesMatch",value:function(e){var t=this.props.infoResponses;return 0===t.length&&0===e.length||t.length===e.length&&t.every((function(t,n){return!!(e[n]&&t.json&&e[n].json&&t.tokenServiceId===e[n].tokenServiceId&&(t.json["@id"]&&t.json["@id"]===e[n].json["@id"]||t.json.id&&t.json.id===e[n].json.id))}))}},{key:"nonTiledImagedMatch",value:function(e){var t=this.props.nonTiledImages;return 0===t.length&&0===e.length||t.some((function(image,t){return!!e[t]&&image.id===e[t].id}))}},{key:"zoomToWorld",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.props.canvasWorld;this.fitBounds.apply(this,pe(t.worldBounds()).concat([e]))}},{key:"render",value:function(){var e=this,t=this.props,n=t.children,o=t.classes,label=t.label,r=t.t,l=t.windowId,h=t.drawAnnotations,c=this.state.viewer,d=f.a.Children.map(n,(function(t){return f.a.cloneElement(t,{zoomToWorld:e.zoomToWorld})}));return f.a.createElement(f.a.Fragment,null,f.a.createElement("section",{className:_()(Object(R.a)("osd-container"),o.osdContainer),id:"".concat(l,"-osd"),ref:this.ref,"aria-label":r("item",{label:label}),"aria-live":"polite"},h&&f.a.createElement(he,{viewer:c,windowId:l}),d,f.a.createElement(ce.a,Object.assign({viewer:c},ve(ve({},this.props),{},{children:null})))))}}])&&we(o.prototype,r),l&&we(o,l),c}(v.Component);Pe.defaultProps={children:null,drawAnnotations:!1,infoResponses:[],label:null,nonTiledImages:[],osdConfig:{},viewerConfig:null};var be=n(667),_e=n(438),Re={updateViewport:be.d},Ce=Object(o.compose)(Object(h.a)({osdContainer:{flex:1,position:"relative"}}),Object(l.a)(),Object(r.b)((function(e,t){var n=t.windowId,o=Object(ne.a)(e,{windowId:n}),r=Object(_e.q)(e),l=d()(o.canvases.map((function(e){return e.imageServiceIds})));return{canvasWorld:o,drawAnnotations:Object(oe.a)(e).window.forceDrawAnnotations||Object(re.e)(e,{content:"annotations",windowId:n}).length>0||Object(re.e)(e,{content:"search",windowId:n}).length>0,infoResponses:l.map((function(e){return r[e]})).filter((function(e){return void 0!==e&&!1===e.isFetching&&void 0===e.error})),label:Object(_e.e)(e,{canvasId:(Object(_e.g)(e,{windowId:n})||{}).id,windowId:n}),nonTiledImages:Object(_e.m)(e,{windowId:n}),osdConfig:Object(oe.a)(e).osdConfig,viewerConfig:Object(se.d)(e,{windowId:n})}}),Re),Object(m.a)("OpenSeadragonViewer"));t.default=Ce(Pe)},786:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,$,fullScreenApi;function OpenSeadragon(e){return new OpenSeadragon.Viewer(e)}!function(e){e.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var t,n={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},o=Object.prototype.toString,r=Object.prototype.hasOwnProperty;e.isFunction=function(t){return"function"===e.type(t)},e.isArray=Array.isArray||function(t){return"array"===e.type(t)},e.isWindow=function(e){return e&&"object"==typeof e&&"setInterval"in e},e.type=function(e){return null==e?String(e):n[o.call(e)]||"object"},e.isPlainObject=function(t){if(!t||"object"!==OpenSeadragon.type(t)||t.nodeType||e.isWindow(t))return!1;if(t.constructor&&!r.call(t,"constructor")&&!r.call(t.constructor.prototype,"isPrototypeOf"))return!1;var n;for(var o in t)n=o;return void 0===n||r.call(t,n)},e.isEmptyObject=function(e){for(var t in e)return!1;return!0},e.freezeObject=function(t){return Object.freeze?e.freezeObject=Object.freeze:e.freezeObject=function(e){return e},e.freezeObject(t)},e.supportsCanvas=(t=document.createElement("canvas"),!(!e.isFunction(t.getContext)||!t.getContext("2d"))),e.isCanvasTainted=function(canvas){var e=!1;try{canvas.getContext("2d").getImageData(0,0,1,1)}catch(t){e=!0}return e},e.pixelDensityRatio=function(){if(e.supportsCanvas){var t=document.createElement("canvas").getContext("2d"),n=window.devicePixelRatio||1,o=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return Math.max(n,1)/o}return 1}()}(OpenSeadragon),function($){$.extend=function(){var e,t,n,o,r,l,h=arguments[0]||{},c=arguments.length,d=!1,i=1;for("boolean"==typeof h&&(d=h,h=arguments[1]||{},i=2),"object"==typeof h||OpenSeadragon.isFunction(h)||(h={}),c===i&&(h=this,--i);i<c;i++)if(null!==(e=arguments[i])||void 0!==e)for(t in e)n=h[t],h!==(o=e[t])&&(d&&o&&(OpenSeadragon.isPlainObject(o)||(r=OpenSeadragon.isArray(o)))?(r?(r=!1,l=n&&OpenSeadragon.isArray(n)?n:[]):l=n&&OpenSeadragon.isPlainObject(n)?n:{},h[t]=OpenSeadragon.extend(d,l,o)):void 0!==o&&(h[t]=o));return h};var isIOSDevice=function(){if("object"!=typeof navigator)return!1;var e=navigator.userAgent;return"string"==typeof e&&(-1!==e.indexOf("iPhone")||-1!==e.indexOf("iPad")||-1!==e.indexOf("iPod"))};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(object,e){return function(){var t=arguments;return void 0===t&&(t=[]),e.apply(object,t)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(element){return"string"==typeof element&&(element=document.getElementById(element)),element},getElementPosition:function(element){var e,t,n=new $.Point;for(t=getOffsetParent(element=$.getElement(element),e="fixed"==$.getElementStyle(element).position);t;)n.x+=element.offsetLeft,n.y+=element.offsetTop,e&&(n=n.plus($.getPageScroll())),t=getOffsetParent(element=t,e="fixed"==$.getElementStyle(element).position);return n},getElementOffset:function(element){var e,t,n=(element=$.getElement(element))&&element.ownerDocument,o={top:0,left:0};return n?(e=n.documentElement,void 0!==element.getBoundingClientRect&&(o=element.getBoundingClientRect()),t=n==n.window?n:9===n.nodeType&&(n.defaultView||n.parentWindow),new $.Point(o.left+(t.pageXOffset||e.scrollLeft)-(e.clientLeft||0),o.top+(t.pageYOffset||e.scrollTop)-(e.clientTop||0))):new $.Point},getElementSize:function(element){return element=$.getElement(element),new $.Point(element.clientWidth,element.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(element){return(element=$.getElement(element)).currentStyle}:function(element){return element=$.getElement(element),window.getComputedStyle(element,"")},getCssPropertyWithVendorPrefix:function(e){var t={};return $.getCssPropertyWithVendorPrefix=function(e){if(void 0!==t[e])return t[e];var style=document.createElement("div").style,n=null;if(void 0!==style[e])n=e;else for(var o=["Webkit","Moz","MS","O","webkit","moz","ms","o"],r=$.capitalizeFirstLetter(e),i=0;i<o.length;i++){var l=o[i]+r;if(void 0!==style[l]){n=l;break}}return t[e]=n,n},$.getCssPropertyWithVendorPrefix(e)},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},positiveModulo:function(e,t){var n=e%t;return n<0&&(n+=t),n},pointInElement:function(element,e){element=$.getElement(element);var t=$.getElementOffset(element),n=$.getElementSize(element);return e.x>=t.x&&e.x<t.x+n.x&&e.y<t.y+n.y&&e.y>=t.y},getEvent:function(e){return $.getEvent=e?function(e){return e}:function(){return window.event},$.getEvent(e)},getMousePosition:function(e){if("number"==typeof e.pageX)$.getMousePosition=function(e){var t=new $.Point;return e=$.getEvent(e),t.x=e.pageX,t.y=e.pageY,t};else{if("number"!=typeof e.clientX)throw new Error("Unknown event mouse position, no known technique.");$.getMousePosition=function(e){var t=new $.Point;return e=$.getEvent(e),t.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop,t}}return $.getMousePosition(e)},getPageScroll:function(){var e=document.documentElement||{},body=document.body||{};if("number"==typeof window.pageXOffset)$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(body.scrollLeft||body.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!e.scrollLeft&&!e.scrollTop)return new $.Point(0,0);$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return $.getPageScroll()},setPageScroll:function(e){if(void 0!==window.scrollTo)$.setPageScroll=function(e){window.scrollTo(e.x,e.y)};else{var t=$.getPageScroll();if(t.x===e.x&&t.y===e.y)return;document.body.scrollLeft=e.x,document.body.scrollTop=e.y;var n=$.getPageScroll();if(n.x!==t.x&&n.y!==t.y)return void($.setPageScroll=function(e){document.body.scrollLeft=e.x,document.body.scrollTop=e.y});if(document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y,(n=$.getPageScroll()).x!==t.x&&n.y!==t.y)return void($.setPageScroll=function(e){document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y});$.setPageScroll=function(e){}}return $.setPageScroll(e)},getWindowSize:function(){var e=document.documentElement||{},body=document.body||{};if("number"==typeof window.innerWidth)$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(e.clientWidth||e.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!body.clientWidth&&!body.clientHeight)throw new Error("Unknown window size, no known technique.");$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)}}return $.getWindowSize()},makeCenteredNode:function(element){element=$.getElement(element);var e=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(e[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(e[1].style,{display:"table-row"}),$.extend(e[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),e[0].appendChild(e[1]),e[1].appendChild(e[2]),e[2].appendChild(element),e[0]},makeNeutralElement:function(e){var element=document.createElement(e),style=element.style;return style.background="transparent none",style.border="none",style.margin="0px",style.padding="0px",style.position="static",element},now:function(){return Date.now?$.now=Date.now:$.now=function(){return(new Date).getTime()},$.now()},makeTransparentImage:function(e){return $.makeTransparentImage=function(e){var img=$.makeNeutralElement("img");return img.src=e,img},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(e){var img=$.makeNeutralElement("img"),element=null;return(element=$.makeNeutralElement("span")).style.display="inline-block",img.onload=function(){element.style.width=element.style.width||img.width+"px",element.style.height=element.style.height||img.height+"px",img.onload=null,img=null},img.src=e,element.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e+"', sizingMethod='scale')",element}),$.makeTransparentImage(e)},setElementOpacity:function(element,e,t){var n;element=$.getElement(element),t&&!$.Browser.alpha&&(e=Math.round(e)),$.Browser.opacity?element.style.opacity=e<1?e:"":e<1?(n="alpha(opacity="+Math.round(100*e)+")",element.style.filter=n):element.style.filter=""},setElementTouchActionNone:function(element){void 0!==(element=$.getElement(element)).style.touchAction?element.style.touchAction="none":void 0!==element.style.msTouchAction&&(element.style.msTouchAction="none")},addClass:function(element,e){(element=$.getElement(element)).className?-1===(" "+element.className+" ").indexOf(" "+e+" ")&&(element.className+=" "+e):element.className=e},indexOf:function(e,t,n){return Array.prototype.indexOf?this.indexOf=function(e,t,n){return e.indexOf(t,n)}:this.indexOf=function(e,t,n){var i,o,r=n||0;if(!e)throw new TypeError;if(0===(o=e.length)||r>=o)return-1;for(r<0&&(r=o-Math.abs(r)),i=r;i<o;i++)if(e[i]===t)return i;return-1},this.indexOf(e,t,n)},removeClass:function(element,e){var t,i,n=[];for(t=(element=$.getElement(element)).className.split(/\s+/),i=0;i<t.length;i++)t[i]&&t[i]!==e&&n.push(t[i]);element.className=n.join(" ")},addEvent:function(){if(window.addEventListener)return function(element,e,t,n){(element=$.getElement(element)).addEventListener(e,t,n)};if(window.attachEvent)return function(element,e,t,n){(element=$.getElement(element)).attachEvent("on"+e,t)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(element,e,t,n){(element=$.getElement(element)).removeEventListener(e,t,n)};if(window.detachEvent)return function(element,e,t,n){(element=$.getElement(element)).detachEvent("on"+e,t)};throw new Error("No known event model.")}(),cancelEvent:function(e){(e=$.getEvent(e)).preventDefault?$.cancelEvent=function(e){e.preventDefault()}:$.cancelEvent=function(e){(e=$.getEvent(e)).cancel=!0,e.returnValue=!1},$.cancelEvent(e)},stopEvent:function(e){(e=$.getEvent(e)).stopPropagation?$.stopEvent=function(e){e.stopPropagation()}:$.stopEvent=function(e){(e=$.getEvent(e)).cancelBubble=!0},$.stopEvent(e)},createCallback:function(object,e){var i,t=[];for(i=2;i<arguments.length;i++)t.push(arguments[i]);return function(){var i,n=t.concat([]);for(i=0;i<arguments.length;i++)n.push(arguments[i]);return e.apply(object,n)}},getUrlParameter:function(e){var t=URLPARAMS[e];return t||null},getUrlProtocol:function(e){var t=e.match(/^([a-z]+:)\/\//i);return null===t?window.location.protocol:t[1].toLowerCase()},createAjaxRequest:function(e){var t;try{t=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=!1}if(t)window.XMLHttpRequest?$.createAjaxRequest=function(e){return e?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");$.createAjaxRequest=function(){return new XMLHttpRequest}}return $.createAjaxRequest(e)},makeAjaxRequest:function(e,t,n){var o,r,l;$.isPlainObject(e)&&(t=e.success,n=e.error,o=e.withCredentials,r=e.headers,l=e.responseType||null,e=e.url);var h=$.getUrlProtocol(e),c=$.createAjaxRequest("file:"===h);if(!$.isFunction(t))throw new Error("makeAjaxRequest requires a success callback");c.onreadystatechange=function(){4==c.readyState&&(c.onreadystatechange=function(){},c.status>=200&&c.status<300||0===c.status&&"http:"!==h&&"https:"!==h?t(c):($.console.log("AJAX request returned %d: %s",c.status,e),$.isFunction(n)&&n(c)))};try{if(c.open("GET",e,!0),l&&(c.responseType=l),r)for(var d in r)Object.prototype.hasOwnProperty.call(r,d)&&r[d]&&c.setRequestHeader(d,r[d]);o&&(c.withCredentials=!0),c.send(null)}catch(o){var m=o.message;if($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10&&void 0!==o.number&&-2147024891==o.number&&(m+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),$.console.log("%s while making AJAX request: %s",o.name,m),c.onreadystatechange=function(){},window.XDomainRequest){var v=new window.XDomainRequest;if(v){v.onload=function(e){$.isFunction(t)&&t({responseText:v.responseText,status:200,statusText:"OK"})},v.onerror=function(e){$.isFunction(n)&&n({responseText:v.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{v.open("GET",e),v.send()}catch(e){$.isFunction(n)&&n(c,o)}}}else $.isFunction(n)&&n(c,o)}return c},jsonp:function(e){var script,t=e.url,head=document.head||document.getElementsByTagName("head")[0]||document.documentElement,n=e.callbackName||"openseadragon"+$.now(),o=window[n],r="$1"+n+"$2",l=e.param||"callback",h=e.callback;t=t.replace(/(\=)\?(&|$)|\?\?/i,r),t+=(/\?/.test(t)?"&":"?")+l+"="+n,window[n]=function(e){if(o)window[n]=o;else try{delete window[n]}catch(e){}h&&$.isFunction(h)&&h(e)},script=document.createElement("script"),void 0===e.async&&!1===e.async||(script.async="async"),e.scriptCharset&&(script.charset=e.scriptCharset),script.src=t,script.onload=script.onreadystatechange=function(e,t){(t||!script.readyState||/loaded|complete/.test(script.readyState))&&(script.onload=script.onreadystatechange=null,head&&script.parentNode&&head.removeChild(script),script=void 0)},head.insertBefore(script,head.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(e){if(window.DOMParser)$.parseXml=function(e){return(new DOMParser).parseFromString(e,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");$.parseXml=function(e){var t=null;return(t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e),t}}return $.parseXml(e)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(e){return!!FILEFORMATS[(e=e||"").toLowerCase()]}});var nullfunction=function(e){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};function getOffsetParent(element,e){return e&&element!=document.body?document.body:element.offsetParent}!function(){var e=navigator.appVersion,t=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(t.substring(t.indexOf("MSIE")+5,t.indexOf(";",t.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(t.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(t.substring(t.indexOf("Firefox")+8))):t.indexOf("Safari")>=0?($.Browser.vendor=t.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(t.substring(t.substring(0,t.indexOf("Safari")).lastIndexOf("/")+1,t.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(t)&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(e)}var n,o,i,r=window.location.search.substring(1).split("&");for(i=0;i<r.length;i++)if((o=(n=r[i]).indexOf("="))>0){var l=n.substring(0,o),h=n.substring(o+1);try{URLPARAMS[l]=decodeURIComponent(h)}catch(e){$.console.error("Ignoring malformed URL parameter: %s=%s",l,h)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)}(),function(e){var t=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame,n=e.cancelAnimationFrame||e.mozCancelAnimationFrame||e.webkitCancelAnimationFrame||e.msCancelAnimationFrame;if(t&&n)$.requestAnimationFrame=function(){return t.apply(e,arguments)},$.cancelAnimationFrame=function(){return n.apply(e,arguments)};else{var o,r=[],l=[],h=0;$.requestAnimationFrame=function(e){return r.push([++h,e]),o||(o=setInterval((function(){if(r.length){var time=$.now(),e=l;for(l=r,r=e;l.length;)l.shift()[1](time)}else clearInterval(o),o=void 0}),20)),h},$.cancelAnimationFrame=function(e){var i,t;for(i=0,t=r.length;i<t;i+=1)if(r[i][0]===e)return void r.splice(i,1);for(i=0,t=l.length;i<t;i+=1)if(l[i][0]===e)return void l.splice(i,1)}}}(window)}(OpenSeadragon),__WEBPACK_AMD_DEFINE_ARRAY__=[],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=function(){return OpenSeadragon})?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),$=OpenSeadragon,fullScreenApi={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""},document.exitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.fullscreenElement},fullScreenApi.requestFullScreen=function(element){return element.requestFullscreen()},fullScreenApi.exitFullScreen=function(){document.exitFullscreen()},fullScreenApi.fullScreenEventName="fullscreenchange",fullScreenApi.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.msFullscreenElement},fullScreenApi.requestFullScreen=function(element){return element.msRequestFullscreen()},fullScreenApi.exitFullScreen=function(){document.msExitFullscreen()},fullScreenApi.fullScreenEventName="MSFullscreenChange",fullScreenApi.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.webkitFullscreenElement},fullScreenApi.requestFullScreen=function(element){return element.webkitRequestFullscreen()},fullScreenApi.exitFullScreen=function(){document.webkitExitFullscreen()},fullScreenApi.fullScreenEventName="webkitfullscreenchange",fullScreenApi.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},fullScreenApi.requestFullScreen=function(element){return element.webkitRequestFullScreen()},fullScreenApi.exitFullScreen=function(){document.webkitCancelFullScreen()},fullScreenApi.fullScreenEventName="webkitfullscreenchange",fullScreenApi.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.mozFullScreenElement},fullScreenApi.requestFullScreen=function(element){return element.mozRequestFullScreen()},fullScreenApi.exitFullScreen=function(){document.mozCancelFullScreen()},fullScreenApi.fullScreenEventName="mozfullscreenchange",fullScreenApi.fullScreenErrorEventName="mozfullscreenerror"),fullScreenApi.isFullScreen=function(){return null!==fullScreenApi.getFullScreenElement()},fullScreenApi.cancelFullScreen=function(){$.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),fullScreenApi.exitFullScreen()},$.extend($,fullScreenApi),function(e){e.EventSource=function(){this.events={}},e.EventSource.prototype={addOnceHandler:function(e,t,n,o){var r=this;o=o||1;var l=0,h=function(n){++l===o&&r.removeHandler(e,h),t(n)};this.addHandler(e,h,n)},addHandler:function(t,n,o){var r=this.events[t];r||(this.events[t]=r=[]),n&&e.isFunction(n)&&(r[r.length]={handler:n,userData:o||null})},removeHandler:function(t,n){var i,o=this.events[t],r=[];if(o&&e.isArray(o)){for(i=0;i<o.length;i++)o[i].handler!==n&&r.push(o[i]);this.events[t]=r}},removeAllHandlers:function(e){if(e)this.events[e]=[];else for(var t in this.events)this.events[t]=[]},getHandler:function(e){var t=this.events[e];return t&&t.length?(t=1===t.length?[t[0]]:Array.apply(null,t),function(source,e){var i,n=t.length;for(i=0;i<n;i++)t[i]&&(e.eventSource=source,e.userData=t[i].userData,t[i].handler(e))}):null},raiseEvent:function(e,t){var n=this.getHandler(e);n&&(t||(t={}),n(this,t))}}}(OpenSeadragon),function(e){var t,n,o,r,l,h,c=[],d={};function m(t){var i,n=d[t.hash],o=n.activePointersLists.length;for(i=0;i<o;i++)n.activePointersLists[i].captureCount>0&&(e.removeEvent(e.MouseTracker.captureElement,"mousemove",n.mousemovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"mouseup",n.mouseupcaptured,!0),e.removeEvent(e.MouseTracker.captureElement,e.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",n.pointermovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,e.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",n.pointerupcaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"touchmove",n.touchmovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"touchend",n.touchendcaptured,!0),n.activePointersLists[i].captureCount=0);for(i=0;i<o;i++)n.activePointersLists.pop()}function v(t){var n,i,o=d[t.hash];if(o.tracking){for(i=0;i<e.MouseTracker.subscribeEvents.length;i++)n=e.MouseTracker.subscribeEvents[i],e.removeEvent(t.element,n,o[n],!1);m(t),o.tracking=!1}}function f(t,n){var o=d[t.hash];if("pointerevent"===n)return{upName:e.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:o.pointerupcaptured,moveName:e.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:o.pointermovecaptured};if("mouse"===n)return{upName:"mouseup",upHandler:o.mouseupcaptured,moveName:"mousemove",moveHandler:o.mousemovecaptured};if("touch"===n)return{upName:"touchend",upHandler:o.touchendcaptured,moveName:"touchmove",moveHandler:o.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function w(t,n,o){var r,l=t.getActivePointersListByType(n);l.captureCount+=o||1,1===l.captureCount&&(e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?t.element.setCapture(!0):(r=f(t,e.MouseTracker.havePointerEvents?"pointerevent":n),_e&&Re(window.top)&&e.addEvent(window.top,r.upName,r.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,r.upName,r.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,r.moveName,r.moveHandler,!0)))}function y(t,n,o){var r,l=t.getActivePointersListByType(n);l.captureCount-=o||1,0===l.captureCount&&(e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?t.element.releaseCapture():(r=f(t,e.MouseTracker.havePointerEvents?"pointerevent":n),_e&&Re(window.top)&&e.removeEvent(window.top,r.upName,r.upHandler,!0),e.removeEvent(e.MouseTracker.captureElement,r.moveName,r.moveHandler,!0),e.removeEvent(e.MouseTracker.captureElement,r.upName,r.upHandler,!0)))}function T(t){var n;if(e.MouseTracker.unprefixedPointerEvents)n=t.pointerType;else switch(t.pointerType){case 2:n="touch";break;case 3:n="pen";break;case 4:n="mouse";break;default:n=""}return n}function x(t){return e.getMousePosition(t)}function S(e,element){return E(x(e),element)}function E(t,element){var n=e.getElementOffset(element);return t.minus(n)}function P(t,n){return new e.Point((t.x+n.x)/2,(t.y+n.y)/2)}function _(t,n){t.clickHandler&&e.cancelEvent(n)}function R(t,n){t.dblClickHandler&&e.cancelEvent(n)}function C(t,n){t.keyDownHandler&&(n=e.getEvent(n),t.keyDownHandler({eventSource:t,keyCode:n.keyCode?n.keyCode:n.charCode,ctrl:n.ctrlKey,shift:n.shiftKey,alt:n.altKey,meta:n.metaKey,originalEvent:n,preventDefaultAction:!1,userData:t.userData})||e.cancelEvent(n))}function O(t,n){t.keyUpHandler&&(n=e.getEvent(n),t.keyUpHandler({eventSource:t,keyCode:n.keyCode?n.keyCode:n.charCode,ctrl:n.ctrlKey,shift:n.shiftKey,alt:n.altKey,meta:n.metaKey,originalEvent:n,preventDefaultAction:!1,userData:t.userData})||e.cancelEvent(n))}function I(t,n){t.keyHandler&&(n=e.getEvent(n),t.keyHandler({eventSource:t,keyCode:n.keyCode?n.keyCode:n.charCode,ctrl:n.ctrlKey,shift:n.shiftKey,alt:n.altKey,meta:n.metaKey,originalEvent:n,preventDefaultAction:!1,userData:t.userData})||e.cancelEvent(n))}function k(t,n){t.focusHandler&&(n=e.getEvent(n),!1===t.focusHandler({eventSource:t,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n))}function A(t,n){t.blurHandler&&(n=e.getEvent(n),!1===t.blurHandler({eventSource:t,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n))}function D(e,t){M(e,t,t)}function B(t,n){var o={target:(n=e.getEvent(n)).target||n.srcElement,type:"wheel",shiftKey:n.shiftKey||!1,clientX:n.clientX,clientY:n.clientY,pageX:n.pageX?n.pageX:n.clientX,pageY:n.pageY?n.pageY:n.clientY,deltaMode:"MozMousePixelScroll"==n.type?0:1,deltaX:0,deltaZ:0};"mousewheel"==e.MouseTracker.wheelEventName?o.deltaY=-n.wheelDelta/e.DEFAULT_SETTINGS.pixelsPerWheelLine:o.deltaY=n.detail,M(t,o,n)}function M(t,n,o){var r;r=n.deltaY<0?1:-1,t.scrollHandler&&!1===t.scrollHandler({eventSource:t,pointerType:"mouse",position:S(n,t.element),scroll:r,shift:n.shiftKey,isTouchEvent:!1,originalEvent:o,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(o)}function z(e,t){if(e===t)return!1;for(;t&&t!==e;)t=t.parentNode;return t===e}function H(t,n){L(t,n=e.getEvent(n))}function F(t,n){(n=e.getEvent(n)).currentTarget===n.relatedTarget||z(n.currentTarget,n.relatedTarget)||L(t,n)}function L(t,n){xe(t,n,[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:x(n),currentTime:e.now()}])}function N(t,n){W(t,n=e.getEvent(n))}function j(t,n){(n=e.getEvent(n)).currentTarget===n.relatedTarget||z(n.currentTarget,n.relatedTarget)||W(t,n)}function W(t,n){Se(t,n,[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:x(n),currentTime:e.now()}])}function V(button){return e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?1===button?0:2===button?2:4===button?1:-1:button}function U(t,n){Ee(t,n=e.getEvent(n),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:x(n),currentTime:e.now()}],V(n.button))&&(e.stopEvent(n),w(t,"mouse")),(t.clickHandler||t.dblClickHandler||t.pressHandler||t.dragHandler||t.dragEndHandler)&&e.cancelEvent(n)}function G(e,t){Z(e,t)}function $(t,n){Z(t,n),e.stopEvent(n)}function Z(t,n){Pe(t,n=e.getEvent(n),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:x(n),currentTime:e.now()}],V(n.button))&&y(t,"mouse")}function X(e,t){Y(e,t)}function K(t,n){Y(t,n),e.stopEvent(n)}function Y(t,n){be(t,n=e.getEvent(n),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:x(n),currentTime:e.now()}])}function Q(e,t,n){var i,o=n.getLength(),r=[];if("touch"===n.type||n.contacts>0){for(i=0;i<o;i++)r.push(n.getByIndex(i));r.length>0&&(Pe(e,t,r,0),n.captureCount=1,y(e,n.type),Se(e,t,r))}}function J(t,n){var time,i,o,r,l=n.changedTouches.length,h=[],d=t.getActivePointersListByType("touch");for(time=e.now(),d.getLength()>n.touches.length-l&&(e.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),Q(t,n,d)),i=0;i<l;i++)h.push({id:n.changedTouches[i].identifier,type:"touch",currentPos:x(n.changedTouches[i]),currentTime:time});for(xe(t,n,h),i=0;i<c.length;i++)if(c[i]!==t&&c[i].isTracking()&&z(c[i].element,t.element)){for(r=[],o=0;o<l;o++)r.push({id:n.changedTouches[o].identifier,type:"touch",currentPos:x(n.changedTouches[o]),currentTime:time});xe(c[i],n,r)}Ee(t,n,h,0)&&(e.stopEvent(n),w(t,"touch",l)),e.cancelEvent(n)}function ee(e,t){ie(e,t)}function te(t,n){ie(t,n),e.stopEvent(n)}function ie(t,n){var time,i,o,r,l=n.changedTouches.length,h=[];for(time=e.now(),i=0;i<l;i++)h.push({id:n.changedTouches[i].identifier,type:"touch",currentPos:x(n.changedTouches[i]),currentTime:time});for(Pe(t,n,h,0)&&y(t,"touch",l),Se(t,n,h),i=0;i<c.length;i++)if(c[i]!==t&&c[i].isTracking()&&z(c[i].element,t.element)){for(r=[],o=0;o<l;o++)r.push({id:n.changedTouches[o].identifier,type:"touch",currentPos:x(n.changedTouches[o]),currentTime:time});Se(c[i],n,r)}e.cancelEvent(n)}function ne(e,t){re(e,t)}function oe(t,n){re(t,n),e.stopEvent(n)}function re(t,n){var i,o=n.changedTouches.length,r=[];for(i=0;i<o;i++)r.push({id:n.changedTouches[i].identifier,type:"touch",currentPos:x(n.changedTouches[i]),currentTime:e.now()});be(t,n,r),e.cancelEvent(n)}function se(e,t){var n=e.getActivePointersListByType("touch");Q(e,t,n)}function ae(e,t){return t.stopPropagation(),t.preventDefault(),!1}function le(e,t){return t.stopPropagation(),t.preventDefault(),!1}function he(t,n){n.currentTarget===n.relatedTarget||z(n.currentTarget,n.relatedTarget)||xe(t,n,[{id:n.pointerId,type:T(n),isPrimary:n.isPrimary,currentPos:x(n),currentTime:e.now()}])}function ce(t,n){n.currentTarget===n.relatedTarget||z(n.currentTarget,n.relatedTarget)||Se(t,n,[{id:n.pointerId,type:T(n),isPrimary:n.isPrimary,currentPos:x(n),currentTime:e.now()}])}function ue(t,n){var o;Ee(t,n,[o={id:n.pointerId,type:T(n),isPrimary:n.isPrimary,currentPos:x(n),currentTime:e.now()}],n.button)&&(e.stopEvent(n),w(t,o.type)),(t.clickHandler||t.dblClickHandler||t.pressHandler||t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.cancelEvent(n)}function de(e,t){ge(e,t)}function pe(t,n){t.getActivePointersListByType(T(n)).getById(n.pointerId)&&ge(t,n),e.stopEvent(n)}function ge(t,n){var o;Pe(t,n,[o={id:n.pointerId,type:T(n),isPrimary:n.isPrimary,currentPos:x(n),currentTime:e.now()}],n.button)&&y(t,o.type)}function me(e,t){fe(e,t)}function ve(t,n){t.getActivePointersListByType(T(n)).getById(n.pointerId)&&fe(t,n),e.stopEvent(n)}function fe(t,n){be(t,n,[{id:n.pointerId,type:T(n),isPrimary:n.isPrimary,currentPos:x(n),currentTime:e.now()}])}function we(e,t){!function(e,t,n){Pe(e,t,n,0),Se(e,t,n)}(e,t,[{id:t.pointerId,type:T(t)}])}function ye(e,t){return Object.prototype.hasOwnProperty.call(t,"isPrimary")||(0===e.getLength()?t.isPrimary=!0:t.isPrimary=!1),t.speed=0,t.direction=0,t.contactPos=t.currentPos,t.contactTime=t.currentTime,t.lastPos=t.currentPos,t.lastTime=t.currentTime,e.add(t)}function Te(e,t){var n,o;return e.getById(t.id)?(n=e.removeById(t.id),Object.prototype.hasOwnProperty.call(t,"isPrimary")||(o=e.getPrimary())||(o=e.getByIndex(0))&&(o.isPrimary=!0)):n=e.getLength(),n}function xe(t,n,o){var i,r,l,h=t.getActivePointersListByType(o[0].type),c=o.length;for(i=0;i<c;i++)r=o[i],(l=h.getById(r.id))?(l.insideElement=!0,l.lastPos=l.currentPos,l.lastTime=l.currentTime,l.currentPos=r.currentPos,l.currentTime=r.currentTime,r=l):(r.captured=!1,r.insideElementPressed=!1,r.insideElement=!0,ye(h,r)),t.enterHandler&&!1===t.enterHandler({eventSource:t,pointerType:r.type,position:E(r.currentPos,t.element),buttons:h.buttons,pointers:t.getActivePointerCount(),insideElementPressed:r.insideElementPressed,buttonDownAny:0!==h.buttons,isTouchEvent:"touch"===r.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)}function Se(t,n,o){var i,r,l,h=t.getActivePointersListByType(o[0].type),c=o.length;for(i=0;i<c;i++)r=o[i],(l=h.getById(r.id))&&(l.captured?(l.insideElement=!1,l.lastPos=l.currentPos,l.lastTime=l.currentTime,l.currentPos=r.currentPos,l.currentTime=r.currentTime):Te(h,l),r=l),t.exitHandler&&!1===t.exitHandler({eventSource:t,pointerType:r.type,position:r.currentPos&&E(r.currentPos,t.element),buttons:h.buttons,pointers:t.getActivePointerCount(),insideElementPressed:!!l&&l.insideElementPressed,buttonDownAny:0!==h.buttons,isTouchEvent:"touch"===r.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)}function Ee(t,n,o,r){var i,l,h,c=d[t.hash],m=t.getActivePointersListByType(o[0].type),v=o.length;void 0!==n.buttons?m.buttons=n.buttons:e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?0===r?m.buttons+=1:1===r?m.buttons+=4:2===r?m.buttons+=2:3===r?m.buttons+=8:4===r?m.buttons+=16:5===r&&(m.buttons+=32):0===r?m.buttons|=1:1===r?m.buttons|=4:2===r?m.buttons|=2:3===r?m.buttons|=8:4===r?m.buttons|=16:5===r&&(m.buttons|=32);var f=t.getActivePointersListsExceptType(o[0].type);for(i=0;i<f.length;i++)Q(t,n,f[i]);if(0!==r)return t.nonPrimaryPressHandler&&!1===t.nonPrimaryPressHandler({eventSource:t,pointerType:o[0].type,position:E(o[0].currentPos,t.element),button:r,buttons:m.buttons,isTouchEvent:"touch"===o[0].type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n),!1;for(i=0;i<v;i++)l=o[i],(h=m.getById(l.id))?(h.captured=!0,h.insideElementPressed=!0,h.insideElement=!0,h.contactPos=l.currentPos,h.contactTime=l.currentTime,h.lastPos=h.currentPos,h.lastTime=h.currentTime,h.currentPos=l.currentPos,h.currentTime=l.currentTime,l=h):(l.captured=!0,l.insideElementPressed=!0,l.insideElement=!0,ye(m,l)),m.addContact(),(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.addPoint(t,l),1===m.contacts?t.pressHandler&&!1===t.pressHandler({eventSource:t,pointerType:l.type,position:E(l.contactPos,t.element),buttons:m.buttons,isTouchEvent:"touch"===l.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n):2===m.contacts&&t.pinchHandler&&"touch"===l.type&&(c.pinchGPoints=m.asArray(),c.lastPinchDist=c.currentPinchDist=c.pinchGPoints[0].currentPos.distanceTo(c.pinchGPoints[1].currentPos),c.lastPinchCenter=c.currentPinchCenter=P(c.pinchGPoints[0].currentPos,c.pinchGPoints[1].currentPos));return!0}function Pe(t,n,o,r){var l,h,i,c,m,v,f=d[t.hash],w=t.getActivePointersListByType(o[0].type),y=o.length,T=!1,x=!1;if(void 0!==n.buttons?w.buttons=n.buttons:e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?0===r?w.buttons-=1:1===r?w.buttons-=4:2===r?w.buttons-=2:3===r?w.buttons-=8:4===r?w.buttons-=16:5===r&&(w.buttons-=32):0===r?w.buttons^=-2:1===r?w.buttons^=-5:2===r?w.buttons^=-3:3===r?w.buttons^=-9:4===r?w.buttons^=-17:5===r&&(w.buttons^=-33),0!==r){t.nonPrimaryReleaseHandler&&!1===t.nonPrimaryReleaseHandler({eventSource:t,pointerType:o[0].type,position:E(o[0].currentPos,t.element),button:r,buttons:w.buttons,isTouchEvent:"touch"===o[0].type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n);var S=t.getActivePointersListByType("mouse");return Q(t,n,S),!1}if(void 0===o[0].currentPos)return Q(t,n,w),!1;for(i=0;i<y;i++)c=o[i],(m=w.getById(c.id))&&(m.captured&&(m.captured=!1,T=!0,x=!0),m.lastPos=m.currentPos,m.lastTime=m.currentTime,m.currentPos=c.currentPos,m.currentTime=c.currentTime,m.insideElement||Te(w,m),l=m.currentPos,h=m.currentTime,x?(w.removeContact(),(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.removePoint(t,m),0===w.contacts?(t.releaseHandler&&!1===t.releaseHandler({eventSource:t,pointerType:m.type,position:E(l,t.element),buttons:w.buttons,insideElementPressed:m.insideElementPressed,insideElementReleased:m.insideElement,isTouchEvent:"touch"===m.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n),t.dragEndHandler&&!m.currentPos.equals(m.contactPos)&&!1===t.dragEndHandler({eventSource:t,pointerType:m.type,position:E(m.currentPos,t.element),speed:m.speed,direction:m.direction,shift:n.shiftKey,isTouchEvent:"touch"===m.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n),(t.clickHandler||t.dblClickHandler)&&m.insideElement&&(v=h-m.contactTime<=t.clickTimeThreshold&&m.contactPos.distanceTo(l)<=t.clickDistThreshold,t.clickHandler&&!1===t.clickHandler({eventSource:t,pointerType:m.type,position:E(m.currentPos,t.element),quick:v,shift:n.shiftKey,isTouchEvent:"touch"===m.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n),t.dblClickHandler&&v&&(w.clicks++,1===w.clicks?(f.lastClickPos=l,f.dblClickTimeOut=setTimeout((function(){w.clicks=0}),t.dblClickTimeThreshold)):2===w.clicks&&(clearTimeout(f.dblClickTimeOut),w.clicks=0,f.lastClickPos.distanceTo(l)<=t.dblClickDistThreshold&&!1===t.dblClickHandler({eventSource:t,pointerType:m.type,position:E(m.currentPos,t.element),shift:n.shiftKey,isTouchEvent:"touch"===m.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n),f.lastClickPos=null)))):2===w.contacts&&t.pinchHandler&&"touch"===m.type&&(f.pinchGPoints=w.asArray(),f.lastPinchDist=f.currentPinchDist=f.pinchGPoints[0].currentPos.distanceTo(f.pinchGPoints[1].currentPos),f.lastPinchCenter=f.currentPinchCenter=P(f.pinchGPoints[0].currentPos,f.pinchGPoints[1].currentPos))):t.releaseHandler&&!1===t.releaseHandler({eventSource:t,pointerType:m.type,position:E(l,t.element),buttons:w.buttons,insideElementPressed:m.insideElementPressed,insideElementReleased:m.insideElement,isTouchEvent:"touch"===m.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n));return T}function be(t,n,o){var i,r,l,h,c,m=d[t.hash],v=t.getActivePointersListByType(o[0].type),f=o.length;for(void 0!==n.buttons&&(v.buttons=n.buttons),i=0;i<f;i++)r=o[i],(l=v.getById(r.id))?(Object.prototype.hasOwnProperty.call(r,"isPrimary")&&(l.isPrimary=r.isPrimary),l.lastPos=l.currentPos,l.lastTime=l.currentTime,l.currentPos=r.currentPos,l.currentTime=r.currentTime):(r.captured=!1,r.insideElementPressed=!1,r.insideElement=!0,ye(v,r));t.stopHandler&&"mouse"===o[0].type&&(clearTimeout(t.stopTimeOut),t.stopTimeOut=setTimeout((function(){!function(e,t,n){e.stopHandler&&e.stopHandler({eventSource:e,pointerType:n,position:S(t,e.element),buttons:e.getActivePointersListByType(n).buttons,isTouchEvent:"touch"===n,originalEvent:t,preventDefaultAction:!1,userData:e.userData})}(t,n,o[0].type)}),t.stopDelay)),0===v.contacts?t.moveHandler&&!1===t.moveHandler({eventSource:t,pointerType:o[0].type,position:E(o[0].currentPos,t.element),buttons:v.buttons,isTouchEvent:"touch"===o[0].type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n):1===v.contacts?(t.moveHandler&&(l=v.asArray()[0],!1===t.moveHandler({eventSource:t,pointerType:l.type,position:E(l.currentPos,t.element),buttons:v.buttons,isTouchEvent:"touch"===l.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)),t.dragHandler&&(c=(l=v.asArray()[0]).currentPos.minus(l.lastPos),!1===t.dragHandler({eventSource:t,pointerType:l.type,position:E(l.currentPos,t.element),buttons:v.buttons,delta:c,speed:l.speed,direction:l.direction,shift:n.shiftKey,isTouchEvent:"touch"===l.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n))):2===v.contacts&&(t.moveHandler&&(h=v.asArray(),!1===t.moveHandler({eventSource:t,pointerType:h[0].type,position:E(P(h[0].currentPos,h[1].currentPos),t.element),buttons:v.buttons,isTouchEvent:"touch"===h[0].type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)),t.pinchHandler&&"touch"===o[0].type&&(c=m.pinchGPoints[0].currentPos.distanceTo(m.pinchGPoints[1].currentPos))!=m.currentPinchDist&&(m.lastPinchDist=m.currentPinchDist,m.currentPinchDist=c,m.lastPinchCenter=m.currentPinchCenter,m.currentPinchCenter=P(m.pinchGPoints[0].currentPos,m.pinchGPoints[1].currentPos),!1===t.pinchHandler({eventSource:t,pointerType:"touch",gesturePoints:m.pinchGPoints,lastCenter:E(m.lastPinchCenter,t.element),center:E(m.currentPinchCenter,t.element),lastDistance:m.lastPinchDist,distance:m.currentPinchDist,shift:n.shiftKey,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)))}e.MouseTracker=function(t){c.push(this);var n=arguments;e.isPlainObject(t)||(t={element:n[0],clickTimeThreshold:n[1],clickDistThreshold:n[2]}),this.hash=Math.random(),this.element=e.getElement(t.element),this.clickTimeThreshold=t.clickTimeThreshold||e.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=t.clickDistThreshold||e.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=t.dblClickTimeThreshold||e.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=t.dblClickDistThreshold||e.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=t.userData||null,this.stopDelay=t.stopDelay||50,this.enterHandler=t.enterHandler||null,this.exitHandler=t.exitHandler||null,this.pressHandler=t.pressHandler||null,this.nonPrimaryPressHandler=t.nonPrimaryPressHandler||null,this.releaseHandler=t.releaseHandler||null,this.nonPrimaryReleaseHandler=t.nonPrimaryReleaseHandler||null,this.moveHandler=t.moveHandler||null,this.scrollHandler=t.scrollHandler||null,this.clickHandler=t.clickHandler||null,this.dblClickHandler=t.dblClickHandler||null,this.dragHandler=t.dragHandler||null,this.dragEndHandler=t.dragEndHandler||null,this.pinchHandler=t.pinchHandler||null,this.stopHandler=t.stopHandler||null,this.keyDownHandler=t.keyDownHandler||null,this.keyUpHandler=t.keyUpHandler||null,this.keyHandler=t.keyHandler||null,this.focusHandler=t.focusHandler||null,this.blurHandler=t.blurHandler||null;var o=this;d[this.hash]={click:function(e){_(o,e)},dblclick:function(e){R(o,e)},keydown:function(e){C(o,e)},keyup:function(e){O(o,e)},keypress:function(e){I(o,e)},focus:function(e){k(o,e)},blur:function(e){A(o,e)},wheel:function(e){D(o,e)},mousewheel:function(e){B(o,e)},DOMMouseScroll:function(e){B(o,e)},MozMousePixelScroll:function(e){B(o,e)},mouseenter:function(e){H(o,e)},mouseleave:function(e){N(o,e)},mouseover:function(e){F(o,e)},mouseout:function(e){j(o,e)},mousedown:function(e){U(o,e)},mouseup:function(e){G(o,e)},mouseupcaptured:function(e){$(o,e)},mousemove:function(e){X(o,e)},mousemovecaptured:function(e){K(o,e)},touchstart:function(e){J(o,e)},touchend:function(e){ee(o,e)},touchendcaptured:function(e){te(o,e)},touchmove:function(e){ne(o,e)},touchmovecaptured:function(e){oe(o,e)},touchcancel:function(e){se(o,e)},gesturestart:function(e){ae(o,e)},gesturechange:function(e){le(o,e)},pointerover:function(e){he(o,e)},MSPointerOver:function(e){he(o,e)},pointerout:function(e){ce(o,e)},MSPointerOut:function(e){ce(o,e)},pointerdown:function(e){ue(o,e)},MSPointerDown:function(e){ue(o,e)},pointerup:function(e){de(o,e)},MSPointerUp:function(e){de(o,e)},pointermove:function(e){me(o,e)},MSPointerMove:function(e){me(o,e)},pointercancel:function(e){we(o,e)},MSPointerCancel:function(e){we(o,e)},pointerupcaptured:function(e){pe(o,e)},pointermovecaptured:function(e){ve(o,e)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},t.startDisabled||this.setTracking(!0)},e.MouseTracker.prototype={destroy:function(){var i;for(v(this),this.element=null,i=0;i<c.length;i++)if(c[i]===this){c.splice(i,1);break}d[this.hash]=null,delete d[this.hash]},isTracking:function(){return d[this.hash].tracking},setTracking:function(track){return track?function(t){var n,i,o=d[t.hash];if(!o.tracking){for(i=0;i<e.MouseTracker.subscribeEvents.length;i++)n=e.MouseTracker.subscribeEvents[i],e.addEvent(t.element,n,o[n],!1);m(t),o.tracking=!0}}(this):v(this),this},getActivePointersListsExceptType:function(e){for(var t=d[this.hash],n=[],i=0;i<t.activePointersLists.length;++i)t.activePointersLists[i].type!==e&&n.push(t.activePointersLists[i]);return n},getActivePointersListByType:function(t){var i,n,o=d[this.hash],r=o.activePointersLists.length;for(i=0;i<r;i++)if(o.activePointersLists[i].type===t)return o.activePointersLists[i];return n=new e.MouseTracker.GesturePointList(t),o.activePointersLists.push(n),n},getActivePointerCount:function(){var i,e=d[this.hash],t=e.activePointersLists.length,n=0;for(i=0;i<t;i++)n+=e.activePointersLists[i].getLength();return n},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},e.MouseTracker.resetAllMouseTrackers=function(){for(var i=0;i<c.length;i++)c[i].isTracking()&&(c[i].setTracking(!1),c[i].setTracking(!0))},e.MouseTracker.gesturePointVelocityTracker=(t=[],n=0,o=0,r=function(e,t){return e.hash.toString()+t.type+t.id.toString()},l=function(){var i,n,r,l,h,c,d=t.length,m=e.now();for(l=m-o,o=m,i=0;i<d;i++)(r=(n=t[i]).gPoint).direction=Math.atan2(r.currentPos.y-n.lastPos.y,r.currentPos.x-n.lastPos.x),h=n.lastPos.distanceTo(r.currentPos),n.lastPos=r.currentPos,c=1e3*h/(l+1),r.speed=.75*c+.25*r.speed},{addPoint:function(h,c){var d=r(h,c);t.push({guid:d,gPoint:c,lastPos:c.currentPos}),1===t.length&&(o=e.now(),n=window.setInterval(l,50))},removePoint:function(e,o){var i,l=r(e,o),h=t.length;for(i=0;i<h;i++)if(t[i].guid===l){t.splice(i,1),0==--h&&window.clearInterval(n);break}}}),e.MouseTracker.captureElement=document,e.MouseTracker.wheelEventName=e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",e.MouseTracker.supportsMouseCapture=(h=document.createElement("div"),e.isFunction(h.setCapture)&&e.isFunction(h.releaseCapture)),e.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",e.MouseTracker.wheelEventName],"DOMMouseScroll"==e.MouseTracker.wheelEventName&&e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||e.Browser.vendor!==e.BROWSERS.IE)?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),e.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?e.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:e.MouseTracker.maxTouchPoints=0,e.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),e.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?e.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:e.MouseTracker.maxTouchPoints=0,e.MouseTracker.haveMouseEnter=!1):(e.MouseTracker.havePointerEvents=!1,e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?(e.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),e.MouseTracker.haveMouseEnter=!0):(e.MouseTracker.subscribeEvents.push("mouseover","mouseout"),e.MouseTracker.haveMouseEnter=!1),e.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&e.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&e.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),e.MouseTracker.mousePointerId="legacy-mouse",e.MouseTracker.maxTouchPoints=10),e.MouseTracker.GesturePointList=function(e){this._gPoints=[],this.type=e,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},e.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(e){return this._gPoints.push(e)},removeById:function(e){var i,t=this._gPoints.length;for(i=0;i<t;i++)if(this._gPoints[i].id===e){this._gPoints.splice(i,1);break}return this._gPoints.length},getByIndex:function(e){return e<this._gPoints.length?this._gPoints[e]:null},getById:function(e){var i,t=this._gPoints.length;for(i=0;i<t;i++)if(this._gPoints[i].id===e)return this._gPoints[i];return null},getPrimary:function(e){var i,t=this._gPoints.length;for(i=0;i<t;i++)if(this._gPoints[i].isPrimary)return this._gPoints[i];return null},addContact:function(){++this.contacts,this.contacts>1&&("mouse"===this.type||"pen"===this.type)&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};var _e=function(){try{return window.self!==window.top}catch(e){return!0}}();function Re(e){try{return e.addEventListener&&e.removeEventListener}catch(e){return!1}}}(OpenSeadragon),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},e.Control=function(element,t,n){var o=element.parentNode;"number"==typeof t&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),t={anchor:t}),t.attachToViewer=void 0===t.attachToViewer||t.attachToViewer,this.autoFade=void 0===t.autoFade||t.autoFade,this.element=element,this.anchor=t.anchor,this.container=n,this.anchor==e.ControlAnchor.ABSOLUTE?(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof t.top?t.top+"px":t.top,this.wrapper.style.left="number"==typeof t.left?t.left+"px":t.left,this.wrapper.style.height="number"==typeof t.height?t.height+"px":t.height,this.wrapper.style.width="number"==typeof t.width?t.width+"px":t.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),t.attachToViewer?this.anchor==e.ControlAnchor.TOP_RIGHT||this.anchor==e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):o.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(t){this.wrapper.style.display=t?this.anchor==e.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(t){this.element[e.SIGNAL]&&e.Browser.vendor==e.BROWSERS.IE?e.setElementOpacity(this.element,t,!0):e.setElementOpacity(this.wrapper,t,!0)}}}(OpenSeadragon),function(e){function t(e,element){var i,t=e.controls;for(i=t.length-1;i>=0;i--)if(t[i].element==element)return i;return-1}e.ControlDock=function(t){var n,i,o=["topleft","topright","bottomright","bottomleft"];for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(1e6*Math.random()),container:e.makeNeutralElement("div"),controls:[]},t),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),i=0;i<o.length;i++)n=o[i],this.controls[n]=e.makeNeutralElement("div"),this.controls[n].style.position="absolute",n.match("left")&&(this.controls[n].style.left="0px"),n.match("right")&&(this.controls[n].style.right="0px"),n.match("top")&&(this.controls[n].style.top="0px"),n.match("bottom")&&(this.controls[n].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(element,n){var div=null;if(!(t(this,element=e.getElement(element))>=0)){switch(n.anchor){case e.ControlAnchor.TOP_RIGHT:div=this.controls.topright,element.style.position="relative",element.style.paddingRight="0px",element.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:div=this.controls.bottomright,element.style.position="relative",element.style.paddingRight="0px",element.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:div=this.controls.bottomleft,element.style.position="relative",element.style.paddingLeft="0px",element.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:div=this.controls.topleft,element.style.position="relative",element.style.paddingLeft="0px",element.style.paddingTop="0px";break;case e.ControlAnchor.ABSOLUTE:div=this.container,element.style.margin="0px",element.style.padding="0px";break;default:case e.ControlAnchor.NONE:div=this.container,element.style.margin="0px",element.style.padding="0px"}this.controls.push(new e.Control(element,n,div)),element.style.display="inline-block"}},removeControl:function(element){var i=t(this,element=e.getElement(element));return i>=0&&(this.controls[i].destroy(),this.controls.splice(i,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var i;for(i=this.controls.length-1;i>=0;i--)if(this.controls[i].isVisible())return!0;return!1},setControlsEnabled:function(e){var i;for(i=this.controls.length-1;i>=0;i--)this.controls[i].setVisible(e);return this}}}(OpenSeadragon),function(e){e.Placement=e.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(e){var t={},n=1;function o(t){return t=e.getElement(t),new e.Point(0===t.clientWidth?1:t.clientWidth,0===t.clientHeight?1:t.clientHeight)}function r(t,n){if(n instanceof e.Overlay)return n;var element=null;if(n.element)element=e.getElement(n.element);else{var o=n.id?n.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());(element=e.getElement(n.id))||((element=document.createElement("a")).href="#/overlay/"+o),element.id=o,e.addClass(element,n.className?n.className:"openseadragon-overlay")}var r=n.location,l=n.width,h=n.height;if(!r){var c=n.x,d=n.y;if(void 0!==n.px){var rect=t.viewport.imageToViewportRectangle(new e.Rect(n.px,n.py,l||0,h||0));c=rect.x,d=rect.y,l=void 0!==l?rect.width:void 0,h=void 0!==h?rect.height:void 0}r=new e.Point(c,d)}var m=n.placement;return m&&"string"===e.type(m)&&(m=e.Placement[n.placement.toUpperCase()]),new e.Overlay({element:element,location:r,placement:m,onDraw:n.onDraw,checkResize:n.checkResize,width:l,height:h,rotationMode:n.rotationMode})}function l(e,element){var i;for(i=e.length-1;i>=0;i--)if(e[i].element===element)return i;return-1}function h(t,n){return e.requestAnimationFrame((function(){n(t)}))}function c(t){e.requestAnimationFrame((function(){!function(t){var n,i;if(t.controlsShouldFade){for(n=1-(e.now()-t.controlsFadeBeginTime)/t.controlsFadeLength,n=Math.min(1,n),n=Math.max(0,n),i=t.controls.length-1;i>=0;i--)t.controls[i].autoFade&&t.controls[i].setOpacity(n);n>0&&c(t)}}(t)}))}function d(t){t.autoHideControls&&(t.controlsShouldFade=!0,t.controlsFadeBeginTime=e.now()+t.controlsFadeDelay,window.setTimeout((function(){c(t)}),t.controlsFadeDelay))}function m(e){var i;for(e.controlsShouldFade=!1,i=e.controls.length-1;i>=0;i--)e.controls[i].setOpacity(1)}function v(){m(this)}function f(){d(this)}function w(t){var n={originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction,preventVerticalPan:t.preventVerticalPan,preventHorizontalPan:t.preventHorizontalPan};if(this.raiseEvent("canvas-key",n),n.preventDefaultAction||t.ctrl||t.alt||t.meta)return!0;switch(t.keyCode){case 38:return n.preventVerticalPan||(t.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return n.preventVerticalPan||(t.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return n.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return n.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}}function y(t){var n={originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction,preventVerticalPan:t.preventVerticalPan,preventHorizontalPan:t.preventHorizontalPan};if(this.raiseEvent("canvas-key",n),n.preventDefaultAction||t.ctrl||t.alt||t.meta)return!0;switch(t.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return n.preventVerticalPan||(t.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return n.preventVerticalPan||(t.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return n.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return n.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}}function T(e){var t;document.activeElement==this.canvas||this.canvas.focus(),this.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x);var n={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.raiseEvent("canvas-click",n),!n.preventDefaultAction&&this.viewport&&e.quick&&(t=this.gestureSettingsByDeviceType(e.pointerType)).clickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints())}function x(e){var t,n={tracker:e.eventSource,position:e.position,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.raiseEvent("canvas-double-click",n),!n.preventDefaultAction&&this.viewport&&(t=this.gestureSettingsByDeviceType(e.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints())}function S(e){var t,n={tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};if(this.raiseEvent("canvas-drag",n),!n.preventDefaultAction&&this.viewport){if(t=this.gestureSettingsByDeviceType(e.pointerType),this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewport.flipped&&(e.delta.x=-e.delta.x),this.constrainDuringPan){var o=this.viewport.deltaPointsFromPixels(e.delta.negate());this.viewport.centerSpringX.target.value+=o.x,this.viewport.centerSpringY.target.value+=o.y;var r=this.viewport.getBounds(),l=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=o.x,this.viewport.centerSpringY.target.value-=o.y,r.x!=l.x&&(e.delta.x=0),r.y!=l.y&&(e.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta.negate()),t.flickEnabled&&!this.constrainDuringPan)}}function E(t){if(!t.preventDefaultAction&&this.viewport){var n=this.gestureSettingsByDeviceType(t.pointerType);if(n.flickEnabled&&t.speed>=n.flickMinSpeed){var o=0;this.panHorizontal&&(o=n.flickMomentum*t.speed*Math.cos(t.direction));var r=0;this.panVertical&&(r=n.flickMomentum*t.speed*Math.sin(t.direction));var l=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),h=this.viewport.pointFromPixel(new e.Point(l.x-o,l.y-r));this.viewport.panTo(h,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:t.eventSource,position:t.position,speed:t.speed,direction:t.direction,shift:t.shift,originalEvent:t.originalEvent})}function P(e){this.raiseEvent("canvas-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function _(t){window.location!=window.parent.location&&e.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:t.eventSource,pointerType:t.pointerType,position:t.position,buttons:t.buttons,pointers:t.pointers,insideElementPressed:t.insideElementPressed,buttonDownAny:t.buttonDownAny,originalEvent:t.originalEvent})}function R(e){this.raiseEvent("canvas-press",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function C(e){this.raiseEvent("canvas-release",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function O(e){this.raiseEvent("canvas-nonprimary-press",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function I(e){this.raiseEvent("canvas-nonprimary-release",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function k(e){var t,n,o;if(!e.preventDefaultAction&&this.viewport&&((t=this.gestureSettingsByDeviceType(e.pointerType)).pinchToZoom&&(n=this.viewport.pointFromPixel(e.center,!0),o=this.viewport.pointFromPixel(e.lastCenter,!0).minus(n),this.panHorizontal||(o.x=0),this.panVertical||(o.y=0),this.viewport.zoomBy(e.distance/e.lastDistance,n,!0),t.zoomToRefPoint&&this.viewport.panBy(o,!0),this.viewport.applyConstraints()),t.pinchRotate)){var r=Math.atan2(e.gesturePoints[0].currentPos.y-e.gesturePoints[1].currentPos.y,e.gesturePoints[0].currentPos.x-e.gesturePoints[1].currentPos.x),l=Math.atan2(e.gesturePoints[0].lastPos.y-e.gesturePoints[1].lastPos.y,e.gesturePoints[0].lastPos.x-e.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(r-l)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:e.eventSource,gesturePoints:e.gesturePoints,lastCenter:e.lastCenter,center:e.center,lastDistance:e.lastDistance,distance:e.distance,shift:e.shift,originalEvent:e.originalEvent}),!1}function A(t){var n,o,r;if((r=e.now())-this._lastScrollTime>this.minScrollDeltaTime){if(this._lastScrollTime=r,this.viewport.flipped&&(t.position.x=this.viewport.getContainerSize().x-t.position.x),!t.preventDefaultAction&&this.viewport&&(n=this.gestureSettingsByDeviceType(t.pointerType)).scrollToZoom&&(o=Math.pow(this.zoomPerScroll,t.scroll),this.viewport.zoomBy(o,n.zoomToRefPoint?this.viewport.pointFromPixel(t.position,!0):null),this.viewport.applyConstraints()),this.raiseEvent("canvas-scroll",{tracker:t.eventSource,position:t.position,scroll:t.scroll,shift:t.shift,originalEvent:t.originalEvent}),n&&n.scrollToZoom)return!1}else if((n=this.gestureSettingsByDeviceType(t.pointerType))&&n.scrollToZoom)return!1}function D(e){t[this.hash].mouseInside=!0,m(this),this.raiseEvent("container-enter",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function B(e){e.pointers<1&&(t[this.hash].mouseInside=!1,t[this.hash].animating||d(this)),this.raiseEvent("container-exit",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function M(e){!function(e){if(e._opening)return;if(e.autoResize){var n=o(e.container),r=t[e.hash].prevContainerSize;if(!n.equals(r)){var l=e.viewport;if(e.preserveImageSizeOnResize){var h=r.x/n.x,c=l.getZoom()*h,v=l.getCenter();l.resize(n,!1),l.zoomTo(c,null,!0),l.panTo(v,!0)}else{var f=l.getBounds();l.resize(n,!0),l.fitBoundsWithConstraints(f,!0)}t[e.hash].prevContainerSize=n,t[e.hash].forceRedraw=!0}}var w=e.viewport.update(),y=e.world.update()||w;w&&e.raiseEvent("viewport-change");e.referenceStrip&&(y=e.referenceStrip.update(e.viewport)||y);!t[e.hash].animating&&y&&(e.raiseEvent("animation-start"),m(e));(y||t[e.hash].forceRedraw||e.world.needsDraw())&&(!function(e){e.imageLoader.clear(),e.drawer.clear(),e.world.draw(),e.raiseEvent("update-viewport",{})}(e),e._drawOverlays(),e.navigator&&e.navigator.update(e.viewport),t[e.hash].forceRedraw=!1,y&&e.raiseEvent("animation"));t[e.hash].animating&&!y&&(e.raiseEvent("animation-finish"),t[e.hash].mouseInside||d(e));t[e.hash].animating=y}(e),e.isOpen()?e._updateRequestId=h(e,M):e._updateRequestId=!1}function z(e,t){return e?e+t:t}function H(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=this.zoomPerSecond,t[this.hash].zooming=!0,N(this)}function F(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=1/this.zoomPerSecond,t[this.hash].zooming=!0,N(this)}function L(){t[this.hash].zooming=!1}function N(t){e.requestAnimationFrame(e.delegate(t,j))}function j(){var n,o,r;t[this.hash].zooming&&this.viewport&&(o=(n=e.now())-t[this.hash].lastZoomTime,r=Math.pow(t[this.hash].zoomFactor,o/1e3),this.viewport.zoomBy(r),this.viewport.applyConstraints(),t[this.hash].lastZoomTime=n,N(this))}function W(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function V(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function U(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function G(){this.viewport&&this.viewport.goHome()}function $(){this.isFullPage()&&!e.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function Z(){if(this.viewport){var t=this.viewport.getRotation();t=this.viewport.flipped?e.positiveModulo(t+this.rotationIncrement,360):e.positiveModulo(t-this.rotationIncrement,360),this.viewport.setRotation(t)}}function X(){if(this.viewport){var t=this.viewport.getRotation();t=this.viewport.flipped?e.positiveModulo(t-this.rotationIncrement,360):e.positiveModulo(t+this.rotationIncrement,360),this.viewport.setRotation(t)}}function K(){this.viewport.toggleFlip()}function Y(){var e=this._sequenceIndex-1;this.navPrevNextWrap&&e<0&&(e+=this.tileSources.length),this.goToPage(e)}function Q(){var e=this._sequenceIndex+1;this.navPrevNextWrap&&e>=this.tileSources.length&&(e=0),this.goToPage(e)}e.Viewer=function(r){var i,style,l=arguments,c=this;if(e.isPlainObject(r)||(r={id:l[0],xmlPath:l.length>1?l[1]:void 0,prefixUrl:l.length>2?l[2]:void 0,controls:l.length>3?l[3]:void 0,overlays:l.length>4?l[4]:void 0}),r.config&&(e.extend(!0,r,r.config),delete r.config),e.extend(!0,this,{id:r.id,hash:r.hash||n++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},e.DEFAULT_SETTINGS,r),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==t[this.hash]&&e.console.warn("Hash "+this.hash+" has already been used."),t[this.hash]={fsBoundsDelta:new e.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=e.now(),e.EventSource.call(this),this.addHandler("open-failed",(function(t){var n=e.getString("Errors.OpenFailed",t.eventSource,t.message);c._showMessage(n)})),e.ControlDock.call(this,r),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=e.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(style=this.canvas.style).width="100%",style.height="100%",style.overflow="hidden",style.position="absolute",style.top="0px",style.left="0px",e.setElementTouchActionNone(this.canvas),""!==r.tabIndex&&(this.canvas.tabIndex=void 0===r.tabIndex?0:r.tabIndex),this.container.className="openseadragon-container",function(style){style.width="100%",style.height="100%",style.position="relative",style.overflow="hidden",style.left="0px",style.top="0px",style.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new e.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:e.delegate(this,w),keyHandler:e.delegate(this,y),clickHandler:e.delegate(this,T),dblClickHandler:e.delegate(this,x),dragHandler:e.delegate(this,S),dragEndHandler:e.delegate(this,E),enterHandler:e.delegate(this,P),exitHandler:e.delegate(this,_),pressHandler:e.delegate(this,R),releaseHandler:e.delegate(this,C),nonPrimaryPressHandler:e.delegate(this,O),nonPrimaryReleaseHandler:e.delegate(this,I),scrollHandler:e.delegate(this,A),pinchHandler:e.delegate(this,k)}),this.outerTracker=new e.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:e.delegate(this,D),exitHandler:e.delegate(this,B)}),this.toolbar&&(this.toolbar=new e.ControlDock({element:this.toolbar})),this.bindStandardControls(),t[this.hash].prevContainerSize=o(this.container),this.world=new e.World({viewer:this}),this.world.addHandler("add-item",(function(e){c.source=c.world.getItemAt(0).source,t[c.hash].forceRedraw=!0,c._updateRequestId||(c._updateRequestId=h(c,M))})),this.world.addHandler("remove-item",(function(e){c.world.getItemCount()?c.source=c.world.getItemAt(0).source:c.source=null,t[c.hash].forceRedraw=!0})),this.world.addHandler("metrics-change",(function(e){c.viewport&&c.viewport._setContentBounds(c.world.getHomeBounds(),c.world.getContentFactor())})),this.world.addHandler("item-index-change",(function(e){c.source=c.world.getItemAt(0).source})),this.viewport=new e.Viewport({containerSize:t[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new e.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:r.timeout}),this.tileCache=new e.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new e.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=e.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(i=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(i,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(i=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(i,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new e.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),i=0;i<this.customControls.length;i++)this.addControl(this.customControls[i].id,{anchor:this.customControls[i].anchor});e.requestAnimationFrame((function(){d(c)})),void 0===this.imageSmoothingEnabled||this.imageSmoothingEnabled||this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},e.extend(e.Viewer.prototype,e.EventSource.prototype,e.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(t){return e.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(t)},openTileSource:function(t){return e.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(t)},open:function(t,n){var o=this;if(this.close(),t){if(this.sequenceMode&&e.isArray(t))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===n||isNaN(n)||(this.initialPage=n),this.tileSources=t,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),void this._updateSequenceButtons(this._sequenceIndex);if(e.isArray(t)||(t=[t]),t.length){this._opening=!0;for(var l,h=t.length,c=0,d=0,m=function(){if(c+d===h)if(c){!o._firstOpen&&o.preserveViewport||(o.viewport.goHome(!0),o.viewport.update()),o._firstOpen=!1;var source=t[0];if(source.tileSource&&(source=source.tileSource),o.overlays&&!o.preserveOverlays)for(var i=0;i<o.overlays.length;i++)o.currentOverlays[i]=r(o,o.overlays[i]);o._drawOverlays(),o._opening=!1,o.raiseEvent("open",{source:source})}else o._opening=!1,o.raiseEvent("open-failed",l)},v=function(t){e.isPlainObject(t)&&t.tileSource||(t={tileSource:t}),void 0!==t.index&&(e.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete t.index),void 0===t.collectionImmediately&&(t.collectionImmediately=!0);var n=t.success;t.success=function(e){if(c++,t.tileSource.overlays)for(var i=0;i<t.tileSource.overlays.length;i++)o.addOverlay(t.tileSource.overlays[i]);n&&n(e),m()};var r=t.error;t.error=function(e){d++,l||(l=e),r&&r(e),m()},o.addTiledImage(t)},i=0;i<t.length;i++)v(t[i]);return this}}},close:function(){return t[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),t[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(t[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(e.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),t[this.hash]=null,delete t[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(e){return this.innerTracker.setTracking(e),this.outerTracker.setTracking(e),this.raiseEvent("mouse-enabled",{enabled:e}),this},areControlsEnabled:function(){var i,e=this.controls.length;for(i=0;i<this.controls.length;i++)e=e&&this.controls[i].isVisible();return e},setControlsEnabled:function(e){return e?m(this):d(this),this.raiseEvent("controls-enabled",{enabled:e}),this},setDebugMode:function(e){for(var i=0;i<this.world.getItemCount();i++)this.world.getItemAt(i).debugMode=e;this.debugMode=e,this.forceRedraw()},isFullPage:function(){return t[this.hash].fullPage},setFullPage:function(n){var o,i,body=document.body,r=body.style,l=document.documentElement.style,h=this;if(n==this.isFullPage())return this;var c={fullPage:n,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",c),c.preventDefaultAction)return this;if(n){for(this.elementSize=e.getElementSize(this.element),this.pageScroll=e.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=r.margin,this.docMargin=l.margin,r.margin="0",l.margin="0",this.bodyPadding=r.padding,this.docPadding=l.padding,r.padding="0",l.padding="0",this.bodyWidth=r.width,this.docWidth=l.width,r.width="100%",l.width="100%",this.bodyHeight=r.height,this.docHeight=l.height,r.height="100%",l.height="100%",this.previousBody=[],t[this.hash].prevElementParent=this.element.parentNode,t[this.hash].prevNextSibling=this.element.nextSibling,t[this.hash].prevElementWidth=this.element.style.width,t[this.hash].prevElementHeight=this.element.style.height,o=body.childNodes.length,i=0;i<o;i++)this.previousBody.push(body.childNodes[0]),body.removeChild(body.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,body.appendChild(this.toolbar.element),e.addClass(this.toolbar.element,"fullpage")),e.addClass(this.element,"fullpage"),body.appendChild(this.element),this.element.style.height=e.getWindowSize().y+"px",this.element.style.width=e.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=e.getElementSize(this.element).y-e.getElementSize(this.toolbar.element).y+"px"),t[this.hash].fullPage=!0,e.delegate(this,D)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,r.margin=this.bodyMargin,l.margin=this.docMargin,r.padding=this.bodyPadding,l.padding=this.docPadding,r.width=this.bodyWidth,l.width=this.docWidth,r.height=this.bodyHeight,l.height=this.docHeight,body.removeChild(this.element),o=this.previousBody.length,i=0;i<o;i++)body.appendChild(this.previousBody.shift());e.removeClass(this.element,"fullpage"),t[this.hash].prevElementParent.insertBefore(this.element,t[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(body.removeChild(this.toolbar.element),e.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=t[this.hash].prevElementWidth,this.element.style.height=t[this.hash].prevElementHeight;var d=0,m=function(){e.setPageScroll(h.pageScroll);var t=e.getPageScroll();++d<10&&(t.x!==h.pageScroll.x||t.y!==h.pageScroll.y)&&e.requestAnimationFrame(m)};e.requestAnimationFrame(m),t[this.hash].fullPage=!1,e.delegate(this,B)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:n}),this},setFullScreen:function(t){var n=this;if(!e.supportsFullScreen)return this.setFullPage(t);if(e.isFullScreen()===t)return this;var o={fullScreen:t,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",o),o.preventDefaultAction)return this;if(t){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var r=function(){var t=e.isFullScreen();t||(e.removeEvent(document,e.fullScreenEventName,r),e.removeEvent(document,e.fullScreenErrorEventName,r),n.setFullPage(!1),n.isFullPage()&&(n.element.style.width=n.fullPageStyleWidth,n.element.style.height=n.fullPageStyleHeight)),n.navigator&&n.viewport&&setTimeout((function(){n.navigator.update(n.viewport)})),n.raiseEvent("full-screen",{fullScreen:t})};e.addEvent(document,e.fullScreenEventName,r),e.addEvent(document,e.fullScreenErrorEventName,r),e.requestFullScreen(document.body)}else e.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(e){return this.container.style.visibility=e?"":"hidden",this.raiseEvent("visible",{visible:e}),this},addTiledImage:function(t){e.console.assert(t,"[Viewer.addTiledImage] options is required"),e.console.assert(t.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),e.console.assert(!t.replace||t.index>-1&&t.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var n=this;t.replace&&(t.replaceItem=n.world.getItemAt(t.index)),this._hideMessage(),void 0===t.placeholderFillStyle&&(t.placeholderFillStyle=this.placeholderFillStyle),void 0===t.opacity&&(t.opacity=this.opacity),void 0===t.preload&&(t.preload=this.preload),void 0===t.compositeOperation&&(t.compositeOperation=this.compositeOperation),void 0===t.crossOriginPolicy&&(t.crossOriginPolicy=void 0!==t.tileSource.crossOriginPolicy?t.tileSource.crossOriginPolicy:this.crossOriginPolicy),void 0===t.ajaxWithCredentials&&(t.ajaxWithCredentials=this.ajaxWithCredentials),void 0===t.loadTilesWithAjax&&(t.loadTilesWithAjax=this.loadTilesWithAjax),void 0===t.ajaxHeaders||null===t.ajaxHeaders?t.ajaxHeaders=this.ajaxHeaders:e.isPlainObject(t.ajaxHeaders)&&e.isPlainObject(this.ajaxHeaders)&&(t.ajaxHeaders=e.extend({},this.ajaxHeaders,t.ajaxHeaders));var o={options:t};function r(e){for(var i=0;i<n._loadQueue.length;i++)if(n._loadQueue[i]===o){n._loadQueue.splice(i,1);break}0===n._loadQueue.length&&l(o),n.raiseEvent("add-item-failed",e),t.error&&t.error(e)}function l(e){n.collectionMode&&(n.world.arrange({immediately:e.options.collectionImmediately,rows:n.collectionRows,columns:n.collectionColumns,layout:n.collectionLayout,tileSize:n.collectionTileSize,tileMargin:n.collectionTileMargin}),n.world.setAutoRefigureSizes(!0))}function h(){for(var t,o,r;n._loadQueue.length&&(t=n._loadQueue[0]).tileSource;){if(n._loadQueue.splice(0,1),t.options.replace){var h=n.world.getIndexOfItem(t.options.replaceItem);-1!=h&&(t.options.index=h),n.world.removeItem(t.options.replaceItem)}o=new e.TiledImage({viewer:n,source:t.tileSource,viewport:n.viewport,drawer:n.drawer,tileCache:n.tileCache,imageLoader:n.imageLoader,x:t.options.x,y:t.options.y,width:t.options.width,height:t.options.height,fitBounds:t.options.fitBounds,fitBoundsPlacement:t.options.fitBoundsPlacement,clip:t.options.clip,placeholderFillStyle:t.options.placeholderFillStyle,opacity:t.options.opacity,preload:t.options.preload,degrees:t.options.degrees,compositeOperation:t.options.compositeOperation,springStiffness:n.springStiffness,animationTime:n.animationTime,minZoomImageRatio:n.minZoomImageRatio,wrapHorizontal:n.wrapHorizontal,wrapVertical:n.wrapVertical,immediateRender:n.immediateRender,blendTime:n.blendTime,alwaysBlend:n.alwaysBlend,minPixelRatio:n.minPixelRatio,smoothTileEdgesMinZoom:n.smoothTileEdgesMinZoom,iOSDevice:n.iOSDevice,crossOriginPolicy:t.options.crossOriginPolicy,ajaxWithCredentials:t.options.ajaxWithCredentials,loadTilesWithAjax:t.options.loadTilesWithAjax,ajaxHeaders:t.options.ajaxHeaders,debugMode:n.debugMode}),n.collectionMode&&n.world.setAutoRefigureSizes(!1),n.world.addItem(o,{index:t.options.index}),0===n._loadQueue.length&&l(t),1!==n.world.getItemCount()||n.preserveViewport||n.viewport.goHome(!0),n.navigator&&(r=e.extend({},t.options,{replace:!1,originalTiledImage:o,tileSource:t.tileSource}),n.navigator.addTiledImage(r)),t.options.success&&t.options.success({item:o})}}e.isArray(t.tileSource)?setTimeout((function(){r({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:t.tileSource,options:t})})):(this._loadQueue.push(o),function(t,n,o,r,l){var h=t;if("string"==e.type(n))if(n.match(/^\s*<.*>\s*$/))n=e.parseXml(n);else if(n.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var c=e.parseJSON(n);n=c}catch(e){}function d(e,t){e.ready?r(e):(e.addHandler("ready",(function(){r(e)})),e.addHandler("open-failed",(function(e){l({message:e.message,source:t})})))}setTimeout((function(){if("string"==e.type(n))(n=new e.TileSource({url:n,crossOriginPolicy:void 0!==o.crossOriginPolicy?o.crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,ajaxHeaders:t.ajaxHeaders,useCanvas:t.useCanvas,success:function(e){r(e.tileSource)}})).addHandler("open-failed",(function(e){l(e)}));else if(e.isPlainObject(n)||n.nodeType)if(void 0!==n.crossOriginPolicy||void 0===o.crossOriginPolicy&&void 0===t.crossOriginPolicy||(n.crossOriginPolicy=void 0!==o.crossOriginPolicy?o.crossOriginPolicy:t.crossOriginPolicy),void 0===n.ajaxWithCredentials&&(n.ajaxWithCredentials=t.ajaxWithCredentials),void 0===n.useCanvas&&(n.useCanvas=t.useCanvas),e.isFunction(n.getTileUrl)){var c=new e.TileSource(n);c.getTileUrl=n.getTileUrl,r(c)}else{var m=e.TileSource.determineType(h,n);if(!m)return void l({message:"Unable to load TileSource",source:n});var v=m.prototype.configure.apply(h,[n]);d(new m(v),n)}else d(n,n)}))}(this,t.tileSource,t,(function(e){o.tileSource=e,h()}),(function(e){e.options=t,r(e),h()})))},addSimpleImage:function(t){e.console.assert(t,"[Viewer.addSimpleImage] options is required"),e.console.assert(t.url,"[Viewer.addSimpleImage] options.url is required");var n=e.extend({},t,{tileSource:{type:"image",url:t.url}});delete n.url,this.addTiledImage(n)},addLayer:function(t){var n=this;e.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var o=e.extend({},t,{success:function(e){n.raiseEvent("add-layer",{options:t,drawer:e.item})},error:function(e){n.raiseEvent("add-layer-failed",e)}});return this.addTiledImage(o),this},getLayerAtLevel:function(t){return e.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(t)},getLevelOfLayer:function(t){return e.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(t)},getLayersCount:function(){return e.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(t,n){return e.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(t,n)},removeLayer:function(t){return e.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(t)},forceRedraw:function(){return t[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var t=e.delegate(this,v),n=e.delegate(this,f),o=e.delegate(this,Q),r=e.delegate(this,Y),l=this.navImages,h=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(h=!1),this.previousButton=new e.Button({element:this.previousButton?e.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.PreviousPage"),srcRest:z(this.prefixUrl,l.previous.REST),srcGroup:z(this.prefixUrl,l.previous.GROUP),srcHover:z(this.prefixUrl,l.previous.HOVER),srcDown:z(this.prefixUrl,l.previous.DOWN),onRelease:r,onFocus:t,onBlur:n}),this.nextButton=new e.Button({element:this.nextButton?e.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.NextPage"),srcRest:z(this.prefixUrl,l.next.REST),srcGroup:z(this.prefixUrl,l.next.GROUP),srcHover:z(this.prefixUrl,l.next.HOVER),srcDown:z(this.prefixUrl,l.next.DOWN),onRelease:o,onFocus:t,onBlur:n}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),h&&(this.paging=new e.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:e.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var t=e.delegate(this,H),n=e.delegate(this,L),o=e.delegate(this,W),r=e.delegate(this,F),l=e.delegate(this,V),h=e.delegate(this,G),c=e.delegate(this,$),d=e.delegate(this,Z),m=e.delegate(this,X),w=e.delegate(this,K),y=e.delegate(this,v),T=e.delegate(this,f),x=this.navImages,S=[],E=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(E=!1),this.showZoomControl&&(S.push(this.zoomInButton=new e.Button({element:this.zoomInButton?e.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomIn"),srcRest:z(this.prefixUrl,x.zoomIn.REST),srcGroup:z(this.prefixUrl,x.zoomIn.GROUP),srcHover:z(this.prefixUrl,x.zoomIn.HOVER),srcDown:z(this.prefixUrl,x.zoomIn.DOWN),onPress:t,onRelease:n,onClick:o,onEnter:t,onExit:n,onFocus:y,onBlur:T})),S.push(this.zoomOutButton=new e.Button({element:this.zoomOutButton?e.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomOut"),srcRest:z(this.prefixUrl,x.zoomOut.REST),srcGroup:z(this.prefixUrl,x.zoomOut.GROUP),srcHover:z(this.prefixUrl,x.zoomOut.HOVER),srcDown:z(this.prefixUrl,x.zoomOut.DOWN),onPress:r,onRelease:n,onClick:l,onEnter:r,onExit:n,onFocus:y,onBlur:T}))),this.showHomeControl&&S.push(this.homeButton=new e.Button({element:this.homeButton?e.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Home"),srcRest:z(this.prefixUrl,x.home.REST),srcGroup:z(this.prefixUrl,x.home.GROUP),srcHover:z(this.prefixUrl,x.home.HOVER),srcDown:z(this.prefixUrl,x.home.DOWN),onRelease:h,onFocus:y,onBlur:T})),this.showFullPageControl&&S.push(this.fullPageButton=new e.Button({element:this.fullPageButton?e.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.FullPage"),srcRest:z(this.prefixUrl,x.fullpage.REST),srcGroup:z(this.prefixUrl,x.fullpage.GROUP),srcHover:z(this.prefixUrl,x.fullpage.HOVER),srcDown:z(this.prefixUrl,x.fullpage.DOWN),onRelease:c,onFocus:y,onBlur:T})),this.showRotationControl&&(S.push(this.rotateLeftButton=new e.Button({element:this.rotateLeftButton?e.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateLeft"),srcRest:z(this.prefixUrl,x.rotateleft.REST),srcGroup:z(this.prefixUrl,x.rotateleft.GROUP),srcHover:z(this.prefixUrl,x.rotateleft.HOVER),srcDown:z(this.prefixUrl,x.rotateleft.DOWN),onRelease:d,onFocus:y,onBlur:T})),S.push(this.rotateRightButton=new e.Button({element:this.rotateRightButton?e.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateRight"),srcRest:z(this.prefixUrl,x.rotateright.REST),srcGroup:z(this.prefixUrl,x.rotateright.GROUP),srcHover:z(this.prefixUrl,x.rotateright.HOVER),srcDown:z(this.prefixUrl,x.rotateright.DOWN),onRelease:m,onFocus:y,onBlur:T}))),this.showFlipControl&&S.push(this.flipButton=new e.Button({element:this.flipButton?e.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Flip"),srcRest:z(this.prefixUrl,x.flip.REST),srcGroup:z(this.prefixUrl,x.flip.GROUP),srcHover:z(this.prefixUrl,x.flip.HOVER),srcDown:z(this.prefixUrl,x.flip.DOWN),onRelease:w,onFocus:y,onBlur:T})),E&&(this.buttons=new e.ButtonGroup({buttons:S,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",e.delegate(this,U)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(e){return this.tileSources&&e>=0&&e<this.tileSources.length&&(this._sequenceIndex=e,this._updateSequenceButtons(e),this.open(this.tileSources[e]),this.referenceStrip&&this.referenceStrip.setFocus(e),this.raiseEvent("page",{page:e})),this},addOverlay:function(element,t,n,o){var h;if(h=e.isPlainObject(element)?element:{element:element,location:t,placement:n,onDraw:o},element=e.getElement(h.element),l(this.currentOverlays,element)>=0)return this;var c=r(this,h);return this.currentOverlays.push(c),c.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:element,location:h.location,placement:h.placement}),this},updateOverlay:function(element,n,o){var i;return element=e.getElement(element),(i=l(this.currentOverlays,element))>=0&&(this.currentOverlays[i].update(n,o),t[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:element,location:n,placement:o})),this},removeOverlay:function(element){var i;return element=e.getElement(element),(i=l(this.currentOverlays,element))>=0&&(this.currentOverlays[i].destroy(),this.currentOverlays.splice(i,1),t[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:element})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return t[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(element){var i;return element=e.getElement(element),(i=l(this.currentOverlays,element))>=0?this.currentOverlays[i]:null},_updateSequenceButtons:function(e){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==e?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(e>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(t){this._hideMessage();var div=e.makeNeutralElement("div");div.appendChild(document.createTextNode(t)),this.messageDiv=e.makeCenteredNode(div),e.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var div=this.messageDiv;div&&(div.parentNode.removeChild(div),delete this.messageDiv)},gestureSettingsByDeviceType:function(e){switch(e){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var i,e=this.currentOverlays.length;for(i=0;i<e;i++)this.currentOverlays[i].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new e.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else e.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}})}(OpenSeadragon),function(e){function t(e){var t={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",t),!t.preventDefaultAction&&e.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x);var n=this.viewport.pointFromPixel(e.position);this.panVertical?this.panHorizontal||(n.x=this.viewer.viewport.getCenter(!0).x):n.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(n),this.viewer.viewport.applyConstraints()}}function n(e){var t={tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",t),!t.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewer.viewport.flipped&&(e.delta.x=-e.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function o(e){e.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function r(e){return this.viewer.raiseEvent("navigator-scroll",{tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent}),!1}function l(element,e){h(element,"rotate("+e+"deg)")}function h(element,e){element.style.webkitTransform=e,element.style.mozTransform=e,element.style.msTransform=e,element.style.oTransform=e,element.style.transform=e}e.Navigator=function(h){var c,d,style,m,v=h.viewer,f=this;function w(e){l(f.displayRegionContainer,e),l(f.displayRegion,-e),f.viewport.setRotation(e)}(h.id?(this.element=document.getElementById(h.id),h.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(h.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),h.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:h.autoFade},h.position&&("BOTTOM_RIGHT"==h.position?h.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==h.position?h.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==h.position?h.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==h.position?h.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:"ABSOLUTE"==h.position&&(h.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,h.controlOptions.top=h.top,h.controlOptions.left=h.left,h.controlOptions.height=h.height,h.controlOptions.width=h.width))),this.element.id=h.id,this.element.className+=" navigator",(h=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},h,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:h.autoResize,minZoomImageRatio:1,background:h.background,opacity:h.opacity,borderColor:h.borderColor,displayRegionColor:h.displayRegionColor})).minPixelRatio=this.minPixelRatio=v.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),h.controlOptions.anchor!=e.ControlAnchor.NONE&&(style=this.element.style,m=this.borderWidth,style.margin="0px",style.border=m+"px solid "+h.borderColor,style.padding="0px",style.background=h.background,style.opacity=h.opacity,style.overflow="hidden"),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(style,e){style.position="relative",style.top="0px",style.left="0px",style.fontSize="0px",style.overflow="hidden",style.border=e+"px solid "+h.displayRegionColor,style.margin="0px",style.padding="0px",style.background="transparent",style.float="left",style.cssFloat="left",style.styleFloat="left",style.zIndex=999999999,style.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",v.addControl(this.element,h.controlOptions),this._resizeWithViewer=h.controlOptions.anchor!=e.ControlAnchor.ABSOLUTE&&h.controlOptions.anchor!=e.ControlAnchor.NONE,h.width&&h.height?(this.setWidth(h.width),this.setHeight(h.height)):this._resizeWithViewer&&(c=e.getElementSize(v.element),this.element.style.height=Math.round(c.y*h.sizeRatio)+"px",this.element.style.width=Math.round(c.x*h.sizeRatio)+"px",this.oldViewerSize=c,d=e.getElementSize(this.element),this.elementArea=d.x*d.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[h]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),h.navigatorRotate)&&(w(h.viewer.viewport?h.viewer.viewport.getRotation():h.viewer.degrees||0),h.viewer.addHandler("rotate",(function(e){w(e.degrees)})));this.innerTracker.destroy(),this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,n),clickHandler:e.delegate(this,t),releaseHandler:e.delegate(this,o),scrollHandler:e.delegate(this,r)}),this.addHandler("reset-size",(function(){f.viewport&&f.viewport.goHome(!0)})),v.world.addHandler("item-index-change",(function(e){window.setTimeout((function(){var t=f.world.getItemAt(e.previousIndex);f.world.setItemIndex(t,e.newIndex)}),1)})),v.world.addHandler("remove-item",(function(e){var t=e.item,n=f._getMatchingItem(t);n&&f.world.removeItem(n)})),this.update(v.viewport)},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var t=new e.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);t.equals(this.oldContainerSize)||(this.viewport.resize(t,!0),this.viewport.goHome(!0),this.oldContainerSize=t,this.drawer.clear(),this.world.draw())}},setWidth:function(e){this.width=e,this.element.style.width="number"==typeof e?e+"px":e,this._resizeWithViewer=!1},setHeight:function(e){this.height=e,this.element.style.height="number"==typeof e?e+"px":e,this._resizeWithViewer=!1},setFlip:function(e){return this.viewport.setFlip(e),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(e){h(this.displayRegion,e),h(this.canvas,e),h(this.element,e)},update:function(t){var n,o,r,l,h,c;if(n=e.getElementSize(this.viewer.element),this._resizeWithViewer&&n.x&&n.y&&!n.equals(this.oldViewerSize)&&(this.oldViewerSize=n,this.maintainSizeRatio||!this.elementArea?(o=n.x*this.sizeRatio,r=n.y*this.sizeRatio):(o=Math.sqrt(this.elementArea*(n.x/n.y)),r=this.elementArea/o),this.element.style.width=Math.round(o)+"px",this.element.style.height=Math.round(r)+"px",this.elementArea||(this.elementArea=o*r),this.updateSize()),t&&this.viewport){l=t.getBoundsNoRotate(!0),h=this.viewport.pixelFromPointNoRotate(l.getTopLeft(),!1),c=this.viewport.pixelFromPointNoRotate(l.getBottomRight(),!1).minus(this.totalBorderWidths);var style=this.displayRegion.style;style.display=this.world.getItemCount()?"block":"none",style.top=Math.round(h.y)+"px",style.left=Math.round(h.x)+"px";var d=Math.abs(h.x-c.x),m=Math.abs(h.y-c.y);style.width=Math.round(Math.max(d,0))+"px",style.height=Math.round(Math.max(m,0))+"px"}},addTiledImage:function(t){var n=this,o=t.originalTiledImage;delete t.original;var r=e.extend({},t,{success:function(e){var t=e.item;function r(){n._matchBounds(t,o)}t._originalForNavigator=o,n._matchBounds(t,o,!0),o.addHandler("bounds-change",r),o.addHandler("clip-change",r),o.addHandler("opacity-change",(function(){n._matchOpacity(t,o)})),o.addHandler("composite-operation-change",(function(){n._matchCompositeOperation(t,o)}))}});return e.Viewer.prototype.addTiledImage.apply(this,[r])},_getMatchingItem:function(e){for(var t,n=this.world.getItemCount(),i=0;i<n;i++)if((t=this.world.getItemAt(i))._originalForNavigator===e)return t;return null},_matchBounds:function(e,t,n){var o=t.getBoundsNoRotate();e.setPosition(o.getTopLeft(),n),e.setWidth(o.width,n),e.setRotation(t.getRotation(),n),e.setClip(t.getClip())},_matchOpacity:function(e,t){e.setOpacity(t.opacity)},_matchCompositeOperation:function(e,t){e.setCompositeOperation(t.compositeOperation)}})}(OpenSeadragon),function(e){var t={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};e.extend(e,{getString:function(n){var i,o=n.split("."),r=null,l=arguments,h=t;for(i=0;i<o.length-1;i++)h=h[o[i]]||{};return"string"!=typeof(r=h[o[i]])&&(e.console.log("Untranslated source string:",n),r=""),r.replace(/\{\d+\}/g,(function(e){var i=parseInt(e.match(/\d+/),10)+1;return i<l.length?l[i]:""}))},setString:function(e,n){var i,o=e.split("."),r=t;for(i=0;i<o.length-1;i++)r[o[i]]||(r[o[i]]={}),r=r[o[i]];r[o[i]]=n}})}(OpenSeadragon),function(e){e.Point=function(e,t){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0},e.Point.prototype={clone:function(){return new e.Point(this.x,this.y)},plus:function(t){return new e.Point(this.x+t.x,this.y+t.y)},minus:function(t){return new e.Point(this.x-t.x,this.y-t.y)},times:function(t){return new e.Point(this.x*t,this.y*t)},divide:function(t){return new e.Point(this.x/t,this.y/t)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},squaredDistanceTo:function(e){return Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)},apply:function(t){return new e.Point(t(this.x),t(this.y))},equals:function(t){return t instanceof e.Point&&this.x===t.x&&this.y===t.y},rotate:function(t,n){var o,r;if(n=n||new e.Point(0,0),t%90==0){switch(e.positiveModulo(t,360)){case 0:o=1,r=0;break;case 90:o=0,r=1;break;case 180:o=-1,r=0;break;case 270:o=0,r=-1}}else{var l=t*Math.PI/180;o=Math.cos(l),r=Math.sin(l)}var h=o*(this.x-n.x)-r*(this.y-n.y)+n.x,c=r*(this.x-n.x)+o*(this.y-n.y)+n.y;return new e.Point(h,c)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function(e){e.TileSource=function(t,n,o,r,l,h){var c,i,d=this,m=arguments;if(c=e.isPlainObject(t)?t:{width:m[0],height:m[1],tileSize:m[2],tileOverlap:m[3],minLevel:m[4],maxLevel:m[5]},e.EventSource.call(this),e.extend(!0,this,c),!this.success)for(i=0;i<arguments.length;i++)if(e.isFunction(arguments[i])){this.success=arguments[i];break}this.success&&this.addHandler("ready",(function(e){d.success(e)})),"string"==e.type(arguments[0])&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new e.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=c.width&&c.height?c.width/c.height:1,this.dimensions=new e.Point(c.width,c.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=c.tileOverlap?c.tileOverlap:0,this.minLevel=c.minLevel?c.minLevel:0,this.maxLevel=void 0!==c.maxLevel&&null!==c.maxLevel?c.maxLevel:c.width&&c.height?Math.ceil(Math.log(Math.max(c.width,c.height))/Math.log(2)):0,this.success&&e.isFunction(this.success)&&this.success(this))},e.TileSource.prototype={getTileSize:function(t){return e.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(e){return this._tileWidth?this._tileWidth:this.getTileSize(e)},getTileHeight:function(e){return this._tileHeight?this._tileHeight:this.getTileSize(e)},getLevelScale:function(e){var i,t={};for(i=0;i<=this.maxLevel;i++)t[i]=1/Math.pow(2,this.maxLevel-i);return this.getLevelScale=function(e){return t[e]},this.getLevelScale(e)},getNumTiles:function(t){var n=this.getLevelScale(t),o=Math.ceil(n*this.dimensions.x/this.getTileWidth(t)),r=Math.ceil(n*this.dimensions.y/this.getTileHeight(t));return new e.Point(o,r)},getPixelRatio:function(t){var n=this.dimensions.times(this.getLevelScale(t)),o=1/n.x,r=1/n.y;return new e.Point(o,r)},getClosestLevel:function(){var i,e;for(i=this.minLevel+1;i<=this.maxLevel&&!((e=this.getNumTiles(i)).x>1||e.y>1);i++);return i-1},getTileAtPoint:function(t,n){var o=n.x>=0&&n.x<=1&&n.y>=0&&n.y<=1/this.aspectRatio;e.console.assert(o,"[TileSource.getTileAtPoint] must be called with a valid point.");var r=this.dimensions.x*this.getLevelScale(t),l=n.x*r,h=n.y*r,c=Math.floor(l/this.getTileWidth(t)),d=Math.floor(h/this.getTileHeight(t));n.x>=1&&(c=this.getNumTiles(t).x-1);return n.y>=1/this.aspectRatio-1e-15&&(d=this.getNumTiles(t).y-1),new e.Point(c,d)},getTileBounds:function(t,n,o,r){var l=this.dimensions.times(this.getLevelScale(t)),h=this.getTileWidth(t),c=this.getTileHeight(t),d=0===n?0:h*n-this.tileOverlap,m=0===o?0:c*o-this.tileOverlap,v=h+(0===n?1:2)*this.tileOverlap,f=c+(0===o?1:2)*this.tileOverlap,w=1/l.x;return v=Math.min(v,l.x-d),f=Math.min(f,l.y-m),r?new e.Rect(0,0,v,f):new e.Rect(d*w,m*w,v*w,f*w)},getImageInfo:function(t){var n,o,r,l,h,c,d,m=this;t&&(d=(c=(h=t.split("/"))[h.length-1]).lastIndexOf("."))>-1&&(h[h.length-1]=c.slice(0,d)),o=function(data){"string"==typeof data&&(data=e.parseXml(data));var n=e.TileSource.determineType(m,data,t);n?(void 0===(l=n.prototype.configure.apply(m,[data,t])).ajaxWithCredentials&&(l.ajaxWithCredentials=m.ajaxWithCredentials),r=new n(l),m.ready=!0,m.raiseEvent("ready",{tileSource:r})):m.raiseEvent("open-failed",{message:"Unable to load TileSource",source:t})},t.match(/\.js$/)?(n=t.split("/").pop().replace(".js",""),e.jsonp({url:t,async:!1,callbackName:n,callback:o})):e.makeAjaxRequest({url:t,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(t){var data=function(t){var n,data,o=t.responseText,r=t.status;if(!t)throw new Error(e.getString("Errors.Security"));if(200!==t.status&&0!==t.status)throw n=404==(r=t.status)?"Not Found":t.statusText,new Error(e.getString("Errors.Status",r,n));if(o.match(/\s*<.*/))try{data=t.responseXML&&t.responseXML.documentElement?t.responseXML:e.parseXml(o)}catch(e){data=t.responseText}else if(o.match(/\s*[\{\[].*/))try{data=e.parseJSON(o)}catch(e){data=o}else data=o;return data}(t);o(data)},error:function(e,n){var o;try{o="HTTP "+e.status+" attempting to load TileSource"}catch(e){o=(void 0!==n&&n.toString?n.toString():"Unknown error")+" attempting to load TileSource"}m.raiseEvent("open-failed",{message:o,source:t})}})},supports:function(data,e){return!1},configure:function(data,e){throw new Error("Method not implemented.")},getTileUrl:function(e,t,n){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(e,t,n){return{}},tileExists:function(e,t,n){var o=this.getNumTiles(e);return e>=this.minLevel&&e<=this.maxLevel&&t>=0&&n>=0&&t<o.x&&n<o.y}},e.extend(!0,e.TileSource.prototype,e.EventSource.prototype),e.TileSource.determineType=function(t,data,n){var o;for(o in OpenSeadragon)if(o.match(/.+TileSource$/)&&e.isFunction(OpenSeadragon[o])&&e.isFunction(OpenSeadragon[o].prototype.supports)&&OpenSeadragon[o].prototype.supports.call(t,data,n))return OpenSeadragon[o];e.console.error("No TileSource was able to open %s %s",n,data)}}(OpenSeadragon),function(e){function t(t,n){var o,i,r=n.Image,l=r.Url,h=r.Format,c=r.Size,d=r.DisplayRect||[],m=parseInt(c.Width,10),v=parseInt(c.Height,10),f=parseInt(r.TileSize,10),w=parseInt(r.Overlap,10),y=[];for(i=0;i<d.length;i++)o=d[i].Rect,y.push(new e.DisplayRect(parseInt(o.X,10),parseInt(o.Y,10),parseInt(o.Width,10),parseInt(o.Height,10),parseInt(o.MinLevel,10),parseInt(o.MaxLevel,10)));return e.extend(!0,{width:m,height:v,tileSize:f,tileOverlap:w,minLevel:null,maxLevel:null,tilesUrl:l,fileFormat:h,displayRects:y},n)}e.DziTileSource=function(t,n,o,r,l,h,c,d,m){var i,rect,v,f;if(f=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=f.tilesUrl,this.fileFormat=f.fileFormat,this.displayRects=f.displayRects,this.displayRects)for(i=this.displayRects.length-1;i>=0;i--)for(v=(rect=this.displayRects[i]).minLevel;v<=rect.maxLevel;v++)this._levelRects[v]||(this._levelRects[v]=[]),this._levelRects[v].push(rect);e.TileSource.apply(this,[f])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(data,e){var t;return data.Image?t=data.Image.xmlns:data.documentElement&&("Image"!=data.documentElement.localName&&"Image"!=data.documentElement.tagName||(t=data.documentElement.namespaceURI)),-1!==(t=(t||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==t.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(data,n){var o;return o=e.isPlainObject(data)?t(this,data):function(n,o){if(!o||!o.documentElement)throw new Error(e.getString("Errors.Xml"));var r,l,h,c,i,d=o.documentElement,m=d.localName||d.tagName,v=o.documentElement.namespaceURI,f=null,w=[];if("Image"==m)try{if(void 0===(c=d.getElementsByTagName("Size")[0])&&(c=d.getElementsByTagNameNS(v,"Size")[0]),f={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:d.getAttribute("Url"),Format:d.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(d.getAttribute("Overlap"),10),TileSize:parseInt(d.getAttribute("TileSize"),10),Size:{Height:parseInt(c.getAttribute("Height"),10),Width:parseInt(c.getAttribute("Width"),10)}}},!e.imageFormatSupported(f.Image.Format))throw new Error(e.getString("Errors.ImageFormat",f.Image.Format.toUpperCase()));for(void 0===(r=d.getElementsByTagName("DisplayRect"))&&(r=d.getElementsByTagNameNS(v,"DisplayRect")[0]),i=0;i<r.length;i++)void 0===(h=(l=r[i]).getElementsByTagName("Rect")[0])&&(h=l.getElementsByTagNameNS(v,"Rect")[0]),w.push({Rect:{X:parseInt(h.getAttribute("X"),10),Y:parseInt(h.getAttribute("Y"),10),Width:parseInt(h.getAttribute("Width"),10),Height:parseInt(h.getAttribute("Height"),10),MinLevel:parseInt(l.getAttribute("MinLevel"),10),MaxLevel:parseInt(l.getAttribute("MaxLevel"),10)}});return w.length&&(f.Image.DisplayRect=w),t(n,f)}catch(t){throw t instanceof Error?t:new Error(e.getString("Errors.Dzi"))}else{if("Collection"==m)throw new Error(e.getString("Errors.Dzc"));if("Error"==m){var y=d.getElementsByTagName("Message")[0].firstChild.nodeValue;throw new Error(y)}}throw new Error(e.getString("Errors.Dzi"))}(this,data),n&&!o.tilesUrl&&(o.tilesUrl=n.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),-1!=n.search(/\.(dzi|xml|js)\?/)?o.queryParams=n.match(/\?.*/):o.queryParams=""),o},getTileUrl:function(e,t,n){return[this.tilesUrl,e,"/",t,"_",n,".",this.fileFormat,this.queryParams].join("")},tileExists:function(e,t,n){var rect,o,r,l,h,c,i,d=this._levelRects[e];if(this.minLevel&&e<this.minLevel||this.maxLevel&&e>this.maxLevel)return!1;if(!d||!d.length)return!0;for(i=d.length-1;i>=0;i--)if(!(e<(rect=d[i]).minLevel||e>rect.maxLevel)&&(o=this.getLevelScale(e),r=rect.x*o,l=rect.y*o,h=r+rect.width*o,c=l+rect.height*o,r=Math.floor(r/this._tileWidth),l=Math.floor(l/this._tileWidth),h=Math.ceil(h/this._tileWidth),c=Math.ceil(c/this._tileWidth),r<=t&&t<h&&l<=n&&n<c))return!0;return!1}})}(OpenSeadragon),function(e){function t(e){var t=Array.isArray(e.profile)?e.profile[0]:e.profile,n=-1!==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"].indexOf(t),o=!1;return 2===e.version&&e.profile.length>1&&e.profile[1].supports&&(o=-1!==e.profile[1].supports.indexOf("sizeByW")),3===e.version&&e.extraFeatures&&(o=-1!==e.extraFeatures.indexOf("sizeByWh")),!n||o}function n(e){for(var t=[],i=0;i<e.sizes.length;i++)t.push({url:e["@id"]+"/full/"+e.sizes[i].width+","+(3===e.version?e.sizes[i].height:"")+"/0/default."+e.tileFormat,width:e.sizes[i].width,height:e.sizes[i].height});return t.sort((function(a,b){return a.width-b.width}))}function o(t,n,r){var i,l;if(3==t.nodeType&&r)(l=t.nodeValue.trim()).match(/^\d*$/)&&(l=Number(l)),n[r]?(e.isArray(n[r])||(n[r]=[n[r]]),n[r].push(l)):n[r]=l;else if(1==t.nodeType)for(i=0;i<t.childNodes.length;i++)o(t.childNodes[i],n,t.nodeName)}e.IIIFTileSource=function(o){if(e.extend(!0,this,o),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(o.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=o.version,this.tile_width&&this.tile_height)o.tileWidth=this.tile_width,o.tileHeight=this.tile_height;else if(this.tile_width)o.tileSize=this.tile_width;else if(this.tile_height)o.tileSize=this.tile_height;else if(this.tiles)if(1==this.tiles.length)o.tileWidth=this.tiles[0].width,o.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var r=0;r<this.tiles.length;r++)for(var l=0;l<this.tiles[r].scaleFactors.length;l++){var h=this.tiles[r].scaleFactors[l];this.scale_factors.push(h),o.tileSizePerScaleFactor[h]={width:this.tiles[r].width,height:this.tiles[r].height||this.tiles[r].width}}}else if(t(o)){for(var c=Math.min(this.height,this.width),d=[256,512,1024],m=[],v=0;v<d.length;v++)d[v]<=c&&m.push(d[v]);m.length>0?o.tileSize=Math.max.apply(null,m):o.tileSize=c}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,o.levels=n(this),e.extend(!0,o,{width:o.levels[o.levels.length-1].width,height:o.levels[o.levels.length-1].height,tileSize:Math.max(o.height,o.width),tileOverlap:0,minLevel:0,maxLevel:o.levels.length-1}),this.levels=o.levels):e.console.error("Nothing in the info.json to construct image pyramids from");if(!o.maxLevel&&!this.emulateLegacyImagePyramid)if(this.scale_factors){var f=Math.max.apply(null,this.scale_factors);o.maxLevel=Math.round(Math.log(f)*Math.LOG2E)}else o.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));e.TileSource.apply(this,[o])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(data,e){return!(!data.protocol||"http://iiif.io/api/image"!=data.protocol)||(!(!data["@context"]||"http://library.stanford.edu/iiif/image-api/1.1/context.json"!=data["@context"]&&"http://iiif.io/api/image/1/context.json"!=data["@context"])||(!(!data.profile||0!==data.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html"))||(!!(data.identifier&&data.width&&data.height)||!(!data.documentElement||"info"!=data.documentElement.tagName||"http://library.stanford.edu/iiif/image-api/ns/"!=data.documentElement.namespaceURI))))},configure:function(data,t){if(e.isPlainObject(data)){if(data["@context"]){var n=data["@context"];if(Array.isArray(n))for(var i=0;i<n.length;i++)if("string"==typeof n[i]&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(n[i])||"http://library.stanford.edu/iiif/image-api/1.1/context.json"===n[i])){n=n[i];break}switch(n){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":data.version=1;break;case"http://iiif.io/api/image/2/context.json":data.version=2;break;case"http://iiif.io/api/image/3/context.json":data.version=3;break;default:e.console.error("Data has a @context property which contains no known IIIF context URI.")}}else data["@context"]="http://iiif.io/api/image/1.0/context.json",data["@id"]=t.replace("/info.json",""),data.version=1;if(!data["@id"]&&data.id&&(data["@id"]=data.id),data.preferredFormats)for(var r=0;r<data.preferredFormats.length;r++)if(OpenSeadragon.imageFormatSupported(data.preferredFormats[r])){data.tileFormat=data.preferredFormats[r];break}return data}var l=function(t){if(!t||!t.documentElement)throw new Error(e.getString("Errors.Xml"));var n=t.documentElement,r=n.tagName,l=null;if("info"==r)try{return o(n,l={}),l}catch(t){throw t instanceof Error?t:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}(data);return l["@context"]="http://iiif.io/api/image/1.0/context.json",l["@id"]=t.replace("/info.xml",""),l.version=1,l},getTileWidth:function(t){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileWidth.call(this,t);var n=Math.pow(2,this.maxLevel-t);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[n]?this.tileSizePerScaleFactor[n].width:this._tileWidth},getTileHeight:function(t){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileHeight.call(this,t);var n=Math.pow(2,this.maxLevel-t);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[n]?this.tileSizePerScaleFactor[n].height:this._tileHeight},getLevelScale:function(t){if(this.emulateLegacyImagePyramid){var n=NaN;return this.levels.length>0&&t>=this.minLevel&&t<=this.maxLevel&&(n=this.levels[t].width/this.levels[this.maxLevel].width),n}return e.TileSource.prototype.getLevelScale.call(this,t)},getNumTiles:function(t){return this.emulateLegacyImagePyramid?this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0):e.TileSource.prototype.getNumTiles.call(this,t)},getTileAtPoint:function(t,n){return this.emulateLegacyImagePyramid?new e.Point(0,0):e.TileSource.prototype.getTileAtPoint.call(this,t,n)},getTileUrl:function(e,t,n){if(this.emulateLegacyImagePyramid){var o=null;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(o=this.levels[e].url),o}var r,l,h,c,d,m,v,f,w,y,T,x,S,E=Math.pow(.5,this.maxLevel-e),P=Math.ceil(this.width*E),_=Math.ceil(this.height*E);return r=this.getTileWidth(e),l=this.getTileHeight(e),h=Math.ceil(r/E),c=Math.ceil(l/E),S=1===this.version?"native."+this.tileFormat:"default."+this.tileFormat,P<r&&_<l?(y=2===this.version&&P===this.width||3===this.version&&P===this.width&&_===this.height?"max":3===this.version?P+","+_:P+",",d="full"):(m=t*h,v=n*c,f=Math.min(h,this.width-m),w=Math.min(c,this.height-v),d=0===t&&0===n&&f===this.width&&w===this.height?"full":[m,v,f,w].join(","),T=Math.ceil(f*E),x=Math.ceil(w*E),y=2===this.version&&T===this.width||3===this.version&&T===this.width&&x===this.height?"max":3===this.version?T+","+x:T+","),[this["@id"],d,y,"0",S].join("/")},__testonly__:{canBeTiled:t,constructLevels:n}})}(OpenSeadragon),function(e){e.OsmTileSource=function(t,n,o,r,l){var h;(h=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]}).width&&h.height||(h.width=65572864,h.height=65572864),h.tileSize||(h.tileSize=256,h.tileOverlap=0),h.tilesUrl||(h.tilesUrl="http://tile.openstreetmap.org/"),h.minLevel=8,e.TileSource.apply(this,[h])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(data,e){return data.type&&"openstreetmaps"==data.type},configure:function(data,e){return data},getTileUrl:function(e,t,n){return this.tilesUrl+(e-8)+"/"+t+"/"+n+".png"}})}(OpenSeadragon),function(e){e.TmsTileSource=function(t,n,o,r,l){var h;h=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var c,d=256*Math.ceil(h.width/256),m=256*Math.ceil(h.height/256);c=d>m?d/256:m/256,h.maxLevel=Math.ceil(Math.log(c)/Math.log(2))-1,h.tileSize=256,h.width=d,h.height=m,e.TileSource.apply(this,[h])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(data,e){return data.type&&"tiledmapservice"==data.type},configure:function(data,e){return data},getTileUrl:function(e,t,n){var o=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+t+"/"+(o-n)+".png"}})}(OpenSeadragon),function(e){e.ZoomifyTileSource=function(e){e.tileSize=256;var t={x:e.width,y:e.height};for(e.imageSizes=[{x:e.width,y:e.height}],e.gridSize=[this._getGridSize(e.width,e.height,e.tileSize)];parseInt(t.x,10)>e.tileSize||parseInt(t.y,10)>e.tileSize;)t.x=Math.floor(t.x/2),t.y=Math.floor(t.y/2),e.imageSizes.push({x:t.x,y:t.y}),e.gridSize.push(this._getGridSize(t.x,t.y,e.tileSize));e.imageSizes.reverse(),e.gridSize.reverse(),e.minLevel=0,e.maxLevel=e.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[e])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(e,t,n){return{x:Math.ceil(e/n),y:Math.ceil(t/n)}},_calculateAbsoluteTileNumber:function(e,t,n){for(var o=0,r={},l=0;l<e;l++)o+=(r=this.gridSize[l]).x*r.y;return o+=(r=this.gridSize[e]).x*n+t},supports:function(data,e){return data.type&&"zoomifytileservice"==data.type},configure:function(data,e){return data},getTileUrl:function(e,t,n){var o,r=this._calculateAbsoluteTileNumber(e,t,n);return o=Math.floor(r/256),this.tilesUrl+"TileGroup"+o+"/"+e+"-"+t+"-"+n+".jpg"}})}(OpenSeadragon),function(e){function t(e,t){return t.levels}e.LegacyTileSource=function(t){var n,o,r;e.isArray(t)&&(n={type:"legacy-image-pyramid",levels:t}),n.levels=function(t){var n,i,o=[];for(i=0;i<t.length;i++)(n=t[i]).height&&n.width&&n.url?o.push({url:n.url,width:Number(n.width),height:Number(n.height)}):e.console.error("Unsupported image format: %s",n.url?n.url:"<no URL>");return o.sort((function(a,b){return a.height-b.height}))}(n.levels),n.levels.length>0?(o=n.levels[n.levels.length-1].width,r=n.levels[n.levels.length-1].height):(o=0,r=0,e.console.error("No supported image formats found")),e.extend(!0,n,{width:o,height:r,tileSize:Math.max(r,o),tileOverlap:0,minLevel:0,maxLevel:n.levels.length>0?n.levels.length-1:0}),e.TileSource.apply(this,[n]),this.levels=n.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(data,e){return data.type&&"legacy-image-pyramid"==data.type||data.documentElement&&"legacy-image-pyramid"==data.documentElement.getAttribute("type")},configure:function(n,o){return e.isPlainObject(n)?t(this,n):function(n,o){if(!o||!o.documentElement)throw new Error(e.getString("Errors.Xml"));var r,i,l=o.documentElement,h=l.tagName,c=null,d=[];if("image"==h)try{for(c={type:l.getAttribute("type"),levels:[]},d=l.getElementsByTagName("level"),i=0;i<d.length;i++)r=d[i],c.levels.push({url:r.getAttribute("url"),width:parseInt(r.getAttribute("width"),10),height:parseInt(r.getAttribute("height"),10)});return t(n,c)}catch(e){throw e instanceof Error?e:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==h)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==h)throw new Error("Error: "+o)}throw new Error("Unknown element "+h)}(this,n)},getLevelScale:function(e){var t=NaN;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){return this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(e,t,n){var o=null;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(o=this.levels[e].url),o}})}(OpenSeadragon),function(e){e.ImageTileSource=function(t){t=e.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},t),e.TileSource.apply(this,[t])},e.extend(e.ImageTileSource.prototype,e.TileSource.prototype,{supports:function(data,e){return data.type&&"image"===data.type},configure:function(e,t){return e},getImageInfo:function(t){var image=this._image=new Image,n=this;this.crossOriginPolicy&&(image.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(image.useCredentials=this.ajaxWithCredentials),e.addEvent(image,"load",(function(){n.width=Object.prototype.hasOwnProperty.call(image,"naturalWidth")?image.naturalWidth:image.width,n.height=Object.prototype.hasOwnProperty.call(image,"naturalHeight")?image.naturalHeight:image.height,n.aspectRatio=n.width/n.height,n.dimensions=new e.Point(n.width,n.height),n._tileWidth=n.width,n._tileHeight=n.height,n.tileOverlap=0,n.minLevel=0,n.levels=n._buildLevels(),n.maxLevel=n.levels.length-1,n.ready=!0,n.raiseEvent("ready",{tileSource:n})})),e.addEvent(image,"error",(function(){n.raiseEvent("open-failed",{message:"Error loading image at "+t,source:t})})),image.src=t},getLevelScale:function(e){var t=NaN;return e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){return this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(e,t,n){var o=null;return e>=this.minLevel&&e<=this.maxLevel&&(o=this.levels[e].url),o},getContext2D:function(e,t,n){var o=null;return e>=this.minLevel&&e<=this.maxLevel&&(o=this.levels[e].context2D),o},_buildLevels:function(){var t=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!e.supportsCanvas||!this.useCanvas)return delete this._image,t;var n=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,o=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,r=document.createElement("canvas"),l=r.getContext("2d");if(r.width=n,r.height=o,l.drawImage(this._image,0,0,n,o),t[0].context2D=l,delete this._image,e.isCanvasTainted(r))return t;for(;n>=2&&o>=2;){n=Math.floor(n/2),o=Math.floor(o/2);var h=document.createElement("canvas"),c=h.getContext("2d");h.width=n,h.height=o,c.drawImage(r,0,0,n,o),t.splice(0,0,{context2D:c,width:n,height:o}),r=h,l=c}return t}})}(OpenSeadragon),function(e){e.TileSourceCollection=function(t,n,o,r){e.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(e){function t(button){e.requestAnimationFrame((function(){!function(button){var n;button.shouldFade&&(n=1-(e.now()-button.fadeBeginTime)/button.fadeLength,n=Math.min(1,n),n=Math.max(0,n),button.imgGroup&&e.setElementOpacity(button.imgGroup,n,!0),n>0&&t(button))}(button)}))}function n(button,t){button.element.disabled||(t>=e.ButtonState.GROUP&&button.currentState==e.ButtonState.REST&&(!function(button){button.shouldFade=!1,button.imgGroup&&e.setElementOpacity(button.imgGroup,1,!0)}(button),button.currentState=e.ButtonState.GROUP),t>=e.ButtonState.HOVER&&button.currentState==e.ButtonState.GROUP&&(button.imgHover&&(button.imgHover.style.visibility=""),button.currentState=e.ButtonState.HOVER),t>=e.ButtonState.DOWN&&button.currentState==e.ButtonState.HOVER&&(button.imgDown&&(button.imgDown.style.visibility=""),button.currentState=e.ButtonState.DOWN))}function o(button,n){button.element.disabled||(n<=e.ButtonState.HOVER&&button.currentState==e.ButtonState.DOWN&&(button.imgDown&&(button.imgDown.style.visibility="hidden"),button.currentState=e.ButtonState.HOVER),n<=e.ButtonState.GROUP&&button.currentState==e.ButtonState.HOVER&&(button.imgHover&&(button.imgHover.style.visibility="hidden"),button.currentState=e.ButtonState.GROUP),n<=e.ButtonState.REST&&button.currentState==e.ButtonState.GROUP&&(!function(button){button.shouldFade=!0,button.fadeBeginTime=e.now()+button.fadeDelay,window.setTimeout((function(){t(button)}),button.fadeDelay)}(button),button.currentState=e.ButtonState.REST))}e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(t){var r=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},t),this.element=t.element||e.makeNeutralElement("div"),t.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",e.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor==e.BROWSERS.FIREFOX&&e.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(t){t.insideElementPressed?(n(r,e.ButtonState.DOWN),r.raiseEvent("enter",{originalEvent:t.originalEvent})):t.buttonDownAny||n(r,e.ButtonState.HOVER)},focusHandler:function(e){this.enterHandler(e),r.raiseEvent("focus",{originalEvent:e.originalEvent})},exitHandler:function(t){o(r,e.ButtonState.GROUP),t.insideElementPressed&&r.raiseEvent("exit",{originalEvent:t.originalEvent})},blurHandler:function(e){this.exitHandler(e),r.raiseEvent("blur",{originalEvent:e.originalEvent})},pressHandler:function(t){n(r,e.ButtonState.DOWN),r.raiseEvent("press",{originalEvent:t.originalEvent})},releaseHandler:function(t){t.insideElementPressed&&t.insideElementReleased?(o(r,e.ButtonState.HOVER),r.raiseEvent("release",{originalEvent:t.originalEvent})):t.insideElementPressed?o(r,e.ButtonState.GROUP):n(r,e.ButtonState.HOVER)},clickHandler:function(e){e.quick&&r.raiseEvent("click",{originalEvent:e.originalEvent})},keyHandler:function(e){return 13!==e.keyCode||(r.raiseEvent("click",{originalEvent:e.originalEvent}),r.raiseEvent("release",{originalEvent:e.originalEvent}),!1)}}),o(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){n(this,e.ButtonState.GROUP)},notifyGroupExit:function(){o(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(e){e.ButtonGroup=function(t){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},t);var i,n=this.buttons.concat([]),o=this;if(this.element=t.element||e.makeNeutralElement("div"),!t.group)for(this.element.style.display="inline-block",i=0;i<n.length;i++)this.element.appendChild(n[i].element);e.setElementTouchActionNone(this.element),this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(e){var i;for(i=0;i<o.buttons.length;i++)o.buttons[i].notifyGroupEnter()},exitHandler:function(e){var i;if(!e.insideElementPressed)for(i=0;i<o.buttons.length;i++)o.buttons[i].notifyGroupExit()}})},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(e){e.Rect=function(t,n,o,r,l){var h,c;this.x="number"==typeof t?t:0,this.y="number"==typeof n?n:0,this.width="number"==typeof o?o:0,this.height="number"==typeof r?r:0,this.degrees="number"==typeof l?l:0,this.degrees=e.positiveModulo(this.degrees,360),this.degrees>=270?(h=this.getTopRight(),this.x=h.x,this.y=h.y,c=this.height,this.height=this.width,this.width=c,this.degrees-=270):this.degrees>=180?(h=this.getBottomRight(),this.x=h.x,this.y=h.y,this.degrees-=180):this.degrees>=90&&(h=this.getBottomLeft(),this.x=h.x,this.y=h.y,c=this.height,this.height=this.width,this.width=c,this.degrees-=90)},e.Rect.fromSummits=function(t,n,o){var r=t.distanceTo(n),l=t.distanceTo(o),h=n.minus(t),c=Math.atan(h.y/h.x);return h.x<0?c+=Math.PI:h.y<0&&(c+=2*Math.PI),new e.Rect(t.x,t.y,r,l,c/Math.PI*180)},e.Rect.prototype={clone:function(){return new e.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new e.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new e.Point(this.width,this.height)},equals:function(t){return t instanceof e.Rect&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height&&this.degrees===t.degrees},times:function(t){return new e.Rect(this.x*t,this.y*t,this.width*t,this.height*t,this.degrees)},translate:function(t){return new e.Rect(this.x+t.x,this.y+t.y,this.width,this.height,this.degrees)},union:function(rect){var t=this.getBoundingBox(),n=rect.getBoundingBox(),o=Math.min(t.x,n.x),r=Math.min(t.y,n.y),l=Math.max(t.x+t.width,n.x+n.width),h=Math.max(t.y+t.height,n.y+n.height);return new e.Rect(o,r,l-o,h-r)},intersection:function(rect){var t=1e-10,n=[],o=this.getTopLeft();rect.containsPoint(o,t)&&n.push(o);var r=this.getTopRight();rect.containsPoint(r,t)&&n.push(r);var l=this.getBottomLeft();rect.containsPoint(l,t)&&n.push(l);var h=this.getBottomRight();rect.containsPoint(h,t)&&n.push(h);var c=rect.getTopLeft();this.containsPoint(c,t)&&n.push(c);var d=rect.getTopRight();this.containsPoint(d,t)&&n.push(d);var m=rect.getBottomLeft();this.containsPoint(m,t)&&n.push(m);var v=rect.getBottomRight();this.containsPoint(v,t)&&n.push(v);for(var f=this._getSegments(),w=rect._getSegments(),i=0;i<f.length;i++)for(var y=f[i],T=0;T<w.length;T++){var x=w[T],S=E(y[0],y[1],x[0],x[1]);S&&n.push(S)}function E(a,b,n,o){var r=b.minus(a),l=o.minus(n),h=-l.x*r.y+r.x*l.y;if(0===h)return null;var s=(r.x*(a.y-n.y)-r.y*(a.x-n.x))/h,c=(l.x*(a.y-n.y)-l.y*(a.x-n.x))/h;return-1e-10<=s&&s<=1-t&&-1e-10<=c&&c<=1-t?new e.Point(a.x+c*r.x,a.y+c*r.y):null}if(0===n.length)return null;for(var P=n[0].x,_=n[0].x,R=n[0].y,C=n[0].y,O=1;O<n.length;O++){var I=n[O];I.x<P&&(P=I.x),I.x>_&&(_=I.x),I.y<R&&(R=I.y),I.y>C&&(C=I.y)}return new e.Rect(P,R,_-P,C-R)},_getSegments:function(){var e=this.getTopLeft(),t=this.getTopRight(),n=this.getBottomLeft(),o=this.getBottomRight();return[[e,t],[t,o],[o,n],[n,e]]},rotate:function(t,n){if(0===(t=e.positiveModulo(t,360)))return this.clone();n=n||this.getCenter();var o=this.getTopLeft().rotate(t,n),r=this.getTopRight().rotate(t,n).minus(o);r=r.apply((function(e){return Math.abs(e)<1e-15?0:e}));var l=Math.atan(r.y/r.x);return r.x<0?l+=Math.PI:r.y<0&&(l+=2*Math.PI),new e.Rect(o.x,o.y,this.width,this.height,l/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var t=this.getTopLeft(),n=this.getTopRight(),o=this.getBottomLeft(),r=this.getBottomRight(),l=Math.min(t.x,n.x,o.x,r.x),h=Math.max(t.x,n.x,o.x,r.x),c=Math.min(t.y,n.y,o.y,r.y),d=Math.max(t.y,n.y,o.y,r.y);return new e.Rect(l,c,h-l,d-c)},getIntegerBoundingBox:function(){var t=this.getBoundingBox(),n=Math.floor(t.x),o=Math.floor(t.y),r=Math.ceil(t.width+t.x-n),l=Math.ceil(t.height+t.y-o);return new e.Rect(n,o,r,l)},containsPoint:function(e,t){t=t||0;var n=this.getTopLeft(),o=this.getTopRight(),r=this.getBottomLeft(),l=o.minus(n),h=r.minus(n);return(e.x-n.x)*l.x+(e.y-n.y)*l.y>=-t&&(e.x-o.x)*l.x+(e.y-o.y)*l.y<=t&&(e.x-n.x)*h.x+(e.y-n.y)*h.y>=-t&&(e.x-r.x)*h.x+(e.y-r.y)*h.y<=t},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function(e){var t={};function n(t){var n=Number(this.element.style.marginLeft.replace("px","")),o=Number(this.element.style.marginTop.replace("px","")),l=Number(this.element.style.width.replace("px","")),h=Number(this.element.style.height.replace("px","")),c=e.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?-t.delta.x>0?n>-(l-c.x)&&(this.element.style.marginLeft=n+2*t.delta.x+"px",r(this,c.x,n+2*t.delta.x)):-t.delta.x<0&&n<0&&(this.element.style.marginLeft=n+2*t.delta.x+"px",r(this,c.x,n+2*t.delta.x)):-t.delta.y>0?o>-(h-c.y)&&(this.element.style.marginTop=o+2*t.delta.y+"px",r(this,c.y,o+2*t.delta.y)):-t.delta.y<0&&o<0&&(this.element.style.marginTop=o+2*t.delta.y+"px",r(this,c.y,o+2*t.delta.y))),!1}function o(t){var n=Number(this.element.style.marginLeft.replace("px","")),o=Number(this.element.style.marginTop.replace("px","")),l=Number(this.element.style.width.replace("px","")),h=Number(this.element.style.height.replace("px","")),c=e.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?t.scroll>0?n>-(l-c.x)&&(this.element.style.marginLeft=n-60*t.scroll+"px",r(this,c.x,n-60*t.scroll)):t.scroll<0&&n<0&&(this.element.style.marginLeft=n-60*t.scroll+"px",r(this,c.x,n-60*t.scroll)):t.scroll<0?o>c.y-h&&(this.element.style.marginTop=o+60*t.scroll+"px",r(this,c.y,o+60*t.scroll)):t.scroll>0&&o<0&&(this.element.style.marginTop=o+60*t.scroll+"px",r(this,c.y,o+60*t.scroll))),!1}function r(t,n,o){var r,l,h,c,style,i,element;for(r="horizontal"==t.scroll?t.panelWidth:t.panelHeight,l=Math.ceil(n/r)+5,i=l=(l=(h=Math.ceil((Math.abs(o)+n)/r)+1)-l)<0?0:l;i<h&&i<t.panels.length;i++)if(!(element=t.panels[i]).activePanel){var d,m=t.viewer.tileSources[i];d=m.referenceStripThumbnailUrl?{type:"image",url:m.referenceStripThumbnailUrl}:m,(c=new e.Viewer({id:element.id,tileSources:[d],element:element,navigatorSizeRatio:t.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:t.viewer.loadTilesWithAjax,ajaxHeaders:t.viewer.ajaxHeaders,useCanvas:t.useCanvas})).displayRegion=e.makeNeutralElement("div"),c.displayRegion.id=element.id+"-displayregion",c.displayRegion.className="displayregion",(style=c.displayRegion.style).position="relative",style.top="0px",style.left="0px",style.fontSize="0px",style.overflow="hidden",style.float="left",style.cssFloat="left",style.styleFloat="left",style.zIndex=999999999,style.cursor="default",style.width=t.panelWidth-4+"px",style.height=t.panelHeight-4+"px",c.displayRegion.innerTracker=new e.MouseTracker({element:c.displayRegion,startDisabled:!0}),element.getElementsByTagName("div")[0].appendChild(c.displayRegion),t.miniViewers[element.id]=c,element.activePanel=!0}}function l(e){var element=e.eventSource.element;return"horizontal"==this.scroll?element.style.marginBottom="0px":element.style.marginLeft="0px",!1}function h(t){var element=t.eventSource.element;return"horizontal"==this.scroll?element.style.marginBottom="-"+e.getElementSize(element).y/2+"px":element.style.marginLeft="-"+e.getElementSize(element).x/2+"px",!1}function c(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 38:return o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:case 37:return o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}function d(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 61:return o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:case 97:return o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}e.ReferenceStrip=function(m){var element,style,i,v=m.viewer,f=e.getElementSize(v.element);for(m.id||(m.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=m.id,this.element.className="referencestrip"),m=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},m,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),e.extend(this,m),t[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,(style=this.element.style).marginTop="0px",style.marginRight="0px",style.marginBottom="0px",style.marginLeft="0px",style.left="0px",style.bottom="0px",style.border="0px",style.background="#000",style.position="relative",e.setElementTouchActionNone(this.element),e.setElementOpacity(this.element,.8),this.viewer=v,this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,n),scrollHandler:e.delegate(this,o),enterHandler:e.delegate(this,l),exitHandler:e.delegate(this,h),keyDownHandler:e.delegate(this,c),keyHandler:e.delegate(this,d)}),m.width&&m.height?(this.element.style.width=m.width+"px",this.element.style.height=m.height+"px",v.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):"horizontal"==m.scroll?(this.element.style.width=f.x*m.sizeRatio*v.tileSources.length+12*v.tileSources.length+"px",this.element.style.height=f.y*m.sizeRatio+"px",v.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=f.y*m.sizeRatio*v.tileSources.length+12*v.tileSources.length+"px",this.element.style.width=f.x*m.sizeRatio+"px",v.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=f.x*this.sizeRatio+8,this.panelHeight=f.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},i=0;i<v.tileSources.length;i++)(element=e.makeNeutralElement("div")).id=this.element.id+"-"+i,element.style.width=this.panelWidth+"px",element.style.height=this.panelHeight+"px",element.style.display="inline",element.style.float="left",element.style.cssFloat="left",element.style.styleFloat="left",element.style.padding="2px",e.setElementTouchActionNone(element),element.innerTracker=new e.MouseTracker({element:element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(t){t.eventSource.dragging=e.now()},releaseHandler:function(t){var n=t.eventSource,o=n.element.id,r=Number(o.split("-")[2]),l=e.now();t.insideElementPressed&&t.insideElementReleased&&n.dragging&&l-n.dragging<n.clickTimeThreshold&&(n.dragging=null,v.goToPage(r))}}),this.element.appendChild(element),element.activePanel=!1,this.panels.push(element);r(this,"vertical"==this.scroll?f.y:f.x,0),this.setFocus(0)},e.extend(e.ReferenceStrip.prototype,e.EventSource.prototype,e.Viewer.prototype,{setFocus:function(t){var n,element=this.element.querySelector("#"+this.element.id+"-"+t),o=e.getElementSize(this.viewer.canvas),h=Number(this.element.style.width.replace("px","")),c=Number(this.element.style.height.replace("px","")),d=-Number(this.element.style.marginLeft.replace("px","")),m=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==element&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=element,this.currentSelected.style.background="#999","horizontal"==this.scroll?(n=Number(t)*(this.panelWidth+3))>d+o.x-this.panelWidth?(n=Math.min(n,h-o.x),this.element.style.marginLeft=-n+"px",r(this,o.x,-n)):n<d&&(n=Math.max(0,n-o.x/2),this.element.style.marginLeft=-n+"px",r(this,o.x,-n)):(n=Number(t)*(this.panelHeight+3))>m+o.y-this.panelHeight?(n=Math.min(n,c-o.y),this.element.style.marginTop=-n+"px",r(this,o.y,-n)):n<m&&(n=Math.max(0,n-o.y/2),this.element.style.marginTop=-n+"px",r(this,o.y,-n)),this.currentPage=t,l.call(this,{eventSource:this.innerTracker}))},update:function(){return!!t[this.id].animating&&(e.console.log("image reference strip update"),!0)},destroy:function(){if(this.miniViewers)for(var e in this.miniViewers)this.miniViewers[e].destroy();this.element&&this.element.parentNode.removeChild(this.element)}})}(OpenSeadragon),function(e){e.DisplayRect=function(t,n,o,r,l,h){e.Rect.apply(this,[t,n,o,r]),this.minLevel=l,this.maxLevel=h},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(OpenSeadragon),function(e){e.Spring=function(t){var n=arguments;"object"!=typeof t&&(t={initial:n.length&&"number"==typeof n[0]?n[0]:void 0,springStiffness:n.length>1?n[1].springStiffness:5,animationTime:n.length>1?n[1].animationTime:1.5}),e.console.assert("number"==typeof t.springStiffness&&0!==t.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),e.console.assert("number"==typeof t.animationTime&&t.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),t.exponential&&(this._exponential=!0,delete t.exponential),e.extend(!0,this,t),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:e.now()},e.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},e.Spring.prototype={resetTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=t,this.start.time=this.target.time=this.current.time=e.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=t,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(t){this.start.value+=t,this.target.value+=t,this._exponential&&(e.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(t){this._exponential=t,this._exponential&&(e.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){var t,n;this.current.time=e.now(),this._exponential?(t=this.start._logValue,n=this.target._logValue):(t=this.start.value,n=this.target.value);var o,r,l=this.current.time>=this.target.time?n:t+(n-t)*(o=this.springStiffness,r=(this.current.time-this.start.time)/(this.target.time-this.start.time),(1-Math.exp(o*-r))/(1-Math.exp(-o))),h=this.current.value;return this._exponential?this.current.value=Math.exp(l):this.current.value=l,h!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(e){function t(t){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null},t),this.image=null}t.prototype={errorMsg:null,start:function(){var t=this,n=this.abort;this.image=new Image,this.image.onload=function(){t.finish(!0)},this.image.onabort=this.image.onerror=function(){t.errorMsg="Image load aborted",t.finish(!1)},this.jobId=window.setTimeout((function(){t.errorMsg="Image load exceeded timeout ("+t.timeout+" ms)",t.finish(!1)}),this.timeout),this.loadWithAjax?(this.request=e.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(e){var n;try{n=new window.Blob([e.response])}catch(t){var o=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"===t.name&&o){var r=new o;r.append(e.response),n=r.getBlob()}}0===n.size&&(t.errorMsg="Empty image response.",t.finish(!1));var l=(window.URL||window.webkitURL).createObjectURL(n);t.image.src=l},error:function(e){t.errorMsg="Image load aborted - XHR error",t.finish(!1)}}),this.abort=function(){t.request.abort(),"function"==typeof n&&n()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(e){this.image.onload=this.image.onerror=this.image.onabort=null,e||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(t){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,timeout:e.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},t)},e.ImageLoader.prototype={addJob:function(e){var n=this,o=new t({src:e.src,loadWithAjax:e.loadWithAjax,ajaxHeaders:e.loadWithAjax?e.ajaxHeaders:null,crossOriginPolicy:e.crossOriginPolicy,ajaxWithCredentials:e.ajaxWithCredentials,callback:function(t){!function(e,t,n){e.jobsInProgress--,(!e.jobLimit||e.jobsInProgress<e.jobLimit)&&e.jobQueue.length>0&&(e.jobQueue.shift().start(),e.jobsInProgress++);n(t.image,t.errorMsg,t.request)}(n,t,e.callback)},abort:e.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(o.start(),this.jobsInProgress++):this.jobQueue.push(o)},clear:function(){for(var i=0;i<this.jobQueue.length;i++){var e=this.jobQueue[i];"function"==typeof e.abort&&e.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(e){e.Tile=function(e,t,n,o,r,l,h,c,d,m){this.level=e,this.x=t,this.y=n,this.bounds=o,this.sourceBounds=m,this.exists=r,this.url=l,this.context2D=h,this.loadWithAjax=c,this.ajaxHeaders=d,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(t){this.cacheImageRecord?this.loaded?(this.element||(this.element=e.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=t&&t.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",e.setElementOpacity(this.element,this.opacity)):e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):e.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(t,n,o,r){var l,h,c,d=this.position.times(e.pixelDensityRatio),m=this.size.times(e.pixelDensityRatio);this.context2D||this.cacheImageRecord?(l=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&l?(t.save(),t.globalAlpha=this.opacity,"number"==typeof o&&1!==o&&(d=d.times(o),m=m.times(o)),r instanceof e.Point&&(d=d.plus(r)),1===t.globalAlpha&&this._hasTransparencyChannel()&&t.clearRect(d.x,d.y,m.x,m.y),n({context:t,tile:this,rendered:l}),this.sourceBounds?(h=Math.min(this.sourceBounds.width,l.canvas.width),c=Math.min(this.sourceBounds.height,l.canvas.height)):(h=l.canvas.width,c=l.canvas.height),t.drawImage(l.canvas,0,0,h,c,d.x,d.y,m.x,m.y),t.restore()):e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):e.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var t;if(this.cacheImageRecord)t=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return e.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;t=this.context2D}return t.canvas.width/(this.size.x*e.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(t,n,o){var r=Math.max(1,Math.ceil((o.x-n.x)/2)),l=Math.max(1,Math.ceil((o.y-n.y)/2));return new e.Point(r,l).minus(this.position.times(e.pixelDensityRatio).times(t||1).apply((function(e){return e%1})))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(e){e.OverlayPlacement=e.Placement,e.OverlayRotationMode=e.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),e.Overlay=function(element,t,n){var o;o=e.isPlainObject(element)?element:{element:element,location:t,placement:n},this.element=o.element,this.style=o.element.style,this._init(o)},e.Overlay.prototype={_init:function(t){this.location=t.location,this.placement=void 0===t.placement?e.Placement.TOP_LEFT:t.placement,this.onDraw=t.onDraw,this.checkResize=void 0===t.checkResize||t.checkResize,this.width=void 0===t.width?null:t.width,this.height=void 0===t.height?null:t.height,this.rotationMode=t.rotationMode||e.OverlayRotationMode.EXACT,this.location instanceof e.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=e.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new e.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(t,n){var o=e.Placement.properties[this.placement];o&&(o.isHorizontallyCentered?t.x-=n.x/2:o.isRight&&(t.x-=n.x),o.isVerticallyCentered?t.y-=n.y/2:o.isBottom&&(t.y-=n.y))},destroy:function(){var element=this.element,style=this.style;element.parentNode&&(element.parentNode.removeChild(element),element.prevElementParent&&(style.display="none",document.body.appendChild(element))),this.onDraw=null,style.top="",style.left="",style.position="",null!==this.width&&(style.width=""),null!==this.height&&(style.height="");var t=e.getCssPropertyWithVendorPrefix("transformOrigin"),n=e.getCssPropertyWithVendorPrefix("transform");t&&n&&(style[t]="",style[n]="")},drawHTML:function(t,n){var element=this.element;element.parentNode!==t&&(element.prevElementParent=element.parentNode,element.prevNextSibling=element.nextSibling,t.appendChild(element),this.style.position="absolute",this.size=e.getElementSize(element));var o=this._getOverlayPositionAndSize(n),r=o.position,l=this.size=o.size,h=o.rotate;if(this.onDraw)this.onDraw(r,l,this.element);else{var style=this.style;style.left=r.x+"px",style.top=r.y+"px",null!==this.width&&(style.width=l.x+"px"),null!==this.height&&(style.height=l.y+"px");var c=e.getCssPropertyWithVendorPrefix("transformOrigin"),d=e.getCssPropertyWithVendorPrefix("transform");c&&d&&(h?(style[c]=this._getTransformOrigin(),style[d]="rotate("+h+"deg)"):(style[c]="",style[d]="")),"none"!==style.display&&(style.display="block")}},_getOverlayPositionAndSize:function(t){var n=t.pixelFromPoint(this.location,!0),o=this._getSizeInPixels(t);this.adjust(n,o);var r=0;if(t.degrees&&this.rotationMode!==e.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var rect=new e.Rect(n.x,n.y,o.x,o.y),l=this._getBoundingBox(rect,t.degrees);n=l.getTopLeft(),o=l.getSize()}else r=t.degrees;return{position:n,size:o,rotate:r}},_getSizeInPixels:function(t){var n=this.size.x,o=this.size.y;if(null!==this.width||null!==this.height){var r=t.deltaPixelsFromPointsNoRotate(new e.Point(this.width||0,this.height||0),!0);null!==this.width&&(n=r.x),null!==this.height&&(o=r.y)}if(this.checkResize&&(null===this.width||null===this.height)){var l=this.size=e.getElementSize(this.element);null===this.width&&(n=l.x),null===this.height&&(o=l.y)}return new e.Point(n,o)},_getBoundingBox:function(rect,e){var t=this._getPlacementPoint(rect);return rect.rotate(e,t).getBoundingBox()},_getPlacementPoint:function(rect){var t=new e.Point(rect.x,rect.y),n=e.Placement.properties[this.placement];return n&&(n.isHorizontallyCentered?t.x+=rect.width/2:n.isRight&&(t.x+=rect.width),n.isVerticallyCentered?t.y+=rect.height/2:n.isBottom&&(t.y+=rect.height)),t},_getTransformOrigin:function(){var t="",n=e.Placement.properties[this.placement];return n?(n.isLeft?t="left":n.isRight&&(t="right"),n.isTop?t+=" top":n.isBottom&&(t+=" bottom"),t):t},update:function(t,n){var o=e.isPlainObject(t)?t:{location:t,placement:n};this._init({location:o.location||this.location,placement:void 0!==o.placement?o.placement:this.placement,onDraw:o.onDraw||this.onDraw,checkResize:o.checkResize||this.checkResize,width:void 0!==o.width?o.width:this.width,height:void 0!==o.height?o.height:this.height,rotationMode:o.rotationMode||this.rotationMode})},getBounds:function(t){e.console.assert(t,"A viewport must now be passed to Overlay.getBounds.");var n=this.width,o=this.height;if(null===n||null===o){var r=t.deltaPointsFromPixelsNoRotate(this.size,!0);null===n&&(n=r.x),null===o&&(o=r.y)}var l=this.location.clone();return this.adjust(l,new e.Point(n,o)),this._adjustBoundsForRotation(t,new e.Rect(l.x,l.y,n,o))},_adjustBoundsForRotation:function(t,n){if(!t||0===t.degrees||this.rotationMode===e.OverlayRotationMode.EXACT)return n;if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX){if(null===this.width||null===this.height)return n;var o=this._getOverlayPositionAndSize(t);return t.viewerElementToViewportRectangle(new e.Rect(o.position.x,o.position.y,o.size.x,o.size.y))}return n.rotate(-t.degrees,this._getPlacementPoint(n))}}}(OpenSeadragon),function(e){e.Drawer=function(t){e.console.assert(t.viewer,"[Drawer] options.viewer is required");var n=arguments;if(e.isPlainObject(t)||(t={source:n[0],viewport:n[1],element:n[2]}),e.console.assert(t.viewport,"[Drawer] options.viewport is required"),e.console.assert(t.element,"[Drawer] options.element is required"),t.source&&e.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=t.viewer,this.viewport=t.viewport,this.debugGridColor="string"==typeof t.debugGridColor?[t.debugGridColor]:t.debugGridColor||e.DEFAULT_SETTINGS.debugGridColor,t.opacity&&e.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=e.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=e.getElement(t.element),this.canvas=e.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var o=this._calculateCanvasSize();this.canvas.width=o.x,this.canvas.height=o.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",e.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},e.Drawer.prototype={addOverlay:function(element,t,n,o){return e.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(element,t,n,o),this},updateOverlay:function(element,t,n){return e.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(element,t,n),this},removeOverlay:function(element){return e.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(element),this},clearOverlays:function(){return e.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(t){var n=this.viewport.pixelFromPointNoRotate(t,!0);return new e.Point(n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio)},clipWithPolygons:function(e,t){if(this.useCanvas){var n=this._getContext(t);n.beginPath(),e.forEach((function(polygon){polygon.forEach((function(e,i){n[0===i?"moveTo":"lineTo"](e.x,e.y)}))})),n.clip()}},setOpacity:function(t){e.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var n=this.viewer.world,i=0;i<n.getItemCount();i++)n.getItemAt(i).setOpacity(t);return this},getOpacity:function(){e.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var t=this.viewer.world,n=0,i=0;i<t.getItemCount();i++){var o=t.getItemAt(i).getOpacity();o>n&&(n=o)}return n},needsUpdate:function(){return e.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return e.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return e.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return e.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var e=this._calculateCanvasSize();if((this.canvas.width!=e.x||this.canvas.height!=e.y)&&(this.canvas.width=e.x,this.canvas.height=e.y,this._updateImageSmoothingEnabled(this.context),null!==this.sketchCanvas)){var t=this._calculateSketchCanvasSize();this.sketchCanvas.width=t.x,this.sketchCanvas.height=t.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(e,t){if(this.useCanvas){var n=this._getContext(e);if(t)n.clearRect(t.x,t.y,t.width,t.height);else{var canvas=n.canvas;n.clearRect(0,0,canvas.width,canvas.height)}}},viewportToDrawerRectangle:function(t){var n=this.viewport.pixelFromPointNoRotate(t.getTopLeft(),!0),o=this.viewport.deltaPixelsFromPointsNoRotate(t.getSize(),!0);return new e.Rect(n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio,o.x*e.pixelDensityRatio,o.y*e.pixelDensityRatio)},drawTile:function(t,n,o,r,l){if(e.console.assert(t,"[Drawer.drawTile] tile is required"),e.console.assert(n,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var h=this._getContext(o);r=r||1,t.drawCanvas(h,n,r,l)}else t.drawHTML(this.canvas)},_getContext:function(e){var t=this.context;if(e){if(null===this.sketchCanvas){this.sketchCanvas=document.createElement("canvas");var n=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=n.x,this.sketchCanvas.height=n.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var o=this;this.viewer.addHandler("rotate",(function e(){if(0!==o.viewport.getRotation()){o.viewer.removeHandler("rotate",e);var t=o._calculateSketchCanvasSize();o.sketchCanvas.width=t.x,o.sketchCanvas.height=t.y}}))}this._updateImageSmoothingEnabled(this.sketchContext)}t=this.sketchContext}return t},saveContext:function(e){this.useCanvas&&this._getContext(e).save()},restoreContext:function(e){this.useCanvas&&this._getContext(e).restore()},setClip:function(rect,e){if(this.useCanvas){var t=this._getContext(e);t.beginPath(),t.rect(rect.x,rect.y,rect.width,rect.height),t.clip()}},drawRectangle:function(rect,e,t){if(this.useCanvas){var n=this._getContext(t);n.save(),n.fillStyle=e,n.fillRect(rect.x,rect.y,rect.width,rect.height),n.restore()}},blendSketch:function(t,n,o,r){var l=t;if(e.isPlainObject(l)||(l={opacity:t,scale:n,translate:o,compositeOperation:r}),this.useCanvas&&this.sketchCanvas){t=l.opacity,r=l.compositeOperation;var h=l.bounds;if(this.context.save(),this.context.globalAlpha=t,r&&(this.context.globalCompositeOperation=r),h)h.x<0&&(h.width+=h.x,h.x=0),h.x+h.width>this.canvas.width&&(h.width=this.canvas.width-h.x),h.y<0&&(h.height+=h.y,h.y=0),h.y+h.height>this.canvas.height&&(h.height=this.canvas.height-h.y),this.context.drawImage(this.sketchCanvas,h.x,h.y,h.width,h.height,h.x,h.y,h.width,h.height);else{n=l.scale||1;var c=(o=l.translate)instanceof e.Point?o:new e.Point(0,0),d=0,m=0;if(o){var v=this.sketchCanvas.width-this.canvas.width,f=this.sketchCanvas.height-this.canvas.height;d=Math.round(v/2),m=Math.round(f/2)}this.context.drawImage(this.sketchCanvas,c.x-d*n,c.y-m*n,(this.canvas.width+2*d)*n,(this.canvas.height+2*m)*n,-d,-m,this.canvas.width+2*d,this.canvas.height+2*m)}this.context.restore()}},drawDebugInfo:function(t,n,i,o){if(this.useCanvas){var r=this.viewer.world.getIndexOfItem(o)%this.debugGridColor.length,l=this.context;l.save(),l.lineWidth=2*e.pixelDensityRatio,l.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",l.strokeStyle=this.debugGridColor[r],l.fillStyle=this.debugGridColor[r],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),o.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:o.getRotation(!0),point:o.viewport.pixelFromPointNoRotate(o._getRotationPoint(!0),!0)}),0===o.viewport.degrees&&o.getRotation(!0)%360==0&&o._drawer.viewer.viewport.getFlip()&&o._drawer._flip(),l.strokeRect(t.position.x*e.pixelDensityRatio,t.position.y*e.pixelDensityRatio,t.size.x*e.pixelDensityRatio,t.size.y*e.pixelDensityRatio);var h=(t.position.x+t.size.x/2)*e.pixelDensityRatio,c=(t.position.y+t.size.y/2)*e.pixelDensityRatio;l.translate(h,c),l.rotate(Math.PI/180*-this.viewport.degrees),l.translate(-h,-c),0===t.x&&0===t.y&&(l.fillText("Zoom: "+this.viewport.getZoom(),t.position.x*e.pixelDensityRatio,(t.position.y-30)*e.pixelDensityRatio),l.fillText("Pan: "+this.viewport.getBounds().toString(),t.position.x*e.pixelDensityRatio,(t.position.y-20)*e.pixelDensityRatio)),l.fillText("Level: "+t.level,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+20)*e.pixelDensityRatio),l.fillText("Column: "+t.x,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+30)*e.pixelDensityRatio),l.fillText("Row: "+t.y,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+40)*e.pixelDensityRatio),l.fillText("Order: "+i+" of "+n,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+50)*e.pixelDensityRatio),l.fillText("Size: "+t.size.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+60)*e.pixelDensityRatio),l.fillText("Position: "+t.position.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+70)*e.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),o.getRotation(!0)%360!=0&&this._restoreRotationChanges(),0===o.viewport.degrees&&o.getRotation(!0)%360==0&&o._drawer.viewer.viewport.getFlip()&&o._drawer._flip(),l.restore()}},debugRect:function(rect){if(this.useCanvas){var t=this.context;t.save(),t.lineWidth=2*e.pixelDensityRatio,t.strokeStyle=this.debugGridColor[0],t.fillStyle=this.debugGridColor[0],t.strokeRect(rect.x*e.pixelDensityRatio,rect.y*e.pixelDensityRatio,rect.width*e.pixelDensityRatio,rect.height*e.pixelDensityRatio),t.restore()}},setImageSmoothingEnabled:function(e){this.useCanvas&&(this._imageSmoothingEnabled=e,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(e){e.msImageSmoothingEnabled=this._imageSmoothingEnabled,e.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(t){var canvas=this._getContext(t).canvas;return new e.Point(canvas.width,canvas.height)},getCanvasCenter:function(){return new e.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(t){var n=t.point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter(),o=this._getContext(t.useSketch);o.save(),o.translate(n.x,n.y),this.viewer.viewport.flipped?(o.rotate(Math.PI/180*-t.degrees),o.scale(-1,1)):o.rotate(Math.PI/180*t.degrees),o.translate(-n.x,-n.y)},_flip:function(t){var n=(t=t||{}).point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter(),o=this._getContext(t.useSketch);o.translate(n.x,0),o.scale(-1,1),o.translate(-n.x,0)},_restoreRotationChanges:function(e){this._getContext(e).restore()},_calculateCanvasSize:function(){var t=e.pixelDensityRatio,n=this.viewport.getContainerSize();return{x:Math.round(n.x*t),y:Math.round(n.y*t)}},_calculateSketchCanvasSize:function(){var e=this._calculateCanvasSize();if(0===this.viewport.getRotation())return e;var t=Math.ceil(Math.sqrt(e.x*e.x+e.y*e.y));return{x:t,y:t}}}}(OpenSeadragon),function(e){e.Viewport=function(t){var n=arguments;n.length&&n[0]instanceof e.Point&&(t={containerSize:n[0],contentSize:n[1],config:n[2]}),t.config&&(e.extend(!0,t,t.config),delete t.config),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t.margins||{}),delete t.margins,e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,degrees:e.DEFAULT_SETTINGS.degrees,flipped:e.DEFAULT_SETTINGS.flipped,homeFillsViewer:e.DEFAULT_SETTINGS.homeFillsViewer},t),this._updateContainerInnerSize(),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new e.Rect(0,0,1,1),1),this.goHome(!0),this.update()},e.Viewport.prototype={resetContentSize:function(t){return e.console.assert(t,"[Viewport.resetContentSize] contentSize is required"),e.console.assert(t instanceof e.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),e.console.assert(t.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),e.console.assert(t.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new e.Rect(0,0,1,t.y/t.x),t.x),this},setHomeBounds:function(t,n){e.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(t,n)},_setContentBounds:function(t,n){e.console.assert(t,"[Viewport._setContentBounds] bounds is required"),e.console.assert(t instanceof e.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),e.console.assert(t.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),e.console.assert(t.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=t.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(n),this._contentBounds=t.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(n),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:n,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var e=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?e>=1?e:1:e>=1?1:e)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var t=this._contentBounds.getCenter(),n=1/this.getHomeZoom(),o=n/this.getAspectRatio();return new e.Rect(t.x-n/2,t.y-o/2,n,o)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom();return this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*e},getMaxZoom:function(){var e=this.maxZoomLevel;return e||(e=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,e/=this._contentBounds.width),Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return e.extend({},this._margins)},setMargins:function(t){e.console.assert("object"===e.type(t),"[Viewport.setMargins] margins must be an object"),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(-this.getRotation())},getBoundsNoRotate:function(t){var n=this.getCenter(t),o=1/this.getZoom(t),r=o/this.getAspectRatio();return new e.Rect(n.x-o/2,n.y-r/2,o,r)},getBoundsWithMargins:function(e){return this.getBoundsNoRotateWithMargins(e).rotate(-this.getRotation(),this.getCenter(e))},getBoundsNoRotateWithMargins:function(e){var t=this.getBoundsNoRotate(e),n=this._containerInnerSize.x*this.getZoom(e);return t.x-=this._margins.left/n,t.y-=this._margins.top/n,t.width+=(this._margins.left+this._margins.right)/n,t.height+=(this._margins.top+this._margins.bottom)/n,t},getCenter:function(t){var n,o,r,l,h,c,d=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),m=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return t?d:this.zoomPoint?(n=this.pixelFromPoint(this.zoomPoint,!0),l=(r=1/(o=this.getZoom()))/this.getAspectRatio(),h=new e.Rect(d.x-r/2,d.y-l/2,r,l),c=this._pixelFromPoint(this.zoomPoint,h).minus(n).divide(this._containerInnerSize.x*o),m.plus(c)):m},getZoom:function(e){return e?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(e){return Math.max(Math.min(e,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(t){var n=new e.Rect(t.x,t.y,t.width,t.height);if(this.wrapHorizontal);else{var o=this.visibilityRatio*n.width,r=n.x+n.width,l=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,h=this._contentBoundsNoRotate.x-r+o,c=l-n.x-o;o>this._contentBoundsNoRotate.width?n.x+=(h+c)/2:c<0?n.x+=c:h>0&&(n.x+=h)}if(this.wrapVertical);else{var d=this.visibilityRatio*n.height,m=n.y+n.height,v=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,f=this._contentBoundsNoRotate.y-m+d,w=v-n.y-d;d>this._contentBoundsNoRotate.height?n.y+=(f+w)/2:w<0?n.y+=w:f>0&&(n.y+=f)}return n},_raiseConstraintsEvent:function(e){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:e})},applyConstraints:function(e){var t=this.getZoom(),n=this._applyZoomConstraints(t);t!==n&&this.zoomTo(n,this.zoomPoint,e);var o=this.getBoundsNoRotate(),r=this._applyBoundaryConstraints(o);return this._raiseConstraintsEvent(e),(o.x!==r.x||o.y!==r.y||e)&&this.fitBounds(r.rotate(-this.getRotation()),e),this},ensureVisible:function(e){return this.applyConstraints(e)},_fitBounds:function(t,n){var o=(n=n||{}).immediately||!1,r=n.constraints||!1,l=this.getAspectRatio(),h=t.getCenter(),c=new e.Rect(t.x,t.y,t.width,t.height,t.degrees+this.getRotation()).getBoundingBox();c.getAspectRatio()>=l?c.height=c.width/l:c.width=c.height*l,c.x=h.x-c.width/2,c.y=h.y-c.height/2;var d=1/c.width;if(r){var m=c.getAspectRatio(),v=this._applyZoomConstraints(d);d!==v&&(d=v,c.width=1/d,c.x=h.x-c.width/2,c.height=c.width/m,c.y=h.y-c.height/2),h=(c=this._applyBoundaryConstraints(c)).getCenter(),this._raiseConstraintsEvent(o)}if(o)return this.panTo(h,!0),this.zoomTo(d,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var f=this.getBounds(),w=this.getZoom();if(0===w||Math.abs(d/w-1)<1e-8)return this.zoomTo(d,!0),this.panTo(h,o);var y=(c=c.rotate(-this.getRotation())).getTopLeft().times(d).minus(f.getTopLeft().times(w)).divide(d-w);return this.zoomTo(d,y,o)},fitBounds:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!1})},fitBoundsWithConstraints:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!0})},fitVertically:function(t){var n=new e.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(n,t)},fitHorizontally:function(t){var n=new e.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(n,t)},getConstrainedBounds:function(e){var t;return t=this.getBounds(e),this._applyBoundaryConstraints(t)},panBy:function(t,n){var o=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(o.plus(t),n)},panTo:function(e,t){return t?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:t}),this},zoomBy:function(e,t,n){return this.zoomTo(this.zoomSpring.target.value*e,t,n)},zoomTo:function(t,n,o){var r=this;return this.zoomPoint=n instanceof e.Point&&!isNaN(n.x)&&!isNaN(n.y)?n:null,o?this._adjustCenterSpringsForZoomPoint((function(){r.zoomSpring.resetTo(t)})):this.zoomSpring.springTo(t),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:t,refPoint:n,immediately:o}),this},setRotation:function(t){return this.viewer&&this.viewer.drawer.canRotate()?(this.degrees=e.positiveModulo(t,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:t}),this):this},getRotation:function(){return this.degrees},resize:function(e,t){var n,o=this.getBoundsNoRotate(),r=o;return this.containerSize.x=e.x,this.containerSize.y=e.y,this._updateContainerInnerSize(),t&&(n=e.x/this.containerSize.x,r.width=o.width*n,r.height=r.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:e,maintain:t}),this.fitBounds(r,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new e.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var e=this;this._adjustCenterSpringsForZoomPoint((function(){e.zoomSpring.update()})),this.centerSpringX.update(),this.centerSpringY.update();var t=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,t},_adjustCenterSpringsForZoomPoint:function(e){if(this.zoomPoint){var t=this.pixelFromPoint(this.zoomPoint,!0);e();var n=this.pixelFromPoint(this.zoomPoint,!0).minus(t),o=this.deltaPointsFromPixels(n,!0);this.centerSpringX.shiftBy(o.x),this.centerSpringY.shiftBy(o.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else e()},deltaPixelsFromPointsNoRotate:function(e,t){return e.times(this._containerInnerSize.x*this.getZoom(t))},deltaPixelsFromPoints:function(e,t){return this.deltaPixelsFromPointsNoRotate(e.rotate(this.getRotation()),t)},deltaPointsFromPixelsNoRotate:function(e,t){return e.divide(this._containerInnerSize.x*this.getZoom(t))},deltaPointsFromPixels:function(e,t){return this.deltaPointsFromPixelsNoRotate(e,t).rotate(-this.getRotation())},pixelFromPointNoRotate:function(e,t){return this._pixelFromPointNoRotate(e,this.getBoundsNoRotate(t))},pixelFromPoint:function(e,t){return this._pixelFromPoint(e,this.getBoundsNoRotate(t))},_pixelFromPointNoRotate:function(t,n){return t.minus(n.getTopLeft()).times(this._containerInnerSize.x/n.width).plus(new e.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(e,t){return this._pixelFromPointNoRotate(e.rotate(this.getRotation(),this.getCenter(!0)),t)},pointFromPixelNoRotate:function(t,n){var o=this.getBoundsNoRotate(n);return t.minus(new e.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/o.width).plus(o.getTopLeft())},pointFromPixel:function(e,t){return this.pointFromPixelNoRotate(e,t).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(t,n){var o=this._contentBoundsNoRotate.width;return new e.Point(t*this._contentSizeNoRotate.x/o,n*this._contentSizeNoRotate.x/o)},viewportToImageCoordinates:function(t,n){if(t instanceof e.Point)return this.viewportToImageCoordinates(t.x,t.y);if(this.viewer){var o=this.viewer.world.getItemCount();if(o>1)e.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===o){return this.viewer.world.getItemAt(0).viewportToImageCoordinates(t,n,!0)}}return this._viewportToImageDelta(t-this._contentBoundsNoRotate.x,n-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(t,n){var o=this._contentBoundsNoRotate.width;return new e.Point(t/this._contentSizeNoRotate.x*o,n/this._contentSizeNoRotate.x*o)},imageToViewportCoordinates:function(t,n){if(t instanceof e.Point)return this.imageToViewportCoordinates(t.x,t.y);if(this.viewer){var o=this.viewer.world.getItemCount();if(o>1)e.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===o){return this.viewer.world.getItemAt(0).imageToViewportCoordinates(t,n,!0)}}var r=this._imageToViewportDelta(t,n);return r.x+=this._contentBoundsNoRotate.x,r.y+=this._contentBoundsNoRotate.y,r},imageToViewportRectangle:function(t,n,o,r){var rect=t;if(rect instanceof e.Rect||(rect=new e.Rect(t,n,o,r)),this.viewer){var l=this.viewer.world.getItemCount();if(l>1)e.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===l){return this.viewer.world.getItemAt(0).imageToViewportRectangle(t,n,o,r,!0)}}var h=this.imageToViewportCoordinates(rect.x,rect.y),c=this._imageToViewportDelta(rect.width,rect.height);return new e.Rect(h.x,h.y,c.x,c.y,rect.degrees)},viewportToImageRectangle:function(t,n,o,r){var rect=t;if(rect instanceof e.Rect||(rect=new e.Rect(t,n,o,r)),this.viewer){var l=this.viewer.world.getItemCount();if(l>1)e.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===l){return this.viewer.world.getItemAt(0).viewportToImageRectangle(t,n,o,r,!0)}}var h=this.viewportToImageCoordinates(rect.x,rect.y),c=this._viewportToImageDelta(rect.width,rect.height);return new e.Rect(h.x,h.y,c.x,c.y,rect.degrees)},viewerElementToImageCoordinates:function(e){var t=this.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.pixelFromPoint(t,!0)},windowToImageCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var n=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(n)},imageToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(e){return this.pointFromPixel(e,!0)},viewportToViewerElementCoordinates:function(e){return this.pixelFromPoint(e,!0)},viewerElementToViewportRectangle:function(t){return e.Rect.fromSummits(this.pointFromPixel(t.getTopLeft(),!0),this.pointFromPixel(t.getTopRight(),!0),this.pointFromPixel(t.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(t){return e.Rect.fromSummits(this.pixelFromPoint(t.getTopLeft(),!0),this.pixelFromPoint(t.getTopRight(),!0),this.pixelFromPoint(t.getBottomLeft(),!0))},windowToViewportCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var n=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(n)},viewportToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewportToImageZoom:function(t){if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===n){return this.viewer.world.getItemAt(0).viewportToImageZoom(t)}}var o=this._contentSizeNoRotate.x;return t*(this._containerInnerSize.x/o*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(t){if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===n){return this.viewer.world.getItemAt(0).imageToViewportZoom(t)}}return t*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(e){return this.flipped===e||(this.flipped=e,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:e})),this}}}(OpenSeadragon),function(e){function t(e,t,o,r,l,h,d,m,v){var f=d.getBoundingBox().getTopLeft(),w=d.getBoundingBox().getBottomRight();e.viewer&&e.viewer.raiseEvent("update-level",{tiledImage:e,havedrawn:t,level:r,opacity:l,visibility:h,drawArea:d,topleft:f,bottomright:w,currenttime:m,best:v}),c(e.coverage,r),c(e.loadingCoverage,r);for(var y=e._getCornerTiles(r,f,w),T=y.topLeft,x=y.bottomRight,S=e.source.getNumTiles(r),E=e.viewport.pixelFromPoint(e.viewport.getCenter()),P=T.x;P<=x.x;P++)for(var _=T.y;_<=x.y;_++){if(!e.wrapHorizontal&&!e.wrapVertical){var R=e.source.getTileBounds(r,P,_);if(null===d.intersection(R))continue}v=n(e,o,t,P,_,r,l,h,E,S,m,v)}return v}function n(t,n,r,c,d,m,v,f,w,y,T,x){var S=function(t,n,o,r,l,h,time,c,d,m){var v,f,w,y,T,x,S,E,P;h[o]||(h[o]={});h[o][t]||(h[o][t]={});h[o][t][n]||(v=(c.x+t%c.x)%c.x,f=(c.y+n%c.y)%c.y,w=l.getTileBounds(o,v,f),y=l.getTileBounds(o,v,f,!0),T=l.tileExists(o,v,f),x=l.getTileUrl(o,v,f),r.loadTilesWithAjax?(S=l.getTileAjaxHeaders(o,v,f),e.isPlainObject(r.ajaxHeaders)&&(S=e.extend({},r.ajaxHeaders,S))):S=null,E=l.getContext2D?l.getContext2D(o,v,f):void 0,w.x+=(t-v)/c.x,w.y+=m/d*((n-f)/c.y),P=new e.Tile(o,t,n,w,T,x,E,r.loadTilesWithAjax,S,y),v===c.x-1&&(P.isRightMost=!0),f===c.y-1&&(P.isBottomMost=!0),h[o][t][n]=P);return(P=h[o][t][n]).lastTouchTime=time,P}(c,d,m,t,t.source,t.tilesMatrix,T,y,t._worldWidthCurrent,t._worldHeightCurrent),E=r;t.viewer&&t.viewer.raiseEvent("update-tile",{tiledImage:t,tile:S}),h(t.coverage,m,c,d,!1);var P=S.loaded||S.loading||l(t.loadingCoverage,m,c,d);if(h(t.loadingCoverage,m,c,d,P),!S.exists)return x;if(n&&!E&&(l(t.coverage,m,c,d)?h(t.coverage,m,c,d,!0):E=!0),!E)return x;if(function(t,n,o,r,l,h){var c=t.bounds.getTopLeft();c.x*=h._scaleSpring.current.value,c.y*=h._scaleSpring.current.value,c.x+=h._xSpring.current.value,c.y+=h._ySpring.current.value;var d=t.bounds.getSize();d.x*=h._scaleSpring.current.value,d.y*=h._scaleSpring.current.value;var m=o.pixelFromPointNoRotate(c,!0),v=o.pixelFromPointNoRotate(c,!1),f=o.deltaPixelsFromPointsNoRotate(d,!0),w=o.deltaPixelsFromPointsNoRotate(d,!1),y=v.plus(w.divide(2)),T=r.squaredDistanceTo(y);n||(f=f.plus(new e.Point(1,1)));t.isRightMost&&h.wrapHorizontal&&(f.x+=.75);t.isBottomMost&&h.wrapVertical&&(f.y+=.75);t.position=m,t.size=f,t.squaredDistance=T,t.visibility=l}(S,t.source.tileOverlap,t.viewport,w,f,t),!S.loaded)if(S.context2D)o(t,S);else{var _=t._tileCache.getImageRecord(S.cacheKey);if(_)o(t,S,_.getImage())}S.loaded?function(e,t,n,o,r,l,c){var d,m,v=1e3*e.blendTime;t.blendStart||(t.blendStart=c);d=c-t.blendStart,m=v?Math.min(1,d/v):1,e.alwaysBlend&&(m*=l);if(t.opacity=m,e.lastDrawn.push(t),1===m)h(e.coverage,r,n,o,!0),e._hasOpaqueTile=!0;else if(d<v)return!0;return!1}(t,S,c,d,m,v,T)&&(t._needsDraw=!0):S.loading?t._tilesLoading++:P||(x=function(e,t){if(!e)return t;if(t.visibility>e.visibility)return t;if(t.visibility==e.visibility&&t.squaredDistance<e.squaredDistance)return t;return e}(x,S));return x}function o(e,t,image,n,o){var r=0;function l(){return r++,h}function h(){0===--r&&(t.loading=!1,t.loaded=!0,t.context2D||e._tileCache.cacheTile({image:image,tile:t,cutoff:n,tiledImage:e}),e._needsDraw=!0)}e.viewer.raiseEvent("tile-loaded",{tile:t,tiledImage:e,tileRequest:o,image:image,getCompletionCallback:l}),l()()}function r(e,t,n,o){var r,l,i,h;if(!e[t])return!1;if(void 0===n||void 0===o){for(i in r=e[t])if(Object.prototype.hasOwnProperty.call(r,i))for(h in l=r[i])if(Object.prototype.hasOwnProperty.call(l,h)&&!l[h])return!1;return!0}return void 0===e[t][n]||void 0===e[t][n][o]||!0===e[t][n][o]}function l(e,t,n,o){return void 0===n||void 0===o?r(e,t+1):r(e,t+1,2*n,2*o)&&r(e,t+1,2*n,2*o+1)&&r(e,t+1,2*n+1,2*o)&&r(e,t+1,2*n+1,2*o+1)}function h(t,n,o,r,l){t[n]?(t[n][o]||(t[n][o]={}),t[n][o][r]=l):e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",n)}function c(e,t){e[t]={}}e.TiledImage=function(t){var n=this;e.console.assert(t.tileCache,"[TiledImage] options.tileCache is required"),e.console.assert(t.drawer,"[TiledImage] options.drawer is required"),e.console.assert(t.viewer,"[TiledImage] options.viewer is required"),e.console.assert(t.imageLoader,"[TiledImage] options.imageLoader is required"),e.console.assert(t.source,"[TiledImage] options.source is required"),e.console.assert(!t.clip||t.clip instanceof e.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),e.EventSource.call(this),this._tileCache=t.tileCache,delete t.tileCache,this._drawer=t.drawer,delete t.drawer,this._imageLoader=t.imageLoader,delete t.imageLoader,t.clip instanceof e.Rect&&(this._clip=t.clip.clone()),delete t.clip;var o=t.x||0;delete t.x;var r=t.y||0;delete t.y,this.normHeight=t.source.dimensions.y/t.source.dimensions.x,this.contentAspectX=t.source.dimensions.x/t.source.dimensions.y;var l=1;t.width?(l=t.width,delete t.width,t.height&&(e.console.error("specifying both width and height to a tiledImage is not supported"),delete t.height)):t.height&&(l=t.height/this.normHeight,delete t.height);var h=t.fitBounds;delete t.fitBounds;var c=t.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete t.fitBoundsPlacement;var d=t.degrees||0;delete t.degrees,e.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:e.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:e.DEFAULT_SETTINGS.iOSDevice,debugMode:e.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:e.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:e.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:e.DEFAULT_SETTINGS.placeholderFillStyle,opacity:e.DEFAULT_SETTINGS.opacity,preload:e.DEFAULT_SETTINGS.preload,compositeOperation:e.DEFAULT_SETTINGS.compositeOperation},t),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new e.Spring({initial:o,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new e.Spring({initial:r,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new e.Spring({initial:l,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new e.Spring({initial:d,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),h&&this.fitBounds(h,c,!0),this._drawingHandler=function(t){n.viewer.raiseEvent("tile-drawing",e.extend({tiledImage:n},t))}},e.extend(e.TiledImage.prototype,e.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(e){e!==this._fullyLoaded&&(this._fullyLoaded=e,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=e.now(),this._needsDraw=!0},update:function(){var e=this._xSpring.update(),t=this._ySpring.update(),n=this._scaleSpring.update(),o=this._degreesSpring.update();return!!(e||t||n||o)&&(this._updateForScale(),this._needsDraw=!0,!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(this.getRotation(e),this._getRotationPoint(e))},getBoundsNoRotate:function(t){return t?new e.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new e.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return e.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(t){var n=this.getBoundsNoRotate(t);if(this._clip){var o=(t?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x,r=this._clip.times(o);n=new e.Rect(n.x+r.x,n.y+r.y,r.width,r.height)}return n.rotate(this.getRotation(t),this._getRotationPoint(t))},getContentSize:function(){return new e.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(t,n,o){var r=o?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(t*(this.source.dimensions.x/r),n*(this.source.dimensions.y*this.contentAspectX/r))},viewportToImageCoordinates:function(t,n,o){var r;return t instanceof e.Point?(o=n,r=t):r=new e.Point(t,n),r=r.rotate(-this.getRotation(o),this._getRotationPoint(o)),o?this._viewportToImageDelta(r.x-this._xSpring.current.value,r.y-this._ySpring.current.value):this._viewportToImageDelta(r.x-this._xSpring.target.value,r.y-this._ySpring.target.value)},_imageToViewportDelta:function(t,n,o){var r=o?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(t/this.source.dimensions.x*r,n/this.source.dimensions.y/this.contentAspectX*r)},imageToViewportCoordinates:function(t,n,o){t instanceof e.Point&&(o=n,n=t.y,t=t.x);var r=this._imageToViewportDelta(t,n);return o?(r.x+=this._xSpring.current.value,r.y+=this._ySpring.current.value):(r.x+=this._xSpring.target.value,r.y+=this._ySpring.target.value),r.rotate(this.getRotation(o),this._getRotationPoint(o))},imageToViewportRectangle:function(t,n,o,r,l){var rect=t;rect instanceof e.Rect?l=n:rect=new e.Rect(t,n,o,r);var h=this.imageToViewportCoordinates(rect.getTopLeft(),l),c=this._imageToViewportDelta(rect.width,rect.height,l);return new e.Rect(h.x,h.y,c.x,c.y,rect.degrees+this.getRotation(l))},viewportToImageRectangle:function(t,n,o,r,l){var rect=t;t instanceof e.Rect?l=n:rect=new e.Rect(t,n,o,r);var h=this.viewportToImageCoordinates(rect.getTopLeft(),l),c=this._viewportToImageDelta(rect.width,rect.height,l);return new e.Rect(h.x,h.y,c.x,c.y,rect.degrees-this.getRotation(l))},viewerElementToImageCoordinates:function(e){var t=this.viewport.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.viewport.pixelFromPoint(t,!0)},windowToImageCoordinates:function(e){var t=e.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(t)},imageToWindowCoordinates:function(e){return this.imageToViewerElementCoordinates(e).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(rect){var t=this._scaleSpring.current.value;return rect=rect.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new e.Rect((rect.x-this._xSpring.current.value)/t,(rect.y-this._ySpring.current.value)/t,rect.width/t,rect.height/t,rect.degrees)},viewportToImageZoom:function(e){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*e},imageToViewportZoom:function(e){return e/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(e,t){var n=this._xSpring.target.value===e.x&&this._ySpring.target.value===e.y;if(t){if(n&&this._xSpring.current.value===e.x&&this._ySpring.current.value===e.y)return;this._xSpring.resetTo(e.x),this._ySpring.resetTo(e.y),this._needsDraw=!0}else{if(n)return;this._xSpring.springTo(e.x),this._ySpring.springTo(e.y),this._needsDraw=!0}n||this._raiseBoundsChange()},setWidth:function(e,t){this._setScale(e,t)},setHeight:function(e,t){this._setScale(e/this.normHeight,t)},setCroppingPolygons:function(t){var n=function(t){return t.map((function(t){try{if(function(t){return t instanceof e.Point||"number"==typeof t.x&&"number"==typeof t.y}(t))return{x:t.x,y:t.y};throw new Error}catch(e){throw new Error("A Provided cropping polygon point is not supported")}}))};try{if(!e.isArray(t))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=t.map((function(polygon){return n(polygon)}))}catch(t){e.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),e.console.error(t),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(t,n,o){n=n||e.Placement.CENTER;var r=e.Placement.properties[n],l=this.contentAspectX,h=0,c=0,d=1,m=1;if(this._clip&&(l=this._clip.getAspectRatio(),d=this._clip.width/this.source.dimensions.x,m=this._clip.height/this.source.dimensions.y,t.getAspectRatio()>l?(h=this._clip.x/this._clip.height*t.height,c=this._clip.y/this._clip.height*t.height):(h=this._clip.x/this._clip.width*t.width,c=this._clip.y/this._clip.width*t.width)),t.getAspectRatio()>l){var v=t.height/m,f=0;r.isHorizontallyCentered?f=(t.width-t.height*l)/2:r.isRight&&(f=t.width-t.height*l),this.setPosition(new e.Point(t.x-h+f,t.y-c),o),this.setHeight(v,o)}else{var w=t.width/d,y=0;r.isVerticallyCentered?y=(t.height-t.width/l)/2:r.isBottom&&(y=t.height-t.width/l),this.setPosition(new e.Point(t.x-h,t.y-c+y),o),this.setWidth(w,o)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(t){e.console.assert(!t||t instanceof e.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),t instanceof e.Rect?this._clip=t.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(e){e!==this.opacity&&(this.opacity=e,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(e){this._preload=!!e,this._needsDraw=!0},getRotation:function(e){return e?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(e,t){this._degreesSpring.target.value===e&&this._degreesSpring.isAtTargetValue()||(t?this._degreesSpring.resetTo(e):this._degreesSpring.springTo(e),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(e){return this.getBoundsNoRotate(e).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(e){e!==this.compositeOperation&&(this.compositeOperation=e,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(e,t){var n=this._scaleSpring.target.value===e;if(t){if(n&&this._scaleSpring.current.value===e)return;this._scaleSpring.resetTo(e),this._updateForScale(),this._needsDraw=!0}else{if(n)return;this._scaleSpring.springTo(e),this._updateForScale(),this._needsDraw=!0}n||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var e=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),t=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,n=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(t/this.minPixelRatio)/Math.log(2))));return n=Math.max(n,this.source.minLevel||0),{lowestLevel:e=Math.min(e,n),highestLevel:n}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){this.lastDrawn.pop().beingDrawn=!1}var n=this.viewport,l=this._viewportToTiledImageRectangle(n.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var h=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(l=l.intersection(h)))return}for(var c=this._getLevelsInterval(),d=c.lowestLevel,m=c.highestLevel,v=null,f=!1,w=e.now(),y=m;y>=d;y--){var T=!1,x=n.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(y),!0).x*this._scaleSpring.current.value;if(y===d||!f&&x>=this.minPixelRatio)T=!0,f=!0;else if(!f)continue;var S=n.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(y),!1).x*this._scaleSpring.current.value,E=n.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,P=this.immediateRender?1:E;if(v=t(this,f,T,y,Math.min(1,(x-.5)/.5),P/Math.abs(P-S),l,w,v),r(this.coverage,y))break}!function(t,n){if(0===t.opacity||0===n.length&&!t.placeholderFillStyle)return;var o,r,l,h=n[0];h&&(o=t.opacity<1||t.compositeOperation&&"source-over"!==t.compositeOperation||!t._isBottomItem()&&h._hasTransparencyChannel());var c,d=t.viewport.getZoom(!0),m=t.viewportToImageZoom(d);n.length>1&&m>t.smoothTileEdgesMinZoom&&!t.iOSDevice&&t.getRotation(!0)%360==0&&e.supportsCanvas&&(o=!0,r=h.getScaleForEdgeSmoothing(),l=h.getTranslationForEdgeSmoothing(r,t._drawer.getCanvasSize(!1),t._drawer.getCanvasSize(!0)));o&&(r||(c=t.viewport.viewportToViewerElementRectangle(t.getClippedBounds(!0)).getIntegerBoundingBox(),t._drawer.viewer.viewport.getFlip()&&(0===t.viewport.degrees&&t.getRotation(!0)%360==0||(c.x=t._drawer.viewer.container.clientWidth-(c.x+c.width))),c=c.times(e.pixelDensityRatio)),t._drawer._clear(!0,c));r||(0!==t.viewport.degrees&&t._drawer._offsetForRotation({degrees:t.viewport.degrees,useSketch:o}),t.getRotation(!0)%360!=0&&t._drawer._offsetForRotation({degrees:t.getRotation(!0),point:t.viewport.pixelFromPointNoRotate(t._getRotationPoint(!0),!0),useSketch:o}),0===t.viewport.degrees&&t.getRotation(!0)%360==0&&t._drawer.viewer.viewport.getFlip()&&t._drawer._flip());var v=!1;if(t._clip){t._drawer.saveContext(o);var f=t.imageToViewportRectangle(t._clip,!0);f=f.rotate(-t.getRotation(!0),t._getRotationPoint(!0));var w=t._drawer.viewportToDrawerRectangle(f);r&&(w=w.times(r)),l&&(w=w.translate(l)),t._drawer.setClip(w,o),v=!0}if(t._croppingPolygons){t._drawer.saveContext(o);try{var y=t._croppingPolygons.map((function(polygon){return polygon.map((function(e){var n=t.imageToViewportCoordinates(e.x,e.y,!0).rotate(-t.getRotation(!0),t._getRotationPoint(!0)),o=t._drawer.viewportCoordToDrawerCoord(n);return r&&(o=o.times(r)),o}))}));t._drawer.clipWithPolygons(y,o)}catch(t){e.console.error(t)}v=!0}if(t.placeholderFillStyle&&!1===t._hasOpaqueTile){var T=t._drawer.viewportToDrawerRectangle(t.getBounds(!0));r&&(T=T.times(r)),l&&(T=T.translate(l));var x=null;x="function"==typeof t.placeholderFillStyle?t.placeholderFillStyle(t,t._drawer.context):t.placeholderFillStyle,t._drawer.drawRectangle(T,x,o)}for(var i=n.length-1;i>=0;i--)h=n[i],t._drawer.drawTile(h,t._drawingHandler,o,r,l),h.beingDrawn=!0,t.viewer&&t.viewer.raiseEvent("tile-drawn",{tiledImage:t,tile:h});v&&t._drawer.restoreContext(o);r||(t.getRotation(!0)%360!=0&&t._drawer._restoreRotationChanges(o),0!==t.viewport.degrees&&t._drawer._restoreRotationChanges(o));o&&(r&&(0!==t.viewport.degrees&&t._drawer._offsetForRotation({degrees:t.viewport.degrees,useSketch:!1}),t.getRotation(!0)%360!=0&&t._drawer._offsetForRotation({degrees:t.getRotation(!0),point:t.viewport.pixelFromPointNoRotate(t._getRotationPoint(!0),!0),useSketch:!1})),t._drawer.blendSketch({opacity:t.opacity,scale:r,translate:l,compositeOperation:t.compositeOperation,bounds:c}),r&&(t.getRotation(!0)%360!=0&&t._drawer._restoreRotationChanges(!1),0!==t.viewport.degrees&&t._drawer._restoreRotationChanges(!1)));r||0===t.viewport.degrees&&t.getRotation(!0)%360==0&&t._drawer.viewer.viewport.getFlip()&&t._drawer._flip();!function(t,n){if(t.debugMode)for(var i=n.length-1;i>=0;i--){var o=n[i];try{t._drawer.drawDebugInfo(o,n.length,i,t)}catch(t){e.console.error(t)}}}(t,n)}(this,this.lastDrawn),v&&!v.context2D?(!function(t,n,time){n.loading=!0,t._imageLoader.addJob({src:n.url,loadWithAjax:n.loadWithAjax,ajaxHeaders:n.ajaxHeaders,crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,callback:function(image,r,l){!function(t,n,time,image,r,l){if(!image)return e.console.log("Tile %s failed to load: %s - error: %s",n,n.url,r),t.viewer.raiseEvent("tile-load-failed",{tile:n,tiledImage:t,time:time,message:r,tileRequest:l}),n.loading=!1,void(n.exists=!1);if(time<t.lastResetTime)return e.console.log("Ignoring tile %s loaded before reset: %s",n,n.url),void(n.loading=!1);var h=function(){var e=t.source.getClosestLevel();o(t,n,image,e,l)};t._midDraw?window.setTimeout(h,1):h()}(t,n,time,image,r,l)},abort:function(){n.loading=!1}})}(this,v,w),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(t,n,o){var r,l,h,c;this.wrapHorizontal?(r=e.positiveModulo(n.x,1),l=e.positiveModulo(o.x,1)):(r=Math.max(0,n.x),l=Math.min(1,o.x));var d=1/this.source.aspectRatio;this.wrapVertical?(h=e.positiveModulo(n.y,d),c=e.positiveModulo(o.y,d)):(h=Math.max(0,n.y),c=Math.min(d,o.y));var m=this.source.getTileAtPoint(t,new e.Point(r,h)),v=this.source.getTileAtPoint(t,new e.Point(l,c)),f=this.source.getNumTiles(t);return this.wrapHorizontal&&(m.x+=f.x*Math.floor(n.x),v.x+=f.x*Math.floor(o.x)),this.wrapVertical&&(m.y+=f.y*Math.floor(n.y/d),v.y+=f.y*Math.floor(o.y/d)),{topLeft:m,bottomRight:v}}})}(OpenSeadragon),function(e){var t=function(t){e.console.assert(t,"[TileCache.cacheTile] options is required"),e.console.assert(t.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(t.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=t.tile,this.tiledImage=t.tiledImage},n=function(t){e.console.assert(t,"[ImageRecord] options is required"),e.console.assert(t.image,"[ImageRecord] options.image is required"),this._image=t.image,this._tiles=[]};n.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var canvas=document.createElement("canvas");canvas.width=this._image.width,canvas.height=this._image.height,this._renderedContext=canvas.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(t){e.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=t},addTile:function(t){e.console.assert(t,"[ImageRecord.addTile] tile is required"),this._tiles.push(t)},removeTile:function(t){for(var i=0;i<this._tiles.length;i++)if(this._tiles[i]===t)return void this._tiles.splice(i,1);e.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",t)},getTileCount:function(){return this._tiles.length}},e.TileCache=function(t){t=t||{},this._maxImageCacheCount=t.maxImageCacheCount||e.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},e.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(o){e.console.assert(o,"[TileCache.cacheTile] options is required"),e.console.assert(o.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(o.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),e.console.assert(o.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var r=o.cutoff||0,l=this._tilesLoaded.length,h=this._imagesLoaded[o.tile.cacheKey];if(h||(e.console.assert(o.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),h=this._imagesLoaded[o.tile.cacheKey]=new n({image:o.image}),this._imagesLoadedCount++),h.addTile(o.tile),o.tile.cacheImageRecord=h,this._imagesLoadedCount>this._maxImageCacheCount){for(var c,d,m,v,f,w,y=null,T=-1,x=null,i=this._tilesLoaded.length-1;i>=0;i--)(c=(w=this._tilesLoaded[i]).tile).level<=r||c.beingDrawn||(y?(v=c.lastTouchTime,d=y.lastTouchTime,f=c.level,m=y.level,(v<d||v==d&&f>m)&&(y=c,T=i,x=w)):(y=c,T=i,x=w));y&&T>=0&&(this._unloadTile(x),l=T)}this._tilesLoaded[l]=new t({tile:o.tile,tiledImage:o.tiledImage})},clearTilesFor:function(t){var n;e.console.assert(t,"[TileCache.clearTilesFor] tiledImage is required");for(var i=0;i<this._tilesLoaded.length;++i)(n=this._tilesLoaded[i]).tiledImage===t&&(this._unloadTile(n),this._tilesLoaded.splice(i,1),i--)},getImageRecord:function(t){return e.console.assert(t,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[t]},_unloadTile:function(t){e.console.assert(t,"[TileCache._unloadTile] tileRecord is required");var n=t.tile,o=t.tiledImage;n.unload(),n.cacheImageRecord=null;var r=this._imagesLoaded[n.cacheKey];r.removeTile(n),r.getTileCount()||(r.destroy(),delete this._imagesLoaded[n.cacheKey],this._imagesLoadedCount--),o.viewer.raiseEvent("tile-unloaded",{tile:n,tiledImage:o})}}}(OpenSeadragon),function(e){e.World=function(t){var n=this;e.console.assert(t.viewer,"[World] options.viewer is required"),e.EventSource.call(this),this.viewer=t.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(e){n._autoRefigureSizes?n._figureSizes():n._needsSizesFigured=!0},this._figureSizes()},e.extend(e.World.prototype,e.EventSource.prototype,{addItem:function(t,n){if(e.console.assert(t,"[World.addItem] item is required"),e.console.assert(t instanceof e.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(n=n||{}).index){var o=Math.max(0,Math.min(this._items.length,n.index));this._items.splice(o,0,t)}else this._items.push(t);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,t.addHandler("bounds-change",this._delegatedFigureSizes),t.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:t})},getItemAt:function(t){return e.console.assert(void 0!==t,"[World.getItemAt] index is required"),this._items[t]},getIndexOfItem:function(t){return e.console.assert(t,"[World.getIndexOfItem] item is required"),e.indexOf(this._items,t)},getItemCount:function(){return this._items.length},setItemIndex:function(t,n){e.console.assert(t,"[World.setItemIndex] item is required"),e.console.assert(void 0!==n,"[World.setItemIndex] index is required");var o=this.getIndexOfItem(t);if(n>=this._items.length)throw new Error("Index bigger than number of layers.");n!==o&&-1!==o&&(this._items.splice(o,1),this._items.splice(n,0,t),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:t,previousIndex:o,newIndex:n}))},removeItem:function(t){e.console.assert(t,"[World.removeItem] item is required");var n=e.indexOf(this._items,t);-1!==n&&(t.removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy(),this._items.splice(n,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(t))},removeAll:function(){var e,i;for(this.viewer._cancelPendingImages(),i=0;i<this._items.length;i++)(e=this._items[i]).removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy();var t=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,i=0;i<t.length;i++)e=t[i],this._raiseRemoveItem(e)},resetItems:function(){for(var i=0;i<this._items.length;i++)this._items[i].reset()},update:function(){for(var e=!1,i=0;i<this._items.length;i++)e=this._items[i].update()||e;return e},draw:function(){for(var i=0;i<this._items.length;i++)this._items[i].draw();this._needsDraw=!1},needsDraw:function(){for(var i=0;i<this._items.length;i++)if(this._items[i].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(e){this._autoRefigureSizes=e,e&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(t){var n,o=(t=t||{}).immediately||!1,r=t.layout||e.DEFAULT_SETTINGS.collectionLayout,l=t.rows||e.DEFAULT_SETTINGS.collectionRows,h=t.columns||e.DEFAULT_SETTINGS.collectionColumns,c=t.tileSize||e.DEFAULT_SETTINGS.collectionTileSize,d=c+(t.tileMargin||e.DEFAULT_SETTINGS.collectionTileMargin);n=!t.rows&&h?h:Math.ceil(this._items.length/l);var m,v,f,w,y,T=0,x=0;this.setAutoRefigureSizes(!1);for(var i=0;i<this._items.length;i++)i&&i%n==0&&("horizontal"===r?(x+=d,T=0):(T+=d,x=0)),w=(f=(v=(m=this._items[i]).getBounds()).width>v.height?c:c*(v.width/v.height))*(v.height/v.width),y=new e.Point(T+(c-f)/2,x+(c-w)/2),m.setPosition(y,o),m.setWidth(f,o),"horizontal"===r?T+=d:x+=d;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var t=this._homeBounds?this._homeBounds.clone():null,n=this._contentSize?this._contentSize.clone():null,o=this._contentFactor||0;if(this._items.length){var r=this._items[0],l=r.getBounds();this._contentFactor=r.getContentSize().x/l.width;for(var h=r.getClippedBounds().getBoundingBox(),c=h.x,d=h.y,m=h.x+h.width,v=h.y+h.height,i=1;i<this._items.length;i++)l=(r=this._items[i]).getBounds(),this._contentFactor=Math.max(this._contentFactor,r.getContentSize().x/l.width),h=r.getClippedBounds().getBoundingBox(),c=Math.min(c,h.x),d=Math.min(d,h.y),m=Math.max(m,h.x+h.width),v=Math.max(v,h.y+h.height);this._homeBounds=new e.Rect(c,d,m-c,v-d),this._contentSize=new e.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new e.Rect(0,0,1,1),this._contentSize=new e.Point(1,1),this._contentFactor=1;this._contentFactor===o&&this._homeBounds.equals(t)&&this._contentSize.equals(n)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(e){this.raiseEvent("remove-item",{item:e})}})}(OpenSeadragon)}}]);